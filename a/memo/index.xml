<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>progrhyme's Tech Notes – Memorandum</title><link>https://progrhy.me/tech-notes/a/memo/</link><description>Recent content in Memorandum on progrhyme's Tech Notes</description><generator>Hugo -- gohugo.io</generator><language>ja</language><lastBuildDate>Sat, 25 Apr 2020 00:00:00 +0000</lastBuildDate><atom:link href="https://progrhy.me/tech-notes/a/memo/index.xml" rel="self" type="application/rss+xml"/><item><title>A: 2020-08-28</title><link>https://progrhy.me/tech-notes/a/memo/20200828/</link><pubDate>Fri, 28 Aug 2020 16:49:31 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/memo/20200828/</guid><description>
&lt;h2 id="828">8/28&lt;/h2>
&lt;h3 id="macosでecs-cliをセットアップ">macOSでecs-cliをセットアップ&lt;/h3>
&lt;h4 id="インストール">インストール&lt;/h4>
&lt;p>公式には書いてないが、Homebrewに対応していた。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">brew install amazon-ecs-cli
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;a href="https://formulae.brew.sh/formula/amazon-ecs-cli">https://formulae.brew.sh/formula/amazon-ecs-cli&lt;/a>&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/ECS_CLI_installation.html">Amazon ECS CLI のインストール - Amazon Elastic Container Service&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="セットアップ">セットアップ&lt;/h4>
&lt;p>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/ECS_CLI_Configuration.html">Amazon ECS CLI の設定 - Amazon Elastic Container Service&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">ecs-cli configure profile --profile-name PROFILE_NAME --access-key &lt;span style="color:#000">$AWS_ACCESS_KEY_ID&lt;/span> --secret-key &lt;span style="color:#000">$AWS_SECRET_ACCESS_KEY&lt;/span>
ecs-cli configure --cluster CLUSTER --default-launch-type LAUNCH_TYPE --region REGION --config-name NAME
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>A: 2020-07-30</title><link>https://progrhy.me/tech-notes/a/memo/20200730/</link><pubDate>Thu, 30 Jul 2020 11:02:26 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/memo/20200730/</guid><description>
&lt;h2 id="730">7/30&lt;/h2>
&lt;h3 id="scp時にシェルが予期しない挙動をする">scp時にシェルが予期しない挙動をする&lt;/h3>
&lt;p>自分のdotfilesで考慮できていないのがよくない。&lt;br>
下を参考に設定を見直す:&lt;/p>
&lt;p>-&lt;a href="https://linux.just4fun.biz/?Linux%E7%92%B0%E5%A2%83%E8%A8%AD%E5%AE%9A/scp%E3%81%8C%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%8F%E3%81%AA%E3%81%A3%E3%81%9F%E6%99%82%E3%81%AE%E5%AF%BE%E5%87%A6%E6%B3%95%E3%83%BBbashrc%E7%B7%A8">Linux環境設定/scpができなくなった時の対処法・bashrc編 - Linuxと過ごす&lt;/a>&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/montblanc18/items/b93fa4082e3bc2702a7f">.bashrc内にechoを入れておくとscpに失敗する - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>たぶん下のような感じで行けるのではないか:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[[&lt;/span> -t &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">]]&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#204a87;font-weight:bold">then&lt;/span> &lt;span style="color:#8f5902;font-style:italic"># ログイン&lt;/span>
:
&lt;span style="color:#204a87;font-weight:bold">else&lt;/span> &lt;span style="color:#8f5902;font-style:italic"># scpなど&lt;/span>
:
&lt;span style="color:#204a87;font-weight:bold">fi&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://stackoverflow.com/questions/10022323/check-isatty-in-bash">shell - check isatty in bash - Stack Overflow&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="731">7/31&lt;/h2>
&lt;h3 id="vs-code--pythonで内部モジュールのimportエラー">VS Code + Pythonで内部モジュールのimportエラー&lt;/h3>
&lt;p>&lt;code>oreno/modules&lt;/code> 以下に内部モジュールを置いているとする。&lt;br>
次の2設定でエラー回避できそう。&lt;/p>
&lt;ul>
&lt;li>&lt;code>&amp;quot;python.autoComplete.extraPaths&amp;quot;: [&amp;quot;./oreno/modules&amp;quot;]&lt;/code>&lt;/li>
&lt;li>ワークスペースのルートに次の内容で pylintrc ファイルを作る:&lt;/li>
&lt;/ul>
&lt;pre>&lt;code>init-hook=&amp;quot;./oreno/modules&amp;quot;
&lt;/code>&lt;/pre>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/kurikou02/items/beb3d638f93cc372b3c3">VSCodeで自作モジュールimport時のエラー表示(unresolved import &amp;lsquo;hoge&amp;rsquo;)が消えない - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/New_enpitsu_15/items/c1e680cc0c24cf87c581">VSCodeのPylintがimportでうざい！！！！ - Qiita&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: 2020-07-18</title><link>https://progrhy.me/tech-notes/a/memo/20200718/</link><pubDate>Sat, 18 Jul 2020 14:40:19 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/memo/20200718/</guid><description>
&lt;h2 id="718">7/18&lt;/h2>
&lt;h3 id="goreleaserでhomebrewのformulaを作るようにした">GoReleaserでHomebrewのFormulaを作るようにした&lt;/h3>
&lt;p>なんとそれができるということをつい昨日知った。&lt;/p>
&lt;p>See &lt;a href="https://progrhy.me/tech-notes/a/program/go/ecosystem/goreleaser/#homebrew-formula%E7%94%9F%E6%88%90">Golang &amp;gt; GoReleaser#Homebrew Formula生成&lt;/a>&lt;/p>
&lt;p>ひとまずbinq-ghで試してみたところ、上手く行った。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/progrhyme/homebrew-taps/commit/fa4b730603f2a350220a4d345c4b2c4a245c60ca">https://github.com/progrhyme/homebrew-taps/commit/fa4b730603f2a350220a4d345c4b2c4a245c60ca&lt;/a> &amp;hellip; GoReleaserによるFormula更新&lt;/li>
&lt;li>&lt;a href="https://github.com/binqry/binq-gh/commit/e7012eb2f8dc72777c2ee4ee0fbfc45151e90f41">.goreleaser.ymlとGitHub Actionsの設定変更&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>homepage&lt;/code> の設定が漏れて空になってしまったが、修正済み。&lt;/p>
&lt;p>この後、binqとshelpも同様の設定を入れたので、もう手動でFormulaを更新する必要はなくなると思われる。&lt;/p>
&lt;p>NOTE:&lt;/p>
&lt;ul>
&lt;li>これ用に新しくPersonal Access Tokenを払い出した。公開リポジトリを更新するだけなので、権限は &lt;code>repo:public_repo&lt;/code> のみでOK
&lt;ul>
&lt;li>参考: &lt;a href="https://developer.github.com/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/">Understanding scopes for OAuth Apps | GitHub Developer Guide&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Secretの設定でこのAccess Tokenの名前に初め &lt;code>GITHUB_TOKEN_HOMEBREW_TAP&lt;/code> と付けようとしたら、エラーで設定できなかった。GitHubの仕様っぽい（？）&lt;/li>
&lt;/ul>
&lt;h2 id="719">7/19&lt;/h2>
&lt;h3 id="ubuntu-1804---2004-ltsにアップグレード">Ubuntu 18.04 -&amp;gt; 20.04 LTSにアップグレード&lt;/h3>
&lt;p>普段使いのデスクトップPCでアップグレードを行った。&lt;br>
7月に入ったらやろうと思っていたが、binqの開発を優先していたりして、今になった。&lt;/p>
&lt;p>参考にした記事:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.imuza.com/entry/ubuntu2004">Ubuntu 20.04 LTS にアップグレード - IMUZA.com&lt;/a>&lt;/li>
&lt;li>公式Wiki（日本語） &lt;a href="https://wiki.ubuntu.com/FocalFossa/ReleaseNotes/Ja">FocalFossa/ReleaseNotes/Ja - Ubuntu Wiki&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/hitobb/items/2ee9b1c2c49760976e0f">Ubuntu 18.04(LTS)→20.04(LTS)アップグレード方法 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>前回（18.04アップグレード時）のログ:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/memo/2018/20180922/#ubuntu-1804-lts%E3%81%AB%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89">2018-09-22#Ubuntu 18.04 LTSにアップグレード&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>以下、実施手順。&lt;/p>
&lt;h4 id="アップグレード実施手順と詳細">アップグレード実施手順と詳細&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">sudo apt update
sudo apt upgrade
sudo apt autoremove
&lt;/code>&lt;/pre>&lt;/div>&lt;p>※実際はパッケージは最新状態だったので、上のコマンド実行は不要だったと思われる。&lt;/p>
&lt;p>GUIの「ソフトウェアの更新」を確認したところ、Ubuntuの新バージョンの通知（LTS）は有効になっていたが、まだ通知は来ていなかった。&lt;/p>
&lt;p>結局、1つ目の参考記事に従い、「Alt + F2」を押した後、フォームに &lt;code>update-manager -c -d&lt;/code> を入力してEnterを押すと、20.04 LTSへのアップグレードが可能になった。&lt;/p>
&lt;p>新規追加されるパッケージが1,800弱あり、1時間弱は掛かった気がする。&lt;/p>
&lt;h5 id="etcsysctlconfのリセット">/etc/sysctl.confのリセット&lt;/h5>
&lt;p>途中でダイアログが出てきて、「なんかカスタマイズされてるけど、リセットしてもいい？」みたいなことを聞かれた。&lt;/p>
&lt;p>何やってたっけと思ってdiffを見ると、VS Codeで変更検知するために &lt;code>fs.inotify.max_user_watches&lt;/code> を引き上げていたのだった。&lt;br>
リセットによる差分はコメント行の変更しかなかったので、そのままにしておいてもらった。&lt;/p>
&lt;h4 id="アップグレード後の作業">アップグレード後の作業&lt;/h4>
&lt;h5 id="etcaptsourceslistの確認">/etc/apt/sources.listの確認&lt;/h5>
&lt;p>なんかアップグレード中に「デフォルトじゃないやつは無効にするから、必要なら後で足してね」みたいなメッセージがあったので、確認した。&lt;br>
元のやつは sources.list.save として残っているようだった。&lt;br>
差分を見たが特に独自に足したものはなかったようだったので、何もしない。&lt;br>
Dockerかpecoか何かで弄ってなかったっけ？&lt;/p>
&lt;h5 id="設定--外観">設定 &amp;gt; 外観&lt;/h5>
&lt;ul>
&lt;li>ダークモードが選べたので、それにした。&lt;/li>
&lt;li>アイコンサイズが小さくなってちょっと見づらかったので少し大きくした。&lt;/li>
&lt;/ul>
&lt;h5 id="テキストエディタ">テキストエディタ&lt;/h5>
&lt;p>中身はいつものgedit.&lt;br>
ダークモードにしたせいかカーソル位置が見づらくなったので、カラースキームをSolarized Lightにした。&lt;br>
ついでにフォントを見慣れたRoboto Mono for Powerlineに変えた。&lt;/p>
&lt;h5 id="xkbキーマップの設定">xkbキーマップの設定&lt;/h5>
&lt;p>いつものキーマップ変更:&lt;/p>
&lt;ul>
&lt;li>「変換」 -&amp;gt; 「全角/半角」&lt;/li>
&lt;li>「無変換」 -&amp;gt; 「Esc」&lt;/li>
&lt;li>「Esc」 -&amp;gt; 「無変換」&lt;/li>
&lt;li>「全角/半角」 -&amp;gt; 「変換」&lt;/li>
&lt;/ul>
&lt;p>設定手順: &lt;a href="https://keyamb.hatenablog.com/entry/2016/06/04/130022">Ubuntu + xkb で JISキーボードのキー配置入れ替え - weblog of key_amb&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># 設定ファイルの編集&lt;/span>
$ sudo vim /usr/share/X11/xkb/symbols/inet
&lt;span style="color:#8f5902;font-style:italic"># 設定の反映&lt;/span>
$ setxkbmap -layout jp,us
&lt;/code>&lt;/pre>&lt;/div>&lt;p>何かあればまたここに追記するかも。&lt;/p>
&lt;h3 id="slackアプリなどについて少し調べて触った">Slackアプリなどについて少し調べて触った&lt;/h3>
&lt;p>Slackアプリを作ったことがなかったが、Incoming WebhookもSlackアプリへの移行が推奨されているので、そろそろ多少はわかっておきたいと思った。&lt;/p>
&lt;p>やったこと:&lt;/p>
&lt;ul>
&lt;li>適当にアプリを作ってIncoming Webhookを有効にしてcurlでメッセージをPOST&lt;/li>
&lt;/ul>
&lt;p>これは思っていたよりずっと簡単だった。&lt;br>
Single-Workspaceで使うだけなら、あまり考えるべきことはなさそう。&lt;/p>
&lt;p>その他、調べたことは&lt;a href="https://progrhy.me/tech-notes/a/web-service/slack/">Webサービス &amp;gt; Slack&lt;/a>にまとめた。&lt;/p>
&lt;p>メモ:&lt;/p>
&lt;ul>
&lt;li>GASでもOAuth 2.0に対応したエンドポイント（redirect url等）をそれっぽく作れば配布可能なアプリは作れそうな気がする&lt;/li>
&lt;/ul></description></item><item><title>A: 2020-07-12</title><link>https://progrhy.me/tech-notes/a/memo/20200712/</link><pubDate>Sun, 12 Jul 2020 01:44:36 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/memo/20200712/</guid><description>
&lt;h2 id="712">7/12&lt;/h2>
&lt;h3 id="hugoでmemo用のarchetypeを作る">Hugoでmemo用のarchetypeを作る&lt;/h3>
&lt;p>関連項目:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/static-site-generator/hugo/#archetypes">Hugo#Archetypes&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>上手く行ったパターン①:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#000">---&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">title&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;{{ dateFormat &amp;#34;&lt;/span>&lt;span style="color:#000">2006-01-02&lt;/span>&lt;span style="color:#4e9a06">&amp;#34; .Date }}&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">linkTitle&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;{{ dateFormat &amp;#34;&lt;/span>&lt;span style="color:#000">2006-01-02&lt;/span>&lt;span style="color:#4e9a06">&amp;#34; .Date }}&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">date&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>{{&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">.Date }}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000">---&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>現在日時から日付を作る場合は上で良いが、たまに昨日のメモとか作りたくなることがあるので、ファイル名を元に作るようにした。&lt;/p>
&lt;p>上手く行ったパターン②:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#000">---&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">title&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;{{ substr .Name 0 4 }}-{{ substr .Name 4 2 }}-{{ substr .Name 6 2 }}&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">linkTitle&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;{{ substr .Name 0 4 }}-{{ substr .Name 4 2 }}-{{ substr .Name 6 2 }}&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">date&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>{{&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">.Date }}&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#000">---&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>工夫すればもう少しすっきり書けるかもしれない。&lt;/p>
&lt;p>駄目だったパターン:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#8f5902;font-style:italic"># Hugoのリファレンスに載ってるのにエラーになる。 .Dateが文字列扱いで、 .Format ってメソッドはない的な&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">title&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;{{ .Date.Format &amp;#34;&lt;/span>&lt;span style="color:#000">2006-01-02&lt;/span>&lt;span style="color:#4e9a06">&amp;#34; }}&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#8f5902;font-style:italic"># sprigのリファレンスを見たらこれが正しいかと思ったが、Hugoだと違った&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">title&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;{{ substr 0 3 .Name }}-{{ substr 4 5 .Name }}-{{ substr 6 7 .Name }}&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://gohugo.io/functions/format/">https://gohugo.io/functions/format/&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://gohugo.io/functions/substr/">https://gohugo.io/functions/substr/&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://masterminds.github.io/sprig/strings.html">http://masterminds.github.io/sprig/strings.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="binqのメタデータサーバによるメタデータの公開は著作権やライセンス侵害にあたるのか">binqのメタデータサーバによるメタデータの公開は著作権やライセンス侵害にあたるのか？&lt;/h3>
&lt;p>少し前から作っていたbinqについて、先ほどようやくブログを書くことができた:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://tech-progrhyme.hatenablog.com/entry/2020/07/binq-v0.6.1">GitHub Pagesをメタデータサーバとする簡易インストーラー「binq」をGo言語で作った - progrhyme&amp;rsquo;s tech blog&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>「免責事項」として書いたのだけど、こういうメタデータの収集・公開が著作権やライセンス侵害に当たるのかが気になったので、少し調べた。&lt;/p>
&lt;p>あまりそのものズバリな事例はないのだけど、少なくとも、元々コピーや再配布を許可しているライセンスで問題になることはないだろう。&lt;/p>
&lt;p>ゆるいOSSライセンスはそういうものもある。&lt;/p>
&lt;p>逆に、著作権法上の「公表権」や「頒布権」を理由に、「絶対に自分のHPに来てダウンロードしなきゃ駄目」みたいに書いているソフトウェアがあったら、それをbinqのインデックスに載せると怒られるかもしれない。&lt;br>
そもそもインターネットにOSSとして公開しているソフトウェアで、そんな風に書いているものがあるのか知らないが。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://www.vector.co.jp/for_users/study/chosakuken.html">フリーソフト、シェアウェアの基礎知識 - フリーソフトの著作権&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://e-words.jp/w/%E5%86%8D%E9%85%8D%E5%B8%83.html">再配布（二次配布）とは - IT用語辞典 e-Words&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://onm-tm.jp/news/%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E7%AD%89%E3%81%AE%E8%91%97%E4%BD%9C%E6%A8%A9%E5%95%8F%E9%A1%8C%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E7%94%A8%E8%AA%9E%E3%81%AB%E3%81%A4%E3%81%84/">ソフトウェア等の著作権問題に関する用語について（用語解説） | 大島・西村・宮永商標特許事務所&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q10110939465">ソフトウェアの二次配布禁止する理由について質問です。 - 出来たらこの&amp;hellip; - Yahoo!知恵袋&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="goで任意の処理の出力を構造化データとして上手く扱いたい">Goで任意の処理の出力を構造化データとして上手く扱いたい&lt;/h3>
&lt;p>構造体だったら &lt;code>fmt.Printf(&amp;quot;%+v&amp;quot;, x)&lt;/code> とやればある程度きれいに出力できるけど、それをもっと汎用的にできると嬉しいかなというところ。&lt;/p>
&lt;p>背景として、最近はCLIでも構造化されたデータを色んなフォーマットで出力できることがクールになってる、というのがある。&lt;/p>
&lt;p>kubectl然り、Google Cloud SDK然り、AWS SDK然り。&lt;br>
最近の事例だと、Rust製のnushellでは、デフォルトでコマンドの出力結果がテーブルになっており、パイプによってコマンド間でデータの受け渡しが可能になっている。&lt;/p>
&lt;p>nushellの実装がどうなっているのかは見てないけど、まあなんかそんな感じでやりたい。&lt;/p>
&lt;p>サンプルとして参考になりそうな候補:&lt;/p>
&lt;ul>
&lt;li>Kubernetes
&lt;ul>
&lt;li>追ってみたところ、&lt;a href="https://pkg.go.dev/k8s.io/apimachinery/pkg/runtime">k8s.io/apimachinery/pkg/runtime&lt;/a>が汎用データ型及びプロセッサっぽい。単独では使いづらい気がするんだけど、めちゃimportされているのはコアなライブラリだからか&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>クラウドのSDKとか…まだ見てない&lt;/li>
&lt;li>logger系
&lt;ul>
&lt;li>hashedhyphenさんに「zapはどう？」と言われたので少し見てみたけど、やはりロギングに比重が置かれている感じで、ちょっとユースケースが限定されすぎている感がある&lt;/li>
&lt;li>後でもう一度見直したところ、内部に抽象データ型があるので使えるかもしれないと思った。が、それはやはりロギングに最適化されたデータ構造で、汎用的な用途で使うにはどうしたらいいかわからなかった。&lt;/li>
&lt;li>&lt;a href="https://github.com/fluent/fluent-logger-golang">fluent/fluent-logger-golang&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://pkg.go.dev/github.com/fluent/fluent-logger-golang/fluent">https://pkg.go.dev/github.com/fluent/fluent-logger-golang/fluent&lt;/a>&lt;/li>
&lt;li>↓のmsgpackのインタフェースを使っている&lt;/li>
&lt;li>&lt;a href="https://pkg.go.dev/github.com/tinylib/msgp/msgp">https://pkg.go.dev/github.com/tinylib/msgp/msgp&lt;/a>
&lt;ul>
&lt;li>コードジェネレータのヘルパーと書いてあるけど、普通にシリアライザ・デシリアライザの機能を持つ。&lt;/li>
&lt;li>真面目にやるとこのぐらいは必要だよなぁという感想&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://awesome-go.com/">Awesome Go&lt;/a>で見つけたやつ:
&lt;ul>
&lt;li>Data Structureカテゴリだと、アルゴリズム系ばかりが見つかる。&lt;/li>
&lt;li>&lt;a href="https://github.com/mickep76/encoding">https://github.com/mickep76/encoding&lt;/a> &amp;hellip; これは自分が目指しているものに近い気がする。WIPって感じがするけど&lt;/li>
&lt;li>&lt;a href="https://github.com/bndr/gotabulate">https://github.com/bndr/gotabulate&lt;/a> &amp;hellip; テーブル形式で出力してくれる君。2次元のデータにしか対応してない&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>今回の話と関係ないけど、調べている途中で目に入って気になったライブラリ:&lt;/p>
&lt;ul>
&lt;li>kubernetes関係を見ているときに&lt;a href="https://pkg.go.dev/k8s.io/klog">k8s.io/klog&lt;/a>というロギングライブラリを見つけた。今回の用途には向かないが、依存がなくて割とシンプルなレベル付きロガーなので、使いやすいシチュエーションもあるかも（Google寄りなライブラリ）&lt;/li>
&lt;li>&lt;a href="https://github.com/mvdan/sh">https://github.com/mvdan/sh&lt;/a> &amp;hellip; 全然関係ないけどawesome-goで目に入った。shfmtとかgosh (PoC)が入ってる&lt;/li>
&lt;/ul>
&lt;h4 id="実験で作ったdfmtというもの">実験で作ったdfmtというもの&lt;/h4>
&lt;p>&lt;a href="https://github.com/progrhyme/experiments/tree/master/go/dfmt">https://github.com/progrhyme/experiments/tree/master/go/dfmt&lt;/a>&lt;/p>
&lt;p>ちょっとまだ道筋が見えない。&lt;/p></description></item><item><title>A: 2020-06-26</title><link>https://progrhy.me/tech-notes/a/memo/20200626/</link><pubDate>Fri, 26 Jun 2020 15:58:18 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/memo/20200626/</guid><description>
&lt;h2 id="626">6/26&lt;/h2>
&lt;h3 id="mysqlコマンドでmycnfが指定できないできた">mysqlコマンドでmy.cnfが指定できない→できた&lt;/h3>
&lt;p>&lt;code>--defaults-file&lt;/code> オプションで指定できるらしいが、エラーになる。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">$ mysql -h mysql -u&lt;span style="color:#000">$USER&lt;/span> -p&lt;span style="color:#000">$PASS&lt;/span> --defaults-extra-file&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>path/to/my.cnf
mysql: &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ERROR&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> unknown variable &lt;span style="color:#4e9a06">&amp;#39;defaults-extra-file=path/to/my.cnf&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>このオプションは最初に指定しないといけないらしい。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">$ mysql --defaults-extra-file&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>path/to/my.cnf -h mysql -u&lt;span style="color:#000">$USER&lt;/span> -p&lt;span style="color:#000">$PASS&lt;/span>
mysql&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>関連項目:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/mysql/#cli-options">MySQL#CLI-Options&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/xiaopihang/items/b6242182b9d22bab7620">MySQLメモ - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="docker-registry-apiを叩いてtag検索するcliを作った">docker registry APIを叩いてtag検索するCLIを作った&lt;/h3>
&lt;p>※追記: &lt;a href="https://github.com/genuinetools/reg">https://github.com/genuinetools/reg&lt;/a> を使ったほうがいいと気づいた。&lt;/p>
&lt;p>dockerコマンドでは取れないので、curlコマンドをラップするコマンドを作った。&lt;/p>
&lt;p>&lt;a href="https://github.com/progrhyme/toolbox/blob/master/bin/docker-search-tags">https://github.com/progrhyme/toolbox/blob/master/bin/docker-search-tags&lt;/a>&lt;/p>
&lt;p>V2 APIを使ったほうがいいんだろうけど、認証とか面倒だったのでとりあえずV1で。&lt;/p>
&lt;p>関連項目:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/docker/#api">Docker &amp;gt; Registry#API&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: 2020-06-24</title><link>https://progrhy.me/tech-notes/a/memo/20200624/</link><pubDate>Wed, 24 Jun 2020 02:06:26 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/memo/20200624/</guid><description>
&lt;h2 id="624">6/24&lt;/h2>
&lt;h3 id="github-pagesをjsonサーバとして使う">GitHub PagesをJSONサーバとして使う&lt;/h3>
&lt;p>使える。&lt;br>
やってみた。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">$ curl https://progrhy.me/gh-page-test/foo.json
&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;foo&amp;#34;&lt;/span>:&lt;span style="color:#4e9a06">&amp;#34;bar&amp;#34;&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://stackoverflow.com/questions/39199042/serve-json-data-from-github-pages">api - Serve JSON Data from Github Pages - Stack Overflow&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/Kanahiro/items/e7021b05199ae52e818b">GitHub Actionsを活用して擬似APIサーバーを用意する - Qiita&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/Kanahiro/items/9cfa6fa5cc9c3fcb57fd">GitHub Pagesを活用して擬似REST APIサーバーを作る - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="progrhymegithubio-でやったらハマった">progrhyme.github.io でやったらハマった&lt;/h4>
&lt;p>最初プロフィールサイトにjsonファイル置いたら、なぜか404になってハマった。&lt;br>
他のコンテンツがあると駄目なのか、 progrhyme.github.io リポが例外的に駄目なのか、仕様がよくわからん。&lt;/p>
&lt;h3 id="久しぶりにmysqlをdockerで動かしたら接続できなかった">久しぶりにmysqlをdockerで動かしたら接続できなかった&lt;/h3>
&lt;p>mysql 8をdockerで動かして、別のdockerコンテナから接続しようとしたが、認証エラーで接続できなかった。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># サーバ実行&lt;/span>
$ docker run --rm --name mysql -e &lt;span style="color:#000">MYSQL_ROOT_PASSWORD&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>mysql -d -p 3306:3306 mysql
&lt;span style="color:#8f5902;font-style:italic"># クライアント実行&lt;/span>
$ docker run --rm --link mysql:mysql -it myapp bash -l
&lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>myapp&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span>&amp;gt; mysql -h mysql -uroot -pmysql
&lt;/code>&lt;/pre>&lt;/div>&lt;p>出くわしたエラーは &lt;code>ERROR 2026&lt;/code> と &lt;code>ERROR 2061&lt;/code> かな。&lt;br>
SSL接続を回避して解消できないかトライしたけどできなかったので、とりあえずmysql 5.7にして回避した。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/astrsk_hori/items/e3d6c237d68be1a6f548">dockerでmysqlを使う - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://yoku0825.blogspot.com/2018/10/mysql-80cachingsha2password-ssl.html">日々の覚書: MySQL 8.0のcaching_sha2_password + 非SSL接続が転ける&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://ah-2.com/g1/2017/01/30/mysql_ssl_connect_error.html">ah-2.com | SSLを有効にしているMySQLに接続時にERROR 2026 (HY000): SSL connection error: protocol version mismatch が出る&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://dev.mysql.com/doc/refman/5.6/ja/ssl-options.html">MySQL :: MySQL 5.6 リファレンスマニュアル :: 6.3.10.4 SSL コマンドのオプション&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: 2020-06-22</title><link>https://progrhy.me/tech-notes/a/memo/20200622/</link><pubDate>Mon, 22 Jun 2020 11:53:08 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/memo/20200622/</guid><description>
&lt;h2 id="622">6/22&lt;/h2>
&lt;h3 id="flaskで作ったapiのドキュメントを作りたい">Flaskで作ったAPIのドキュメントを作りたい&lt;/h3>
&lt;p>まださっとググっただけだけど、色んなツールがありそう。&lt;/p>
&lt;p>例:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://flask-apispec.readthedocs.io/en/latest/">https://flask-apispec.readthedocs.io/en/latest/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://stackoverflow.com/questions/14295322/what-tools-are-available-to-auto-produce-documentation-for-a-rest-api-written-in">python - What tools are available to auto-produce documentation for a REST API written in Flask? - Stack Overflow&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="librariesio">libraries.io&lt;/h3>
&lt;p>&lt;a href="https://libraries.io/">https://libraries.io/&lt;/a>&lt;/p>
&lt;p>というのがある。Go, npmなど各種言語のパッケージをまとめてホスト（？）しているようだ。&lt;/p>
&lt;p>&lt;a href="https://libraries.io/gitlab/timkoi/shelldoc">https://libraries.io/gitlab/timkoi/shelldoc&lt;/a>&lt;/p>
&lt;p>↑で見つけた。&lt;br>
これはbpkgに対応しているようだけど、libraries.ioがどう扱っているのかはよくわからん。
libraries.ioの対応パッケージにbpkgはなさそう。&lt;/p>
&lt;p>&lt;a href="https://libraries.io/languages/Shell">https://libraries.io/languages/Shell&lt;/a>&lt;/p>
&lt;p>っていうカテゴリがあるが、実はnpmのものが多い。&lt;br>
タグがついてるだけなのか、中にシェルスクリプトを含んでいるものなのか？&lt;/p></description></item><item><title>A: 2020-06-20</title><link>https://progrhy.me/tech-notes/a/memo/20200620/</link><pubDate>Sat, 20 Jun 2020 07:45:18 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/memo/20200620/</guid><description>
&lt;h2 id="620">6/20&lt;/h2>
&lt;h3 id="gitconfigでpullrebase--trueにしていたらローカルの履歴が失われた">gitconfigでpull.rebase = trueにしていたらローカルの履歴が失われた&lt;/h3>
&lt;p>&lt;a href="https://github.com/progrhyme/myenv/commits/a75f069fad8dd05fe26d40526deab10d7912cb51">https://github.com/progrhyme/myenv/commits/a75f069fad8dd05fe26d40526deab10d7912cb51&lt;/a>&lt;/p>
&lt;p>この辺の作業をしていたとき。&lt;br>
macOSで作業した後、Ubuntuに戻ったときについ &lt;code>git push -f&lt;/code> してしまい、 &lt;code>[darwin]&lt;/code> なコミットログが失われてしまった。&lt;/p>
&lt;p>その後macOSに戻ってgit pullしたが、 &lt;code>pull.rebase = true&lt;/code> にしていたからtopにあったコミットはなかったことにされてしまったようだ。&lt;/p>
&lt;p>関連項目:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/git/#pull">Git#config-pull&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="go-moduleの更新をpkggodevに反映する">Go moduleの更新をpkg.go.devに反映する&lt;/h3>
&lt;p>shelpはmodule / packageとしての利用は想定してないのだけど、久しぶりにpkg.go.devで見てみたら、未だにv0.1.0しかないのが気になった。&lt;/p>
&lt;p>&lt;a href="https://pkg.go.dev/mod/github.com/progrhyme/shelp?tab=versions">https://pkg.go.dev/mod/github.com/progrhyme/shelp?tab=versions&lt;/a>&lt;/p>
&lt;p>※今は後述の操作を行って、v0.5.3までインデックされている。&lt;/p>
&lt;p>ふつうにGitHubにリリースしているだけでは新しいバージョンがインデックスされないみたい。&lt;br>
&lt;a href="https://go.dev/about">https://go.dev/about&lt;/a> によると&lt;/p>
&lt;blockquote>
&lt;p>Data for the site is downloaded from proxy.golang.org. We monitor the Go Module Index regularly for new packages to add to pkg.go.dev. If you don’t see a package on pkg.go.dev, you can add it by doing one of the following:&lt;/p>
&lt;/blockquote>
&lt;p>以下、いずれかの操作が必要だそうだ:&lt;/p>
&lt;ul>
&lt;li>proxy.golang.org に当該バージョンのモジュールをリクエストする
&lt;ul>
&lt;li>例) &lt;a href="https://proxy.golang.org/example.com/my/module/@v/v1.0.0.info">https://proxy.golang.org/example.com/my/module/@v/v1.0.0.info&lt;/a> にGETリクエストを送る&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>GOPROXY=&amp;ldquo;&lt;a href="https://proxy.golang.org">https://proxy.golang.org&lt;/a>&amp;rdquo; をつけてmodule-aware modeでgo getする
&lt;ul>
&lt;li>例) &lt;code>GOPROXY=&amp;quot;https://proxy.golang.org&amp;quot; GO111MODULE=on go get example.com/my/module@v1.0.0&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>関連項目:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/program/go/dojo/#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E6%9B%B4%E6%96%B0">プログラム言語 &amp;gt; Golang &amp;gt; 道場#モジュール更新&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="golangでmoduleのパスの外でmodule-aware-modeで入れたmoduleの消し方がわからん">Golangでmoduleのパスの外でmodule-aware modeで入れたmoduleの消し方がわからん&lt;/h3>
&lt;p>&lt;a href="https://golang.org/cmd/go/">https://golang.org/cmd/go/&lt;/a> には載ってないと思う。&lt;/p>
&lt;p>go mod tidyで消えるかもしれないが、何が対象になるかわからなくて、怖くてまだ打ってない。&lt;br>
別に全部消えてもなんとかなると思うけど。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/k-kurikuri/items/609141727320eb1a6d2b">go mod tidy で不要なpackageを削除する - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="mkdocs事始め">MkDocs事始め&lt;/h3>
&lt;p>shelpのドキュメントサイトを作ろうと思った。&lt;br>
そんなにページ数も行かないだろうから、Docsyは牛刀過ぎる。&lt;br>
このぐらいのサイトならMkDocsで十分行けそうである。&lt;/p>
&lt;p>そして、&lt;a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs&lt;/a>はとてもデザインが良い。&lt;/p>
&lt;p>というわけで、まずはMkDocs環境をセットアップ。&lt;/p>
&lt;p>全部mkdocs-materialのDockerでやろうかとも思ったけど、まあPythonも既にpyenvで3.8を入れてたし、そんなに面倒じゃなかったのと、Dockerでファイルを作るとパーミッションがあーって感じになりがちなので、mkdocs用のvenvを作ってやることにした。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># venvセットアップ&lt;/span>
python -m venv venv/mkdocs
&lt;span style="color:#204a87">source&lt;/span> venv/mkdocs/bin/activate
&lt;span style="color:#8f5902;font-style:italic"># mkdocsインストール&lt;/span>
pip install mkdocs
&lt;span style="color:#8f5902;font-style:italic"># リポジトリ作成&lt;/span>
mkdocs new shelp-doc
&lt;/code>&lt;/pre>&lt;/div>&lt;p>関連項目:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/static-site-generator/mkdocs/">Software &amp;gt; 静的サイトジェネレーター &amp;gt; MkDocs&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="mkdocs-materialをdockerで動かす">mkdocs-materialをDockerで動かす&lt;/h3>
&lt;p>&lt;a href="https://github.com/progrhyme/docker-wraps">docker-wraps&lt;/a>というリポジトリを作って、ラッパースクリプトを書いた。&lt;br>
やってることはこれだけ:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic">#!/usr/bin/env bash
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>docker run --rm -it -p 8000:8000 -v &lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">PWD&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>:/docs squidfunk/mkdocs-material &lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#000">$@&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>これを上で作ったshelp-docリポジトリで動かす…の前に、mkdocs.ymlでテーマを設定してから:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#204a87;font-weight:bold">site_name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">shelp doc&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">theme&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">material&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ラッパーコマンドを実行すると、docker pull -&amp;gt; runが行われ、 0.0.0.0:8000 でmkdocsのWebサーバが起動した。&lt;/p></description></item><item><title>A: 2020-06-17</title><link>https://progrhy.me/tech-notes/a/memo/20200617/</link><pubDate>Wed, 17 Jun 2020 00:14:59 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/memo/20200617/</guid><description>
&lt;h2 id="617">6/17&lt;/h2>
&lt;h3 id="shelpのリファクタでgorenameを叩きまくった">shelpのリファクタでgorenameを叩きまくった&lt;/h3>
&lt;p>gorenameの使い方などは&lt;a href="https://progrhy.me/tech-notes/a/program/go/tools/#cmdgorename">プログラム言語 &amp;gt; Golang &amp;gt; tools#cmd/gorename&lt;/a>に書いた。&lt;/p>
&lt;p>具体的にはこのコミット: &lt;a href="https://github.com/progrhyme/shelp/pull/5/commits/9b33d0e78dfa9b984a24eca80d9fef89b0556157">https://github.com/progrhyme/shelp/pull/5/commits/9b33d0e78dfa9b984a24eca80d9fef89b0556157&lt;/a>&lt;/p>
&lt;p>gorenameを通算30回ぐらいは叩いたか。&lt;br>
下のようにシェル関数を作ってタイプ数を減らした:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">gorename-cli&lt;span style="color:#ce5c00;font-weight:bold">()&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87">local&lt;/span> &lt;span style="color:#000">from&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#000">$1&lt;/span>
&lt;span style="color:#204a87">local&lt;/span> &lt;span style="color:#000">to&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#000">$2&lt;/span>
gorename -from &lt;span style="color:#4e9a06">&amp;#34;\&amp;#34;github.com/progrhyme/shelp/internal/cli\&amp;#34;.&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">from&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span> -to &lt;span style="color:#000">$to&lt;/span> -v
&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span>
gorename-cli removeCmd.name op
gorename-cli commonCmd.command name
gorename-cli removeCmd.op &lt;span style="color:#204a87">command&lt;/span>
gorename-cli installCmd.op &lt;span style="color:#204a87">command&lt;/span>
:
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="shelpのhomebrew-tap-formulaを更新したが手元でupgradeを打っても更新されなかった">shelpのHomebrew Tap Formulaを更新したが、手元でupgradeを打っても更新されなかった&lt;/h3>
&lt;p>&lt;a href="https://github.com/progrhyme/homebrew-taps/commit/351ee0f987043968bad1ff9fc386f895d86f8406">shelpのFormulaをv0.5.1に更新した&lt;/a>が、 &lt;code>brew upgrade&lt;/code> で更新できなかった。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">$ brew bundle --global
:
&lt;span style="color:#8f5902;font-style:italic"># 更新されず&lt;/span>
$ brew update
$ brew upgrade shelp
Warning: progrhyme/taps/shelp 86.64 already installed
&lt;/code>&lt;/pre>&lt;/div>&lt;p>仕方ないので &lt;code>brew remove shelp&lt;/code> -&amp;gt; &lt;code>brew bundle&lt;/code> したが、 &lt;code>brew reinstall&lt;/code> でもよかったか。&lt;/p>
&lt;h4 id="追記-autodetectに失敗していた">追記 autodetectに失敗していた&lt;/h4>
&lt;p>↑のログにも出ているように、バージョンが &lt;code>86.64&lt;/code> だと思われていたらしい。&lt;br>
んなアホな…。&lt;/p>
&lt;p>&lt;code>.version&lt;/code> メソッドで明示的に指定した。&lt;/p>
&lt;p>&lt;a href="https://github.com/progrhyme/homebrew-taps/commit/af68e9c05b604b32048cada29cc5c54e2c4dd96a">https://github.com/progrhyme/homebrew-taps/commit/af68e9c05b604b32048cada29cc5c54e2c4dd96a&lt;/a>&lt;/p>
&lt;h3 id="goreleaserのドキュメントに修正prを送った">goreleaserのドキュメントに修正PRを送った&lt;/h3>
&lt;p>&lt;a href="https://goreleaser.com/ci/actions/">https://goreleaser.com/ci/actions/&lt;/a>&lt;/p>
&lt;p>で紹介されているサンプルのYAMLに問題があって、履歴が取れていなかったので。&lt;/p>
&lt;blockquote class="twitter-tweet">&lt;p lang="ja" dir="ltr">GoReleaserで、GitHub ActionsでリリースするとChangelogに全コミット履歴が載ってしまう原因がわかった。履歴取得のために&lt;br>git fetch --prune --unshallowしてるけど、これだとタグ情報が取れてないので、--tagsオプションが必要だ。&lt;/p>&amp;mdash; progrhyme (@progrhyme) &lt;a href="https://twitter.com/progrhyme/status/1272139558994378753?ref_src=twsrc%5Etfw">June 14, 2020&lt;/a>&lt;/blockquote> &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8">&lt;/script>
&lt;ul>
&lt;li>&lt;a href="https://github.com/goreleaser/goreleaser/pull/1608">https://github.com/goreleaser/goreleaser/pull/1608&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>上のPRを送ったが、actions/checkout@v2のオプションで行けたので、そちらでやることになった:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/goreleaser/goreleaser/pull/1610">https://github.com/goreleaser/goreleaser/pull/1610&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: 2020-06-15</title><link>https://progrhy.me/tech-notes/a/memo/20200615/</link><pubDate>Mon, 15 Jun 2020 01:53:26 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/memo/20200615/</guid><description>
&lt;h2 id="615">6/15&lt;/h2>
&lt;h3 id="maltmillを使いたかったが動かなかった">maltmillを使いたかったが動かなかった&lt;/h3>
&lt;p>shelpのbrew tapを作ろうと思って、&lt;a href="https://songmu.jp/riji/entry/2019-02-22-maltmill.html">Songmuさんの記事&lt;/a>を見つけ、&lt;a href="https://github.com/Songmu/maltmill">maltmill&lt;/a>を使ってFormulaを作ろうとしたが、動かなかった。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">$ maltmill new -w progrhyme/shelp
&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>maltmill&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>!!ERROR!!&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> no assets found from latest release
&lt;/code>&lt;/pre>&lt;/div>&lt;p>いまGitHubの最新版は &lt;a href="https://github.com/progrhyme/shelp/releases/tag/v0.5.1-pre-release">https://github.com/progrhyme/shelp/releases/tag/v0.5.1-pre-release&lt;/a>&lt;br>
Assetsはあるんだけどな。&lt;br>
まあ、きっとツールが想定している形式に沿ってないんだろう。&lt;/p>
&lt;p>残念。&lt;/p>
&lt;p>ついでにいうと、Ubuntu 18で作業してたのだけど、brewで入れようとしたらバイナリはdarwinだったから駄目だった。&lt;br>
（この辺はFormula作るときはどうしたらいいんだろう？）&lt;/p>
&lt;p>次に &lt;code>go get&lt;/code> したらビルドがこけ、ghgが手元にあったので、ghgでインストールした。&lt;/p>
&lt;p>関連項目:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/pkg-man/brew/">Software &amp;gt; パッケージ管理 &amp;gt; Homebrew&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="初めてのbrew-formula">初めてのBrew Formula&lt;/h3>
&lt;p>shelpのFormulaを作った。&lt;/p>
&lt;p>だいたいこれ &lt;a href="https://docs.brew.sh/Formula-Cookbook">https://docs.brew.sh/Formula-Cookbook&lt;/a> に沿って作業した。&lt;/p>
&lt;p>他のドキュメント類のリンクは↑のページにメモしてある。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#204a87">cd&lt;/span> &lt;span style="color:#000">$HOMEBREW_PREFIX&lt;/span>/Homebrew/Library/Taps/homebrew/homebrew-core
brew create https://github.com/progrhyme/shelp/archive/v0.5.0.tar.gz
&lt;/code>&lt;/pre>&lt;/div>&lt;p>これで &lt;code>Formula/shelp.rb&lt;/code> に雛形ができる。&lt;/p>
&lt;p>あとは&lt;a href="https://github.com/Homebrew/homebrew-core/blob/master/Formula/peco.rb">pecoのFormula&lt;/a>や、その辺にあったexampleや、リファレンスを読みながらちょこちょこ書き換えた。&lt;/p>
&lt;p>最終的に出来たのがこれ:&lt;/p>
&lt;p>&lt;a href="https://github.com/progrhyme/homebrew-core/blob/db315c00862854800f8f4ee75dd45e70d10c7862/Formula/shelp.rb">https://github.com/progrhyme/homebrew-core/blob/db315c00862854800f8f4ee75dd45e70d10c7862/Formula/shelp.rb&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Ruby" data-lang="Ruby">&lt;span style="color:#204a87;font-weight:bold">class&lt;/span> &lt;span style="color:#000">Shelp&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span> &lt;span style="color:#000">Formula&lt;/span>
&lt;span style="color:#000">desc&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Git-based package manager for shell scripts written in Go&amp;#34;&lt;/span>
&lt;span style="color:#000">homepage&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;https://github.com/progrhyme/shelp&amp;#34;&lt;/span>
&lt;span style="color:#000">url&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;https://github.com/progrhyme/shelp/archive/v0.5.0.tar.gz&amp;#34;&lt;/span>
&lt;span style="color:#000">sha256&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;32ef1a1c0c85cc3fdca607dcc415d3032a9b3b770e6e7d1446c76ccb910c3c6a&amp;#34;&lt;/span>
&lt;span style="color:#000">head&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;https://github.com/progrhyme/shelp.git&amp;#34;&lt;/span>
&lt;span style="color:#000">depends_on&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;go&amp;#34;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&amp;gt;&lt;/span> &lt;span style="color:#4e9a06">:build&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">def&lt;/span> &lt;span style="color:#000">install&lt;/span>
&lt;span style="color:#000">ENV&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;GOPATH&amp;#34;&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">buildpath&lt;/span>
&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">buildpath&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">/&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;src/github.com/progrhyme/shelp&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">.&lt;/span>&lt;span style="color:#000">install&lt;/span> &lt;span style="color:#000">buildpath&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">.&lt;/span>&lt;span style="color:#000">children&lt;/span>
&lt;span style="color:#000">cd&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;src/github.com/progrhyme/shelp&amp;#34;&lt;/span> &lt;span style="color:#204a87;font-weight:bold">do&lt;/span>
&lt;span style="color:#204a87">system&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;go&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;build&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;-o&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">bin&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">/&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;shelp&amp;#34;&lt;/span>
&lt;span style="color:#000">prefix&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">.&lt;/span>&lt;span style="color:#000">install_metafiles&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">end&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">end&lt;/span>
&lt;span style="color:#204a87">test&lt;/span> &lt;span style="color:#204a87;font-weight:bold">do&lt;/span>
&lt;span style="color:#204a87">system&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#4e9a06">#{&lt;/span>&lt;span style="color:#000">bin&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">/shelp&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;--version&amp;#34;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">end&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">end&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>単純にgoでbuildしてインストールする形。&lt;/p>
&lt;h4 id="検証">検証&lt;/h4>
&lt;p>ビルドのチェックを行う。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">brew install --interactive shelp
&lt;/code>&lt;/pre>&lt;/div>&lt;p>こうすると、テンポラリなディレクトリにtarballが展開され、そのディレクトリでシェルが起動する。
ここで、ビルド環境に問題がないかチェックするようだ。&lt;/p>
&lt;p>shelpの場合、goがあればいいので特に問題ない。&lt;/p>
&lt;p>何もせずに &lt;code>exit&lt;/code> した。&lt;/p>
&lt;h4 id="インストールする">インストールする&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">$ brew install --verbose --debug shelp
&lt;span style="color:#000">$HOMEBREW_PREFIX&lt;/span>/Homebrew/Library/Homebrew/brew.rb &lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>Formulary::FormulaLoader&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span>: loading &lt;span style="color:#000">$HOMEBREW_PREFIX&lt;/span>/Homebrew/Library/Taps/homebrew/homebrew-core/Formula/go.rb
&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&amp;gt; Downloading https://github.com/progrhyme/shelp/archive/v0.5.0.tar.gz
/usr/bin/curl --disable --globoff --show-error --user-agent Linuxbrew/2.4.0-41-g0125c4c&lt;span style="color:#4e9a06">\ \(&lt;/span>Linux&lt;span style="color:#4e9a06">\;\ &lt;/span>x86_64&lt;span style="color:#4e9a06">\ &lt;/span>Ubuntu&lt;span style="color:#4e9a06">\ &lt;/span>18.04.4&lt;span style="color:#4e9a06">\ &lt;/span>LTS&lt;span style="color:#4e9a06">\)\ &lt;/span>curl/7.58.0 --retry &lt;span style="color:#0000cf;font-weight:bold">3&lt;/span> --location --silent --head --request GET https://github.com/progrhyme/shelp/archive/v0.5.0.tar.gz
Already downloaded: /home/progrhyme/.cache/Homebrew/downloads/953ed657e86e0d4247c629ba0e66f0a7a0690b35b0122db90d9cf2160b8a6a61--shelp-0.5.0.tar.gz
&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&amp;gt; Verifying 953ed657e86e0d4247c629ba0e66f0a7a0690b35b0122db90d9cf2160b8a6a61--shelp-0.5.0.tar.gz checksum
&lt;span style="color:#000">$HOMEBREW_PREFIX&lt;/span>/Homebrew/Library/Homebrew/build.rb &lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>Formulary::FormulaLoader&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span>: loading &lt;span style="color:#000">$HOMEBREW_PREFIX&lt;/span>/Homebrew/Library/Taps/homebrew/homebrew-core/Formula/go.rb
&lt;span style="color:#000">$HOMEBREW_PREFIX&lt;/span>/Homebrew/Library/Homebrew/build.rb &lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>Formulary::FormulaLoader&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span>: loading &lt;span style="color:#000">$HOMEBREW_PREFIX&lt;/span>/Homebrew/Library/Taps/homebrew/homebrew-core/Formula/gcc.rb
&lt;span style="color:#000">$HOMEBREW_PREFIX&lt;/span>/Homebrew/Library/Homebrew/build.rb &lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>Formulary::FormulaLoader&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span>: loading &lt;span style="color:#000">$HOMEBREW_PREFIX&lt;/span>/Homebrew/Library/Taps/homebrew/homebrew-core/Formula/binutils.rb
&lt;span style="color:#000">$HOMEBREW_PREFIX&lt;/span>/Homebrew/Library/Homebrew/build.rb &lt;span style="color:#ce5c00;font-weight:bold">(&lt;/span>Formulary::FormulaLoader&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span>: loading &lt;span style="color:#000">$HOMEBREW_PREFIX&lt;/span>/Homebrew/Library/Taps/homebrew/homebrew-core/Formula/make.rb
tar xof /home/progrhyme/.cache/Homebrew/downloads/953ed657e86e0d4247c629ba0e66f0a7a0690b35b0122db90d9cf2160b8a6a61--shelp-0.5.0.tar.gz -C /tmp/d20200615-27628-1gx29yu
cp -pR /tmp/d20200615-27628-1gx29yu/shelp-0.5.0/. /tmp/shelp-20200615-27628-1cuvuid/shelp-0.5.0
chmod -Rf +w /tmp/d20200615-27628-1gx29yu
&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&amp;gt; go build -o &lt;span style="color:#000">$HOMEBREW_PREFIX&lt;/span>/Cellar/shelp/0.5.0/bin/shelp
go: downloading github.com/spf13/pflag v1.0.5
go: downloading golang.org/x/crypto v0.0.0-20200604202706-70a84ac30bf9
go: downloading gopkg.in/yaml.v2 v2.3.0
go: downloading golang.org/x/sys v0.0.0-20190412213103-97732733099d
&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&amp;gt; &lt;span style="color:#000">Cleaning&lt;/span>
&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&amp;gt; Fixing &lt;span style="color:#000">$HOMEBREW_PREFIX&lt;/span>/Cellar/shelp/0.5.0/bin/shelp permissions from &lt;span style="color:#0000cf;font-weight:bold">755&lt;/span> to &lt;span style="color:#000">555&lt;/span>
&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&amp;gt; Finishing up
ln -s ../Cellar/shelp/0.5.0/bin/shelp &lt;span style="color:#000">shelp&lt;/span>
&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&amp;gt; Summary
🍺 &lt;span style="color:#000">$HOMEBREW_PREFIX&lt;/span>/Cellar/shelp/0.5.0: &lt;span style="color:#0000cf;font-weight:bold">6&lt;/span> files, 5.1MB, built in &lt;span style="color:#0000cf;font-weight:bold">5&lt;/span> seconds
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="バイナリインストールに対応できていない">バイナリインストールに対応できていない&lt;/h4>
&lt;p>bottleブロックが追加されたら、バイナリインストールにも自動的に対応されるのかな？ とはいえそれには、homebrew-coreに取り込まれなければならない。&lt;/p>
&lt;p>自前のTapでそれをやる方法はまだわかってない。&lt;/p>
&lt;p>&lt;a href="https://github.com/Songmu/homebrew-tap/tree/master/Formula">SongmuさんのFormula&lt;/a>を真似すればいいんだろうけど、最近Ubuntuを使う頻度が多いので、できればmacOS, Linusの両方に対応したい。&lt;/p>
&lt;h3 id="shelpをbrew-tapでインストールできるようにした">shelpをbrew tapでインストールできるようにした&lt;/h3>
&lt;p>上に書いたようにmaltmillが動かなかったので、先ほど作ったFormulaをそのまま使った。&lt;/p>
&lt;p>&lt;a href="https://github.com/progrhyme/homebrew-taps">https://github.com/progrhyme/homebrew-taps&lt;/a>&lt;/p>
&lt;p>このリポジトリを用意して、Songmuさんの記事を参考にして、Formulaを配置した。
実際、やることはこれだけ。&lt;/p>
&lt;p>あとは&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">brew tap progrhyme/taps
brew install shelp
&lt;/code>&lt;/pre>&lt;/div>&lt;p>でOK.&lt;/p>
&lt;h3 id="shelpでbrewによるバイナリインストールに対応">shelpでbrewによるバイナリインストールに対応&lt;/h3>
&lt;p>Ruby APIとCookbookを見ながら頑張って対応した。&lt;br>
Formulaは次のようになった:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Ruby" data-lang="Ruby">&lt;span style="color:#204a87;font-weight:bold">class&lt;/span> &lt;span style="color:#000">Shelp&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span> &lt;span style="color:#000">Formula&lt;/span>
&lt;span style="color:#000">Version&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;0.5.0&amp;#39;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000">OS&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">.&lt;/span>&lt;span style="color:#000">mac?&lt;/span>
&lt;span style="color:#000">Binary&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;shelp_&lt;/span>&lt;span style="color:#4e9a06">#{&lt;/span>&lt;span style="color:#000">Version&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">_darwin_x86_64&amp;#34;&lt;/span>
&lt;span style="color:#000">sha256&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;18665382a6519b59741740cd9edbcc667be3bf99d06fd7d914274a30d5cba889&amp;#34;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">elsif&lt;/span> &lt;span style="color:#000">OS&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">.&lt;/span>&lt;span style="color:#000">linux?&lt;/span>
&lt;span style="color:#000">Binary&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;shelp_&lt;/span>&lt;span style="color:#4e9a06">#{&lt;/span>&lt;span style="color:#000">Version&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">_linux_x86_64&amp;#34;&lt;/span>
&lt;span style="color:#000">sha256&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;7a8797cbd3af61d0cb83b2ee6f8720a208c05e653871d55fee34b837c8f1e8bf&amp;#34;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">end&lt;/span>
&lt;span style="color:#000">url&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;https://github.com/progrhyme/shelp/releases/download/v&lt;/span>&lt;span style="color:#4e9a06">#{&lt;/span>&lt;span style="color:#000">Version&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">/&lt;/span>&lt;span style="color:#4e9a06">#{&lt;/span>&lt;span style="color:#000">Binary&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>
&lt;span style="color:#000">desc&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Git-based package manager for shell scripts written in Go&amp;#34;&lt;/span>
&lt;span style="color:#000">homepage&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;https://github.com/progrhyme/shelp&amp;#34;&lt;/span>
&lt;span style="color:#000">head&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;https://github.com/progrhyme/shelp.git&amp;#34;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">def&lt;/span> &lt;span style="color:#000">install&lt;/span>
&lt;span style="color:#000">bin&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">.&lt;/span>&lt;span style="color:#000">install&lt;/span> &lt;span style="color:#000">Binary&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&amp;gt;&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;shelp&amp;#39;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">end&lt;/span>
&lt;span style="color:#204a87">test&lt;/span> &lt;span style="color:#204a87;font-weight:bold">do&lt;/span>
&lt;span style="color:#204a87">system&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#4e9a06">#{&lt;/span>&lt;span style="color:#000">bin&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">/shelp&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;--version&amp;#39;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">end&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">end&lt;/span>
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>A: 2020 archive</title><link>https://progrhy.me/tech-notes/a/memo/2020/</link><pubDate>Wed, 01 Jan 2020 15:38:43 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/memo/2020/</guid><description/></item><item><title>A: 2018 archive</title><link>https://progrhy.me/tech-notes/a/memo/2018/</link><pubDate>Mon, 01 Jan 2018 16:05:34 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/memo/2018/</guid><description/></item></channel></rss>