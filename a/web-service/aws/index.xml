<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>progrhyme's Tech Notes – Amazon Web Service</title><link>https://progrhy.me/tech-notes/a/web-service/aws/</link><description>Recent content in Amazon Web Service on progrhyme's Tech Notes</description><generator>Hugo -- gohugo.io</generator><language>ja</language><lastBuildDate>Wed, 03 Jun 2020 13:41:40 +0900</lastBuildDate><atom:link href="https://progrhy.me/tech-notes/a/web-service/aws/index.xml" rel="self" type="application/rss+xml"/><item><title>A: AWS CLI</title><link>https://progrhy.me/tech-notes/a/web-service/aws/cli/</link><pubDate>Wed, 03 Jun 2020 13:41:48 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/web-service/aws/cli/</guid><description>
&lt;h2 id="about">About&lt;/h2>
&lt;p>&lt;a href="https://github.com/aws/aws-cli">https://github.com/aws/aws-cli&lt;/a>&lt;/p>
&lt;p>NOTE:&lt;/p>
&lt;ul>
&lt;li>2020-02-12 AWS CLI v2が一般利用可能になった。
&lt;ul>
&lt;li>&lt;a href="https://aws.amazon.com/jp/blogs/news/aws-cli-v2-is-now-generally-available/">AWS CLI v2 が一般利用可能となりました | Amazon Web Services ブログ&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="install">Install&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="http://docs.aws.amazon.com/ja_jp/cli/latest/userguide/installing.html" title="AWS Command Line Interface のインストール - AWS Command Line Interface">AWS Command Line Interface のインストール - AWS Command Line Interface&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="macos">macOS&lt;/h3>
&lt;ul>
&lt;li>公式ガイド: &lt;a href="https://docs.aws.amazon.com/ja_jp/cli/latest/userguide/install-cliv2-mac.html">macOS での AWS CLI バージョン 2 のインストール - AWS Command Line Interface&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>※2020-06-03 Homebrewでv2が入るが、なぜかpythonに依存している。&lt;br>
&lt;a href="https://formulae.brew.sh/formula/awscli">https://formulae.brew.sh/formula/awscli&lt;/a>&lt;/p>
&lt;h2 id="dockerイメージ">Dockerイメージ&lt;/h2>
&lt;p>※過去の記述である&lt;/p>
&lt;p>&lt;a href="https://hub.docker.com/r/mesosphere/aws-cli/">https://hub.docker.com/r/mesosphere/aws-cli/&lt;/a> がちゃんとしてそう。&lt;/p>
&lt;h2 id="reference">Reference&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/index.html">aws — AWS CLI 2 Command Reference&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/cli/latest/reference/">aws — AWS CLI 1 Command Reference&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>※以下、古いWikiの内容をマイグレートしたので、v1の情報が元になっているものが多い。&lt;/p>
&lt;h3 id="configure">configure&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># credential等がちゃんと設定されてるか確認&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws configure list
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://aws.amazon.com/jp/premiumsupport/knowledge-center/s3-locate-credentials-error/">S3 バケットの「認証情報が見つかりません」エラーを修正する&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="ecs">ecs&lt;/h3>
&lt;p>&lt;a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ecs/">https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ecs/&lt;/a>&lt;/p>
&lt;h4 id="update-service">update-service&lt;/h4>
&lt;p>&lt;a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ecs/update-service.html">https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ecs/update-service.html&lt;/a>&lt;/p>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># タスク定義を更新&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws ecs update-service --cluster &lt;span style="color:#000">$CLUSTER&lt;/span> --service &lt;span style="color:#000">$SERVICE&lt;/span> --task-definition &lt;span style="color:#000">$TASK_DEFINITION&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># サービス定義を更新せずに再起動&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws ecs update-service --cluster &lt;span style="color:#000">$CLUSTER&lt;/span> --service &lt;span style="color:#000">$SERVICE&lt;/span> --force-new-deployment
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="logs">logs&lt;/h3>
&lt;p>&lt;a href="http://docs.aws.amazon.com/cli/latest/reference/logs/index.html">http://docs.aws.amazon.com/cli/latest/reference/logs/index.html&lt;/a>&lt;/p>
&lt;p>CloudWatch Logs.&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://docs.aws.amazon.com/cli/latest/reference/logs/get-log-events.html">http://docs.aws.amazon.com/cli/latest/reference/logs/get-log-events.html&lt;/a>
&lt;ul>
&lt;li>&lt;code>--start-time&lt;/code>, &lt;code>--end-time&lt;/code> の引数はミリ秒単位のunixtime&lt;/li>
&lt;li>&lt;code>--limit&lt;/code> は10000が上限で、より大きな値を指定するとバリデーションエラーになる。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 2017/12/20 8:50 - 9:10のログを取得&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ date +%s -d &lt;span style="color:#4e9a06">&amp;#34;2017-12-20 08:50:00&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#0000cf;font-weight:bold">1513727400&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ date +%s -d &lt;span style="color:#4e9a06">&amp;#34;2017-12-20 09:10:00&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#0000cf;font-weight:bold">1513728600&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ aws logs get-log-events &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --log-group-name &amp;lt;your-log-group&amp;gt; --log-stream-name &amp;lt;your-log-stream&amp;gt; &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --start-time &lt;span style="color:#0000cf;font-weight:bold">1513727400000&lt;/span> --end-time &lt;span style="color:#0000cf;font-weight:bold">1513728600000&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>--output text&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="create-log-group">create-log-group&lt;/h4>
&lt;p>&lt;a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/logs/create-log-group.html">https://awscli.amazonaws.com/v2/documentation/api/latest/reference/logs/create-log-group.html&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>aws logs create-log-group --log-group-name &amp;lt;value&amp;gt; &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>OPTIONS&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="describe-log-groups">describe-log-groups&lt;/h4>
&lt;p>&lt;a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/logs/describe-log-groups.html">https://awscli.amazonaws.com/v2/documentation/api/latest/reference/logs/describe-log-groups.html&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>aws logs describe-log-groups &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>OPTIONS&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="sns">sns&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/cli/latest/reference/sns/">https://docs.aws.amazon.com/cli/latest/reference/sns/&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/cli/latest/reference/sns/publish.html">https://docs.aws.amazon.com/cli/latest/reference/sns/publish.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># テキストファイルの内容を送信&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws sns publish --topic-arn &lt;span style="color:#4e9a06">&amp;#34;arn:aws:sns:ap-northeast-1:&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">AWS_ACCOUNT_ID&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">:&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">topic&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span> --subject &lt;span style="color:#4e9a06">&amp;#34;my sns notification&amp;#34;&lt;/span> --message file://path/to/message-file
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># コマンドの実行結果を送信&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws sns publish --topic-arn &lt;span style="color:#4e9a06">&amp;#34;arn:aws:sns:ap-northeast-1:&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">AWS_ACCOUNT_ID&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">:&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">topic&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span> --message &lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>cat path/to/file&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ssm">ssm&lt;/h3>
&lt;p>&lt;a href="http://docs.aws.amazon.com/cli/latest/reference/ssm/index.html">http://docs.aws.amazon.com/cli/latest/reference/ssm/index.html&lt;/a>&lt;/p>
&lt;p>Parameter Store:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://docs.aws.amazon.com/cli/latest/reference/ssm/get-parameter.html">http://docs.aws.amazon.com/cli/latest/reference/ssm/get-parameter.html&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://docs.aws.amazon.com/cli/latest/reference/ssm/get-parameters.html">http://docs.aws.amazon.com/cli/latest/reference/ssm/get-parameters.html&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://docs.aws.amazon.com/cli/latest/reference/ssm/put-parameter.html">http://docs.aws.amazon.com/cli/latest/reference/ssm/put-parameter.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="sts">sts&lt;/h3>
&lt;p>SYNOPSIS:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 現在のAWSアカウントや利用しているIAMの情報を表示する&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aws sts get-caller-identity
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://dev.classmethod.jp/articles/get-aws-account-id-with-get-caller-identity/">【小ネタ】AWS CLIでAWS Account IDが取れるようになりました！ | Developers.IO&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: ECS</title><link>https://progrhy.me/tech-notes/a/web-service/aws/ecs/</link><pubDate>Wed, 08 Jul 2020 23:08:55 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/web-service/aws/ecs/</guid><description>
&lt;p>EC2インスタンスをホストとしてDockerコンテナを容易にクラスタリング・サービス化する。タスクランナーとしても使える。&lt;/p>
&lt;h2 id="getting-started">Getting Started&lt;/h2>
&lt;ul>
&lt;li>ドキュメント: &lt;a href="http://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/Welcome.html">http://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/Welcome.html&lt;/a>&lt;/li>
&lt;li>最新AMI: &lt;a href="http://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/ecs-optimized_AMI.html">http://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/ecs-optimized_AMI.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="仕様">仕様&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="http://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/task_life_cycle.html">タスクのライフサイクル - Amazon EC2 Container Service&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/ecs_cwe_events.html" title="Amazon ECS イベント - Amazon Elastic Container Service">Amazon ECS イベント - Amazon Elastic Container Service&lt;/a>
&lt;ul>
&lt;li>コンテナインスタンスやタスクの状態変更イベント&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="タスク定義">タスク定義&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/task_definitions.html">https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/task_definitions.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="タスク定義パラメーター">タスク定義パラメーター&lt;/h4>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/task_definition_parameters.html">タスク定義パラメーター - Amazon Elastic Container Service&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>以下のようなものがある:&lt;/p>
&lt;ul>
&lt;li>&lt;code>volumesFrom&lt;/code> &amp;hellip; &lt;code>docker run&lt;/code> の &lt;code>--volumes-from&lt;/code> オプションに相当。&lt;/li>
&lt;/ul>
&lt;h3 id="サービス">サービス&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/service-load-balancing.html#load-balancing-concepts" title="サービスロードバランシング - Amazon Elastic Container Service">サービスロードバランシング - Amazon Elastic Container Service&lt;/a>
&lt;ul>
&lt;li>1つのサービスに紐付けられるLBは1つだけ。複数ポートをサーブしたい場合は、サービスを分ける必要がある。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/task-placement-strategies.html" title="Amazon ECS タスク配置戦略 - Amazon Elastic Container Service">Amazon ECS タスク配置戦略 - Amazon Elastic Container Service&lt;/a>
&lt;ul>
&lt;li>タスクをどう配置するか。AZ間で分散する、利用インスタンス数を最小にするなど選べる。&lt;/li>
&lt;li>ECSサービスでは作成時に選択する。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>Tips:&lt;/p>
&lt;ul>
&lt;li>ECSをタスクランナーとして使うときも、サービスを作っておくとタスク定義をテンプレート的に使い回せるので便利&lt;/li>
&lt;li>「Run more like this」で環境変数など上書きしたタスクを実行することが可能&lt;/li>
&lt;/ul>
&lt;h2 id="features">Features&lt;/h2>
&lt;h3 id="動的ポートを使ってalbからロードバランス">動的ポートを使ってALBからロードバランス&lt;/h3>
&lt;p>&lt;code>docker run&lt;/code> の &lt;code>-P&lt;/code> オプションに相当するポートマッピング方式で、ホスト側の任意のエフェメラルポートにコンテナのポートがマッピングされる。&lt;/p>
&lt;p>これによってALBからロードバランスすることができる。&lt;/p>
&lt;p>これを使うとECSホストとなるインスタンスが1台しかいなくても、コンテナをローリング更新できる。&lt;/p>
&lt;p>固定ポート方式だと、ホスト側のポートが被るので新しいコンテナをデプロイできない。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://dev.classmethod.jp/cloud/ecs-elb-recipes/" title="Amazon ECSのELB構成パターンまとめ(ALB対応) ｜ Developers.IO">Amazon ECSのELB構成パターンまとめ(ALB対応) ｜ Developers.IO&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/taishin/items/eb759a8ec0c583fc5ebd" title="Dockerコンテナの作成からECSの動的ポート＋ALBでロードバランスするまで【cloudpack大阪ブログ】 - Qiita">Dockerコンテナの作成からECSの動的ポート＋ALBでロードバランスするまで【cloudpack大阪ブログ】 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="service-auto-scaling">Service Auto Scaling&lt;/h3>
&lt;p>コンテナの数を機械的にスケールさせたい場合、クラスタインスタンスのAuto Scalingとは別にService Auto Scalingを設定する必要がある。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/service-auto-scaling.html" title="サービスの Auto Scaling - Amazon Elastic Container Service">サービスの Auto Scaling - Amazon Elastic Container Service&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://aws.amazon.com/jp/blogs/news/automatic-scaling-with-amazon-ecs/">Amazon ECSでAuto Scaling | Amazon Web Services ブログ&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://christina04.hatenablog.com/entry/2017/10/19/190000">ECSのオートスケール戦略 - Carpe Diem&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="cloudwatch-logs連携">CloudWatch Logs連携&lt;/h3>
&lt;p>Logging Driverとしてawslogsを使うことでCloudWatch Logsにログ収集できる。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/using_cloudwatch_logs.html" title="コンテナインスタンスでの CloudWatch Logs の使用 - Amazon Elastic Container Service">コンテナインスタンスでの CloudWatch Logs の使用 - Amazon Elastic Container Service&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="cloudwatch-event">CloudWatch Event&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="http://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/ecs_cwe_events.html" title="Amazon ECS イベント - Amazon Elastic Container Service">Amazon ECS イベント - Amazon Elastic Container Service&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>以下のようなイベントをCloudWatch Eventでトリガにすることができる:&lt;/p>
&lt;ul>
&lt;li>コンテナの状態変化&lt;/li>
&lt;li>タスクの状態変化&lt;/li>
&lt;li>:&lt;/li>
&lt;/ul>
&lt;h2 id="ノウハウ">ノウハウ&lt;/h2>
&lt;h3 id="タスクの異常終了を監視する">タスクの異常終了を監視する&lt;/h3>
&lt;p>上述のCloudWatch EventでLambdaを呼び出し、Lambda側で &lt;code>lastStatus&lt;/code> や &lt;code>exitCode&lt;/code> を判別すれば良い。&lt;/p>
&lt;p>TODO: コードサンプルを書く。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://aws.amazon.com/jp/blogs/news/monitor-cluster-state-with-amazon-ecs-event-stream/" title="Amazon ECSイベントストリームで、クラスタの状態を監視 | Amazon Web Services ブログ">Amazon ECSイベントストリームで、クラスタの状態を監視 | Amazon Web Services ブログ&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="デバッグ出力の有効化">デバッグ出力の有効化&lt;/h3>
&lt;p>&lt;a href="http://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/docker-debug-mode.html">http://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/docker-debug-mode.html&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>$ sudo vi /etc/sysconfig/docker
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">## OPTIONSに下のように&amp;#34;-D&amp;#34;を足す。&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">OPTIONS&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;-D --default-ulimit nofile=1024:4096&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo service docker restart
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$ sudo start ecs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ebs-dockerボリュームの変更">EBS Dockerボリュームの変更&lt;/h3>
&lt;p>デフォルト22Gなのだが、ワークロードが高い場合、Burst Balanceを使い切る可能性がある。&lt;br>
ボリュームを拡張しておくことでキャパシティを上げることができるが、変えたい場合はEC2作成時やLaunch Configurationで変える必要がある。&lt;/p>
&lt;p>デバイス名 &lt;code>/dev/xvdcz&lt;/code> のボリュームを変えれば良い。&lt;/p>
&lt;p>Terraformの場合、 &lt;a href="https://www.terraform.io/docs/providers/aws/r/launch_configuration.html">aws_launch_configuration&lt;/a> resourceの &lt;code>ebs_block_device&lt;/code> ブロックで設定する。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Terraform" data-lang="Terraform">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">resource&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;aws_launch_configuration&amp;#34;&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;my_ecs_launch_config&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000">ebs_block_device&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c4a000">device_name&lt;/span> = &lt;span style="color:#4e9a06">&amp;#34;/dev/xvdcz&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c4a000">volume_type&lt;/span> = &lt;span style="color:#4e9a06">&amp;#34;gp2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c4a000">volume_size&lt;/span> = &lt;span style="color:#0000cf;font-weight:bold">50&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/EBSVolumeTypes.html" title="Amazon EBS ボリュームの種類 - Amazon Elastic Compute Cloud">Amazon EBS ボリュームの種類 - Amazon Elastic Compute Cloud&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="ecsログコレクター">ECSログコレクター&lt;/h3>
&lt;p>&lt;a href="http://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/ecs-logs-collector.html">http://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/ecs-logs-collector.html&lt;/a>&lt;/p>
&lt;p>このスクリプトでインスタンスのログを集めて、診断に役立つようにAWSサポートと共有できるそうだ。&lt;/p>
&lt;h3 id="タスクイメージのクリーンアップ設定">タスク・イメージのクリーンアップ設定&lt;/h3>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://dev.classmethod.jp/cloud/ecs-auto-cleanup/">Amazon ECSでタスク/イメージの自動クリーンアップが有効になりました ｜ Developers.IO&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="how-to">How-to&lt;/h2>
&lt;h3 id="iam設定">IAM設定&lt;/h3>
&lt;p>Terraformとかで構築してると、IAM設定がよくわからなくて気が狂いそうになる。&lt;br>
1回動くと満足するが、次やるときにはやり方を忘れている。&lt;/p>
&lt;ul>
&lt;li>ECSサービスに設定するIAMロール
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/service_IAM_role.html">Amazon ECS サービススケジューラ IAM ロール - Amazon Elastic Container Service&lt;/a>&lt;/li>
&lt;li>2019年1月現在は、指定しなくても勝手にAWSがマネージドなIAMロールを設定してくれるはず。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ECSタスク実行IAMロール
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/task_execution_IAM_role.html">Amazon ECS タスク実行 IAM ロール - Amazon Elastic Container Service&lt;/a>&lt;/li>
&lt;li>AssumeRoleで &lt;code>Service: ecs-tasks.amazonaws.com&lt;/code> を許可する&lt;/li>
&lt;li>IAMポリシーはマネージドなのがあるので、それをロールにアタッチすればよい&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="クラスタ更新">クラスタ更新&lt;/h3>
&lt;p>やり方:&lt;/p>
&lt;ul>
&lt;li>Terraform&lt;/li>
&lt;li>&lt;a href="https://github.com/silinternational/ecs-deploy/blob/develop/ecs-deploy">ecs-deploy&lt;/a>
&lt;ul>
&lt;li>AWS CLIとjqを使ってシェルスクリプトで実装された便利ツール&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://kakakakakku.hatenablog.com/entry/2017/04/27/105327">CircleCI + ecs-deploy で ECS にデプロイをする - kakakakakku blog&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="プライベートレジストリを使う">プライベートレジストリを使う&lt;/h3>
&lt;p>See &lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/private-auth.html" title="プライベートレジストリの認証 - Amazon Elastic Container Service">プライベートレジストリの認証 - Amazon Elastic Container Service&lt;/a>&lt;/p>
&lt;h3 id="インスタンスをクラスタから外す">インスタンスをクラスタから外す&lt;/h3>
&lt;p>一時的に外したい場合。&lt;/p>
&lt;ul>
&lt;li>AutoScaling Groupからデタッチ
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/autoscaling/latest/userguide/detach-instance-asg.html">https://docs.aws.amazon.com/ja_jp/autoscaling/latest/userguide/detach-instance-asg.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ECSクラスタからインスタンスを外す
&lt;ul>
&lt;li>Drainingに変えれば良いと思う&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="インスタンスを減らす">インスタンスを減らす&lt;/h3>
&lt;p>↑の操作は安全だが、台数を減らすのは難しい。&lt;br>
というのはAutoScaling Groupでインスタンスの設定数を減らすことになるのだが、このときどのインスタンスが落とされるかを制御できないからだ。&lt;/p>
&lt;p>このときはAutoScaling Groupのライフサイクルフックを設定するのが王道のようだ。&lt;/p>
&lt;p>または、落とされたくないインスタンスを保護するという手もある。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://stackoverflow.com/questions/45020323/ecs-asg-scaling-down-policy-recommendations/45036485#45036485">amazon web services - ECS ASG scaling down policy recommendations - Stack Overflow&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://aws.amazon.com/jp/blogs/news/how-to-automate-container-instance-draining-in-amazon-ecs/" title="Amazon ECS におけるコンテナ インスタンス ドレイニングの自動化方法 | Amazon Web Services ブログ">Amazon ECS におけるコンテナ インスタンス ドレイニングの自動化方法 | Amazon Web Services ブログ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/lifecycle-hooks.html" title="Amazon EC2 Auto Scaling ライフサイクルフック - Amazon EC2 Auto Scaling (日本語)">Amazon EC2 Auto Scaling ライフサイクルフック - Amazon EC2 Auto Scaling (日本語)&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="コンテナ間でのデータボリュームの共有">コンテナ間でのデータボリュームの共有&lt;/h3>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://hatappi.hateblo.jp/entry/2017/05/12/175933">ECSでコンテナインスタンス間でデータボリュームを同期したい時 - hatappi.blog&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="参考">参考&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/naomichi-y/items/d933867127f27524686a">ECS運用のノウハウ - Qiita&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: EKS</title><link>https://progrhy.me/tech-notes/a/web-service/aws/eks/</link><pubDate>Tue, 07 Jun 2022 16:43:46 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/web-service/aws/eks/</guid><description>
&lt;h2 id="about">About&lt;/h2>
&lt;p>Amazon Elastic Kubernetes Service&lt;/p>
&lt;h2 id="公式ドキュメント">公式ドキュメント&lt;/h2>
&lt;p>&lt;a href="https://docs.aws.amazon.com/ja_jp/eks/index.html">https://docs.aws.amazon.com/ja_jp/eks/index.html&lt;/a>&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/eks/latest/userguide/what-is-eks.html">ユーザーズガイド&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/eks/latest/APIReference/Welcome.html">APIリファレンス&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="仕様">仕様&lt;/h2>
&lt;h3 id="コンテナランタイム">コンテナランタイム&lt;/h3>
&lt;p>2022-06-08現在の情報。&lt;/p>
&lt;ul>
&lt;li>ランタイムとしてcontainerd, Dockerがサポートされている&lt;/li>
&lt;li>EKS 1.21のデフォルトはDockerとなっている&lt;/li>
&lt;li>EKS 1.20以降ではDockerは非推奨となっている&lt;/li>
&lt;li>EKS 1.23でDockershimは削除される予定&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://aws.amazon.com/blogs/containers/amazon-eks-now-supports-kubernetes-1-22/">Amazon EKS now supports Kubernetes 1.22 | Containers&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://aws.amazon.com/jp/blogs/news/amazon-eks-1-21-released/">Amazon EKS が Kubernetes 1.21 のサポートを開始 | Amazon Web Services ブログ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://tech.drecom.co.jp/eks-deprecates-docker/">EKSでdocker非推奨問題に対応しました - Tech Inside Drecom&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://eksctl.io/usage/container-runtime/">Define Container Runtime - eksctl&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ツール">ツール&lt;/h2>
&lt;h3 id="eksctl">eksctl&lt;/h3>
&lt;p>&lt;a href="https://eksctl.io/">https://eksctl.io/&lt;/a>&lt;/p>
&lt;p>公式CLI。&lt;/p></description></item><item><title>A: RDS</title><link>https://progrhy.me/tech-notes/a/web-service/aws/rds/</link><pubDate>Wed, 16 Sep 2020 13:09:11 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/web-service/aws/rds/</guid><description>
&lt;h2 id="仕様">仕様&lt;/h2>
&lt;h3 id="パラメータ">パラメータ&lt;/h3>
&lt;ul>
&lt;li>Aurora PostgreSQL
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/AuroraPostgreSQL.Reference.html">https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/AuroraPostgreSQL.Reference.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="管理ユーザ">管理ユーザ&lt;/h3>
&lt;p>&lt;code>rdsadmin&lt;/code> という管理ユーザが作られるが、ユーザは操作不能。&lt;br>
より弱い権限のユーザで作業することになる。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/CHAP_MySQL.html">https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/CHAP_MySQL.html&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/AuroraPostgreSQL.Security.html">https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/AuroraPostgreSQL.Security.html&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://pgsqldeepdive.blogspot.com/2013/11/rds-for-postgresql.html">PostgreSQL Deep Dive: RDS for PostgreSQLの中を覗いてみた（追記あり）&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="features">Features&lt;/h2>
&lt;h3 id="拡張モニタリング">拡張モニタリング&lt;/h3>
&lt;p>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_Monitoring.OS.html">https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_Monitoring.OS.html&lt;/a>&lt;/p>
&lt;ul>
&lt;li>IAM設定が必要&lt;/li>
&lt;/ul>
&lt;h3 id="maintenance-api">Maintenance API&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/APIReference/API_DescribePendingMaintenanceActions.html">https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/APIReference/API_DescribePendingMaintenanceActions.html&lt;/a>
&lt;ul>
&lt;li>未適用のメンテナンス情報取得&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="イベント通知">イベント通知&lt;/h3>
&lt;p>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_Events.html" title="Amazon RDS イベント通知の使用 - Amazon Relational Database Service">Amazon RDS イベント通知の使用 - Amazon Relational Database Service&lt;/a>&lt;/p>
&lt;p>RDSに関する様々なイベントの通知をSNSで受け取ることができる。&lt;/p>
&lt;h2 id="topics">Topics&lt;/h2>
&lt;h3 id="メンテナンス情報の通知">メンテナンス情報の通知&lt;/h3>
&lt;p>RDSではセキュリティアップデートなどで再起動される場合にアカウントのメールアドレスに通知してくれない。&lt;/p>
&lt;p>ので、DescribePendingMaintenanceActions APIを叩いて、未適用のメンテナンス情報を取得するのが良さそう。&lt;br>
イベント通知機能ではメンテナンスが起こったことは取得できるが、事前通知はしてくれない。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://blog.jicoman.info/2017/01/rds_maintenance/" title="Amazon RDSのメンテナンスについて調べてみた | 本日も乙">Amazon RDSのメンテナンスについて調べてみた | 本日も乙&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_UpgradeDBInstance.Maintenance.html" title="Amazon RDS メンテナンス - Amazon Relational Database Service">Amazon RDS メンテナンス - Amazon Relational Database Service&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="mysql">MySQL&lt;/h2>
&lt;h3 id="ストアドプロシージャ">ストアドプロシージャ&lt;/h3>
&lt;p>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/Appendix.MySQL.SQLRef.html">MySQL RDSインスタンスで利用できるシステムストアドプロシージャのリファレンス&lt;/a>&lt;/p>
&lt;h4 id="mysqlrds_show_configuration">mysql.rds_show_configuration&lt;/h4>
&lt;p>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/mysql_rds_show_configuration.html">https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/mysql_rds_show_configuration.html&lt;/a>&lt;/p>
&lt;p>バイナリログを保持する時間数を表示する。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">CALL&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">mysql&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">rds_show_configuration&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="postgresql">PostgreSQL&lt;/h2>
&lt;p>ログの保持期間:&lt;/p>
&lt;ul>
&lt;li>DBパラメータグループの &lt;code>rds.log_retention_period&lt;/code> で設定する。分単位。デフォルトは &lt;code>4320&lt;/code> (3日分).&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/USER_LogAccess.Concepts.PostgreSQL.html">PostgreSQL データベースのログファイル - Amazon Relational Database Service&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="how-to">How-to&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/Appendix.PostgreSQL.CommonDBATasks.html">PostgreSQL の一般的な DBA タスク - Amazon Relational Database Service&lt;/a>
&lt;ul>
&lt;li>pg_repackの利用&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="aurora">Aurora&lt;/h2>
&lt;h3 id="getting-started">Getting Started&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="http://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/Aurora.Overview.html" title="Amazon Aurora の概要 - Amazon Relational Database Service">Amazon Aurora の概要 - Amazon Relational Database Service&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="監視">監視&lt;/h3>
&lt;h4 id="cloudwatchメトリクス">CloudWatchメトリクス&lt;/h4>
&lt;p>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/Aurora.Monitoring.html">https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/Aurora.Monitoring.html&lt;/a>&lt;/p>
&lt;p>AWS/RDS&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>メトリクス&lt;/th>
&lt;th>説明&lt;/th>
&lt;th>Applies to&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>FreeLocalStorage&lt;/td>
&lt;td>一時テーブルやログで使用可能なストレージ容量。インスタンスタイプごとに上限値が決まっているようだ。&lt;/td>
&lt;td>MySQL, PostgreSQL&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>VolumeBytesUsed&lt;/td>
&lt;td>使用されたストレージ容量(Byte)&lt;/td>
&lt;td>MySQL, PostgreSQL&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="フェールオーバー">フェールオーバー&lt;/h3>
&lt;p>&lt;code>tier0 &amp;gt; tier1 &amp;gt; ... &amp;gt; tier15&lt;/code> と優先順位が設定できる。&lt;/p>
&lt;p>異なるインスタンスタイプのレプリカを立ち上げてフェールオーバーさせることが簡単にできるみたい。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://dev.classmethod.jp/cloud/aws/amazon-aurora-failover-order/" title="[新機能]RDS for Auroraでフェイルオーバー先の優先順序を指定できます ｜ Developers.IO">[新機能]RDS for Auroraでフェイルオーバー先の優先順序を指定できます ｜ Developers.IO&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://dev.classmethod.jp/cloud/aws/aurora-changed-failover/" title="Auroraのインスタンスタイプ変更をフェイルオーバで行ってみた ｜ Developers.IO">Auroraのインスタンスタイプ変更をフェイルオーバで行ってみた ｜ Developers.IO&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="tips">Tips&lt;/h3>
&lt;h4 id="temporary-diskのサイズがインスタンスサイズに比例">temporary diskのサイズがインスタンスサイズに比例&lt;/h4>
&lt;p>2019-08-01時点で非公開仕様らしい。&lt;br>
実用上ネックになり得るのでスケールダウン時には要注意。&lt;/p>
&lt;h3 id="topics-1">Topics&lt;/h3>
&lt;h4 id="auroraは1インスタンスでも可用性高い">Auroraは1インスタンスでも可用性高い&lt;/h4>
&lt;ul>
&lt;li>ダウンタイムは10分ぐらいとか
&lt;ul>
&lt;li>&lt;a href="http://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/UserGuide/Aurora.Managing.html" title="Amazon Aurora DB クラスターの管理 - Amazon Relational Database Service">Amazon Aurora DB クラスターの管理 - Amazon Relational Database Service&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://aws.amazon.com/jp/rds/details/multi-az/">https://aws.amazon.com/jp/rds/details/multi-az/&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://dev.classmethod.jp/cloud/aws/decision-method-for-aurora-multiaz/" title="ちょっと待って！Auroraを使う時にMulti-AZが本当に必要ですか？ ｜ Developers.IO">ちょっと待って！Auroraを使う時にMulti-AZが本当に必要ですか？ ｜ Developers.IO&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>