<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>progrhyme's Tech Notes – AWK</title><link>https://progrhy.me/tech-notes/a/cli/awk/</link><description>Recent content in AWK on progrhyme's Tech Notes</description><generator>Hugo -- gohugo.io</generator><language>ja</language><lastBuildDate>Tue, 23 Jun 2020 22:49:24 +0900</lastBuildDate><atom:link href="https://progrhy.me/tech-notes/a/cli/awk/index.xml" rel="self" type="application/rss+xml"/><item><title>A: 言語仕様</title><link>https://progrhy.me/tech-notes/a/cli/awk/spec/</link><pubDate>Tue, 21 Jul 2020 00:20:42 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/cli/awk/spec/</guid><description>
&lt;p>主にPOSIX仕様について記すが、今のところググった結果を貼り付けたものも混ざっている。&lt;/p>
&lt;h2 id="specs">Specs&lt;/h2>
&lt;p>下に記載のないもの。&lt;/p>
&lt;ul>
&lt;li>ユーザ定義関数
&lt;ul>
&lt;li>&lt;a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/awk.html#tag_20_06_13_15">awk - POSIX#User-Defined Functions&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="演算子">演算子&lt;/h2>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://aoki2.si.gunma-u.ac.jp/Hanasi/Algo/letsawk/WhatIsOperator.html">Let&amp;rsquo;s AWK - aoki2.si.gunma-u.ac.jp&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="patterns">Patterns&lt;/h2>
&lt;p>&lt;a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/awk.html#tag_20_06_13_05">awk - POSIX#Patterns&lt;/a>&lt;/p>
&lt;p>AWKの基本構文である &lt;code>&amp;lt;pattern&amp;gt; { &amp;lt;action&amp;gt; }&lt;/code> の &lt;code>&amp;lt;pattern&amp;gt;&lt;/code> について。&lt;/p>
&lt;p>種類:&lt;/p>
&lt;ul>
&lt;li>単一のパターン&lt;/li>
&lt;li>2つのパターンを &lt;code>PATTERN1,PATTERN2&lt;/code> のようにカンマ区切りで記したレンジ&lt;/li>
&lt;li>特殊パターン: &lt;code>BEGIN&lt;/code>, &lt;code>END&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="expression-patterns">Expression Patterns&lt;/h3>
&lt;p>Booleanコンテキストで評価できる任意の表現を利用できる。&lt;br>
（レコードが）真と評価されればマッチしたと見なされ、アクションが実行される。&lt;/p>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-AWK" data-lang="AWK">&lt;span style="color:#204a87">NR&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">3&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#8f5902;font-style:italic"># 1-2行目にマッチ&lt;/span>
&lt;span style="color:#204a87">NR&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">%&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">2&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#8f5902;font-style:italic"># 偶数行にマッチ&lt;/span>
&lt;span style="color:#ce5c00;font-weight:bold">$&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;F&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#8f5902;font-style:italic"># 第2フィールドが &amp;#39;F&amp;#39; だったらマッチ&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="pattern-ranges">Pattern Ranges&lt;/h3>
&lt;p>2つの評価式をカンマ区切りで記すことでレンジを表現する。&lt;/p>
&lt;ul>
&lt;li>1つ目の条件にマッチした後、2つ目の条件にマッチするまでアクションが実行される&lt;/li>
&lt;li>両端のレコード（1つ目と2つ目の条件に最初にマッチした行）もアクションの対象となる&lt;/li>
&lt;/ul>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-AWK" data-lang="AWK">&lt;span style="color:#204a87">NR&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#204a87">NR&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">5&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#8f5902;font-style:italic"># 2-5行目にマッチ&lt;/span>
&lt;span style="color:#204a87">NR&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">==&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">3&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#4e9a06">/^$/&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000;font-weight:bold">...&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#8f5902;font-style:italic"># 3行目から最初の空行までマッチ&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="制御構文">制御構文&lt;/h2>
&lt;p>リファレンス:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/awk.html#tag_20_06_13_02">awk#Expressions in awk&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/awk.html#tag_20_06_13_09">awk#Actions&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>if, elseのサンプル:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-awk" data-lang="awk">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">a&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#000">b&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">||&lt;/span> &lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># ...&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#204a87;font-weight:bold">else&lt;/span> &lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">$&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">~&lt;/span> &lt;span style="color:#4e9a06">/foo/&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># ...&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#204a87;font-weight:bold">else&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># ...&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>その他使える構文:&lt;/p>
&lt;ul>
&lt;li>for&lt;/li>
&lt;li>while, do &amp;hellip; while&lt;/li>
&lt;/ul>
&lt;p>Spec:&lt;/p>
&lt;ul>
&lt;li>制御構文（break, continue含む）はC言語に由来している
&lt;ul>
&lt;li>See &lt;a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap01.html#tag_17_01_02">Introduction#Concepts Derived from the ISO C Standard&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>真偽判定:
&lt;ul>
&lt;li>数値の場合、0は偽、他は真&lt;/li>
&lt;li>文字の場合、ヌル文字は偽、他は真&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>if, else等で実行される文が単文の場合、中括弧は省略可&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://it-ojisan.tokyo/awk-if/">awkのif文のサンプルコード | ITを使っていこう&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="actions">Actions&lt;/h2>
&lt;p>&lt;a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/awk.html#tag_20_06_13_09">awk - POSIX#Actions&lt;/a>&lt;/p>
&lt;h3 id="next">next&lt;/h3>
&lt;p>以降の処理を全て破棄して、次のレコードを処理する。&lt;br>
他言語でもよくあるループ構文の &lt;code>next&lt;/code> に似ている。&lt;/p>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-AWK" data-lang="AWK">&lt;span style="color:#204a87">NR&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">3&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">next&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#8f5902;font-style:italic"># 1-2行目は処理しない&lt;/span>
&lt;span style="color:#4e9a06">/^#/&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">sub&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;^# ?&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span> &lt;span style="color:#204a87;font-weight:bold">print&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#000">next&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#8f5902;font-style:italic"># &amp;#34;^# ?&amp;#34; を取り除いて出力し、次のレコードへ&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">exit&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#8f5902;font-style:italic"># /^#/ にマッチしなくなったら終了&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="exit">exit&lt;/h3>
&lt;p>ループ処理を中断してENDブロックに飛ぶ。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/kaw/items/329b524336e1400828b0">[awk] exit文でawkの実行処理を終了 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="文字列関数">文字列関数&lt;/h2>
&lt;p>&lt;a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/awk.html#tag_20_06_13_13">awk - POSIX#String Functions&lt;/a>&lt;/p>
&lt;p>Tips:&lt;/p>
&lt;ul>
&lt;li>関数引数が &lt;code>$0&lt;/code> のときは省略できることが多いようだ&lt;/li>
&lt;/ul>
&lt;h3 id="sub-gsub">sub, gsub&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-awk" data-lang="awk">&lt;span style="color:#204a87;font-weight:bold">sub&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ere&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">repl&lt;/span>&lt;span style="color:#000;font-weight:bold">[,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">in&lt;/span>&lt;span style="color:#000;font-weight:bold">])&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">gsub&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ere&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">repl&lt;/span>&lt;span style="color:#000;font-weight:bold">[,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">in&lt;/span>&lt;span style="color:#000;font-weight:bold">])&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>文字列置換を行う。&lt;br>
in中のereという正規表現パターンをreplに置換する。&lt;br>
repl内では &lt;code>&amp;amp;&lt;/code> でマッチした文字列を参照できるみたい。&lt;br>
inを省略した時には &lt;code>$0&lt;/code> が対象になる。&lt;/p>
&lt;p>subは最初に出現したパターンを1回だけ置換。&lt;br>
gsubは出現した全パターンに置換を適用する。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://it-ojisan.tokyo/awk-gsub/">awkの文字列置換関数gsub()の使い方 | ITを使っていこう&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="文字列操作">文字列操作&lt;/h2>
&lt;h3 id="文字列の連結">文字列の連結&lt;/h3>
&lt;p>単純にスペースでつなぐ。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">awk &lt;span style="color:#4e9a06">&amp;#39;{print $1 &amp;#34;-&amp;#34; $2 &amp;#34;-&amp;#34; $3}&amp;#39;&lt;/span> sample.tsv
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/tkykmw/items/89c67530c322baedb002" title="awkの変数と文字列、正規表現のキホン - Qiita">awkの変数と文字列、正規表現のキホン - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="パターンマッチ">パターンマッチ&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-awk" data-lang="awk">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">regexp&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;.*\.sh$&amp;#34;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">/^[abc]+/&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#8f5902;font-style:italic"># $0 にマッチ&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># ...&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#204a87;font-weight:bold">else&lt;/span> &lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">$&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">~&lt;/span> &lt;span style="color:#000">regexp&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># ...&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#204a87;font-weight:bold">else&lt;/span> &lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">match&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">$&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">regexp&lt;/span>&lt;span style="color:#000;font-weight:bold">))&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># ...&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>