<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>progrhyme's Tech Notes – Software</title><link>https://progrhy.me/tech-notes/a/software/</link><description>Recent content in Software on progrhyme's Tech Notes</description><generator>Hugo -- gohugo.io</generator><language>ja</language><lastBuildDate>Sat, 25 Apr 2020 23:37:10 +0900</lastBuildDate><atom:link href="https://progrhy.me/tech-notes/a/software/index.xml" rel="self" type="application/rss+xml"/><item><title>A: Argo Project</title><link>https://progrhy.me/tech-notes/a/software/argo/</link><pubDate>Fri, 08 May 2020 17:20:06 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/argo/</guid><description>
&lt;p>Kubernetes向けのワークフローエンジン、CI/CDソリューションを提供するプロジェクト。&lt;/p>
&lt;h2 id="projects">Projects&lt;/h2>
&lt;ul>
&lt;li>Workflow&lt;/li>
&lt;li>CD&lt;/li>
&lt;li>Rollouts&lt;/li>
&lt;li>Events&lt;/li>
&lt;/ul>
&lt;h3 id="events">Events&lt;/h3>
&lt;p>&lt;a href="https://argoproj.github.io/argo-events/">https://argoproj.github.io/argo-events/&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>an event-driven workflow automation framework for Kubernetes which helps you trigger K8s objects, Argo Workflows, Serverless workloads, etc. on events from variety of sources like webhook, s3, schedules, messaging queues, gcp pubsub, sns, sqs, etc.&lt;/p>
&lt;/blockquote>
&lt;p>Features:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://argoproj.github.io/argo-events/triggers/argo-workflow/">Argo Workflow Trigger - Argo Events - The Event-Based Dependency Manager for Kubernetes&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="child-pages">Child Pages&lt;/h2></description></item><item><title>A: Docker</title><link>https://progrhy.me/tech-notes/a/software/docker/</link><pubDate>Wed, 29 Apr 2020 11:59:18 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/docker/</guid><description>
&lt;h2 id="documentation">Documentation&lt;/h2>
&lt;p>公式:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.docker.com/">https://docs.docker.com/&lt;/a>&lt;/li>
&lt;li>リファレンス: &lt;a href="https://docs.docker.com/reference/">https://docs.docker.com/reference/&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://docs.docker.com/engine/reference/builder/">Dockerfile&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.docker.com/engine/reference/commandline/docker/">dockerコマンド&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>3rd Party:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://docs.docker.jp/">Docker ドキュメント日本語化プロジェクト — Docker-docs-ja&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="getting-started">Getting Started&lt;/h2>
&lt;p>入門コンテンツ:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.docker.com/engine/tutorials/">Engine tutorials | Docker Documentation&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="child-pages">Child Pages&lt;/h2></description></item><item><title>A: Git</title><link>https://progrhy.me/tech-notes/a/software/git/</link><pubDate>Mon, 27 Apr 2020 23:03:01 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/git/</guid><description>
&lt;h2 id="config">config&lt;/h2>
&lt;p>&lt;a href="https://git-scm.com/docs/git-config">https://git-scm.com/docs/git-config&lt;/a>&lt;/p>
&lt;h3 id="aliasの設定">aliasの設定&lt;/h3>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-INI" data-lang="INI">&lt;span style="color:#204a87;font-weight:bold">[alias]&lt;/span>
&lt;span style="color:#c4a000">st&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">status
&lt;/span>&lt;span style="color:#4e9a06"> dfc = diff --cached&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Tips:&lt;/p>
&lt;ul>
&lt;li>右辺を &lt;code>!&lt;/code> から記述すると外部コマンドを記述できる&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/peccul/items/90dd469e2f72babbc106">gitで便利なエイリアス達 - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/akirashi/items/2b5cf0f32777aaaf6287">git aliasで外部コマンドを呼び出して便利にしてみる - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="include">include&lt;/h3>
&lt;p>別ファイルをincludeできる&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-INI" data-lang="INI">&lt;span style="color:#204a87;font-weight:bold">[include]&lt;/span>
&lt;span style="color:#c4a000">path&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">.gitconfig.local&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://z3100.hatenadiary.org/entry/20120505/1336203155">.gitconfigで別ファイルを読み込む - 3100&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="includeif">includeIf&lt;/h3>
&lt;p>条件に基づいて別ファイルをincludeする。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://kawaken.hateblo.jp/entry/2017/08/05/235904">git-configのConditional includesでユーザ情報を切り替える - kawaken&amp;rsquo;s blog&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="how-to">How-to&lt;/h2>
&lt;p>See also &lt;a href="https://progrhy.me/tech-notes/a/software/git/cli/">gitコマンド&lt;/a>&lt;/p>
&lt;h3 id="committerとauthorを変更する">CommitterとAuthorを変更する&lt;/h3>
&lt;p>HEADのcommitを修正する場合:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">git config --local user.name &lt;span style="color:#4e9a06">&amp;#34;YOUR NAME&amp;#34;&lt;/span>
git config --local user.email your-address@example.com
git commit --amend --reset-author
&lt;/code>&lt;/pre>&lt;/div>&lt;p>過去の履歴についても変更したい場合:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">git rebase -i &amp;lt;commit hash&amp;gt;
&lt;span style="color:#8f5902;font-style:italic"># 該当するコミットを `e` で選ぶ&lt;/span>
git commit --amend --reset-author
git rebase --continue
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://tech-1natsu.hatenablog.com/entry/2018/10/19/021855">過去のgitコミットのCommitとAuthor情報を修正する - ひと夏の技術&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/sea_mountain/items/d70216a5bc16a88ed932">Git の Commit Author と Commiter を変更する - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="歴史を改ざんする">歴史を改ざんする&lt;/h3>
&lt;p>See &lt;a href="https://git-scm.com/book/ja/v2/Git-%E3%81%AE%E3%81%95%E3%81%BE%E3%81%96%E3%81%BE%E3%81%AA%E3%83%84%E3%83%BC%E3%83%AB-%E6%AD%B4%E5%8F%B2%E3%81%AE%E6%9B%B8%E3%81%8D%E6%8F%9B%E3%81%88">Git - 歴史の書き換え&lt;/a>&lt;/p>
&lt;h4 id="特定のファイルディレクトリの履歴を完全に削除">特定のファイル・ディレクトリの履歴を完全に削除&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#8f5902;font-style:italic">## file&lt;/span>
git filter-branch --tree-filter &lt;span style="color:#4e9a06">&amp;#39;rm -f path/to/file&amp;#39;&lt;/span> HEAD
&lt;span style="color:#8f5902;font-style:italic">## directory&lt;/span>
git filter-branch --tree-filter &lt;span style="color:#4e9a06">&amp;#39;rm -rf path/to/dir/&amp;#39;&lt;/span> HEAD
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://gist.github.com/ktx2207/3167fa69531bdd6b44f1">Git ファイルの履歴を完全に削除する&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="マージコミットを-cherry-pick">マージコミットを cherry-pick&lt;/h3>
&lt;p>merge commit を cherry-pick&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">git cherry-pick -m &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span> &amp;lt;merge commit のハッシュ&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://qiita.com/takc923/items/8e2d87d692f840b14464" title="merge commitをcherry-pickする - Qiita">merge commitをcherry-pickする - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="マージ済みブランチを掃除する">マージ済みブランチを掃除する&lt;/h3>
&lt;p>色んな人がやっていて、aliasに設定したりサブコマンドを作ったりしている。&lt;/p>
&lt;p>自分でも&lt;a href="https://progrhy.me/tech-notes/a/memo/2020/20200504/#git-pull---prune%E3%81%97%E3%81%A6%E3%83%9E%E3%83%BC%E3%82%B8%E6%B8%88%E3%81%BF%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%82%92%E6%8E%83%E9%99%A4%E3%81%99%E3%82%8Bgit%E3%81%AE%E3%82%B5%E3%83%96%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F">2020-05-04に作った&lt;/a>。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/kenshiroh/items/44dcf4b094e841bb42a2">gitでbranchをお掃除する際のチートシート - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="特定のファイルを-git-管理対象から除外する">特定のファイルを Git 管理対象から除外する&lt;/h3>
&lt;p>①&lt;code>.gitignore&lt;/code> や &lt;code>.git/info/exclude&lt;/code> を使う&lt;/p>
&lt;p>②既に Git 管理下にあるファイルをワーキングツリーで敢えて除外する&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">git update-index —assume-unchanged &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ファイル名&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
git update-index —skip-worktree &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ファイル名&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">## 確認&lt;/span>
git ls-files -v
&lt;span style="color:#8f5902;font-style:italic">## 取り消し&lt;/span>
git update-index —no-assume-unchanged &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ファイル名&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
git update-index —no-skip-worktree &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ファイル名&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>git ls-files -v の表示:&lt;/p>
&lt;ul>
&lt;li>assume-unchanged 設定のファイルは、状態が小文字で表示される&lt;/li>
&lt;li>skip-worktree 設定のファイルは、状態が S と表示される&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://qiita.com/usamik26/items/56d0d3ba7a1300625f92">既に git 管理しているファイルをあえて無視したい - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="リポジトリをサブディレクトリで分割">リポジトリをサブディレクトリで分割&lt;/h3>
&lt;h4 id="サブディレクトリが1つの場合">サブディレクトリが1つの場合&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">git clone original_dir new_dir
&lt;span style="color:#204a87">cd&lt;/span> new_dir
git filter-branch --subdirectory-filter sub_dir_name HEAD
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://akio0911.net/archives/3421">gitリポジトリのサブディレクトリを別のリポジトリとして抽出する方法 - 拡張現実ライフ&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="サブディレクトリが複数の場合">サブディレクトリが複数の場合&lt;/h4>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://stackoverflow.com/questions/2982055/detach-many-subdirectories-into-a-new-separate-git-repository">git filter branch - Detach many subdirectories into a new, separate Git repository - Stack Overflow&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: GNU make</title><link>https://progrhy.me/tech-notes/a/software/make/</link><pubDate>Mon, 04 May 2020 19:50:02 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/make/</guid><description>
&lt;h2 id="getting-started">Getting Started&lt;/h2>
&lt;p>公式リファレンスは↑&lt;/p>
&lt;p>サードパーティーのリファレンス的資料:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://www.ecoop.net/coop/translated/GNUMake3.77/make_toc.jp.html">GNU make 日本語訳(Coop編) - 目次&lt;/a> &amp;hellip; 1998年ぐらい。古い&lt;/li>
&lt;li>&lt;a href="http://qiita.com/chibi929/items/b8c5f36434d5d3fbfa4a">Makefileの関数 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="quickstart">Quickstart&lt;/h2>
&lt;p>使えるMakefileの例&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Makefile" data-lang="Makefile">&lt;span style="color:#000">.PHONY&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">default&lt;/span> &lt;span style="color:#000">build&lt;/span> &lt;span style="color:#000">clean&lt;/span>
&lt;span style="color:#000">default&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">build&lt;/span>
&lt;span style="color:#000">clean&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>
rm -rf dist/
&lt;span style="color:#000">timestamp&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>
date +%s &amp;gt; timestamp
&lt;span style="color:#000">build&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">timestamp&lt;/span> &lt;span style="color:#000">another&lt;/span>-&lt;span style="color:#000">file&lt;/span>
some_build_command
&lt;/code>&lt;/pre>&lt;/div>&lt;p>NOTE:&lt;/p>
&lt;ul>
&lt;li>ターゲットの依存ターゲットは複数記すことができる。&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://objectclub.jp/community/memorial/homepage3.nifty.com/masarl/article/gnu-make/rule.html">- 自動化のためのGNU Make入門講座 - Makefileの基本：ルール&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="makefile-構文">Makefile 構文&lt;/h2>
&lt;h3 id="変数">変数&lt;/h3>
&lt;p>変数定義のやり方について。&lt;/p>
&lt;p>&amp;ldquo;=&amp;rdquo; と &amp;ldquo;:=&amp;rdquo; は違う。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Makefile" data-lang="Makefile">&lt;span style="color:#000">src&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> foo.c
&lt;span style="color:#000">ymd&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>shell date +%Y%m%d&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://quruli.ivory.ne.jp/document/make_3.79.1/make-jp_5.html" title="GNU make: 6. 変数の使用法">GNU make: 6. 変数の使用法&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="curdir">$(CURDIR)&lt;/h4>
&lt;p>makeを実行しているプロセスのカレントディレクトリを返す。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.gnu.org/software/make/manual/html_node/Recursion.html">https://www.gnu.org/software/make/manual/html_node/Recursion.html&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://d.hatena.ne.jp/m-hiyama/20080805/1217915354" title="今日のMake Tips：CURDIR変数 - 檜山正幸のキマイラ飼育記">今日のMake Tips：CURDIR変数 - 檜山正幸のキマイラ飼育記&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="関数">関数&lt;/h3>
&lt;h4 id="foreach-name-list-command">$(foreach name, LIST, command)&lt;/h4>
&lt;p>ループ実行&lt;/p>
&lt;h3 id="phonyターゲット">.PHONYターゲット&lt;/h3>
&lt;p>&lt;a href="https://www.gnu.org/software/make/manual/html_node/Phony-Targets.html">https://www.gnu.org/software/make/manual/html_node/Phony-Targets.html&lt;/a>&lt;/p>
&lt;p>ファイルを生成しないやつ&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Makefile" data-lang="Makefile">&lt;span style="color:#000">.PHONY&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">clean&lt;/span>
&lt;span style="color:#000">clean&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>
rm *.o tmp
&lt;/code>&lt;/pre>&lt;/div>&lt;p>複数の.PHONYターゲットをまとめて記述することもできる&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Makefile" data-lang="Makefile">&lt;span style="color:#000">.PHONY&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">all&lt;/span> &lt;span style="color:#000">clean&lt;/span> &lt;span style="color:#000">deps&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="条件分岐">条件分岐&lt;/h3>
&lt;p>&lt;a href="https://www.gnu.org/software/make/manual/make.html#Conditionals">7 Conditional Parts of Makefiles&lt;/a>&lt;/p>
&lt;p>Example:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Makefile" data-lang="Makefile">&lt;span style="color:#000">libs_for_gcc&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> -lgnu
&lt;span style="color:#000">normal_libs&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>
&lt;span style="color:#000">foo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">objects&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#a40000">ifeq&lt;/span> &lt;span style="color:#a40000">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">CC&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>&lt;span style="color:#a40000">,gcc)&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">CC&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#a40000">-o&lt;/span> &lt;span style="color:#a40000">foo&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">objects&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">libs_for_gcc&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#a40000">else&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">CC&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#a40000">-o&lt;/span> &lt;span style="color:#a40000">foo&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">objects&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">normal_libs&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#a40000">endif&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="makeコマンド">makeコマンド&lt;/h2>
&lt;p>公式マニュアル:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.gnu.org/software/make/manual/make.html#Running">9 How to Run make&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://www.gnu.org/software/make/manual/make.html#Overriding">9.5 Overriding Variables&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.gnu.org/software/make/manual/make.html#Options-Summary">9.7 Summary of Options&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>SYNOPSIS:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># デフォルトのタスク（＝最上部で定義されたタスク）を実行&lt;/span>
make
&lt;span style="color:#8f5902;font-style:italic"># タスク名を指定して実行。複数指定可&lt;/span>
make task1 &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>task2 ...&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># Makefileを指定する&lt;/span>
make -f&lt;span style="color:#000;font-weight:bold">|&lt;/span>--file &amp;lt;Makefile&amp;gt;
&lt;span style="color:#8f5902;font-style:italic"># dry-run&lt;/span>
make -n&lt;span style="color:#000;font-weight:bold">|&lt;/span>--dry-run
&lt;span style="color:#8f5902;font-style:italic"># 変数の設定&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># Makefile内で定義されていれば、オーバーライドする&lt;/span>
make &lt;span style="color:#000">CFLAGS&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>-g
&lt;/code>&lt;/pre>&lt;/div>&lt;p>その他のオプション:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>オプション&lt;/th>
&lt;th>意味&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>-j|--jobs[=N]&lt;/code>&lt;/td>
&lt;td>同時実行数を指定。See &lt;a href="https://www.gnu.org/software/make/manual/make.html#Parallel">5.4 Parallel Execution&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>-e|--environment-overrides&lt;/code>&lt;/td>
&lt;td>環境変数をオーバーライドする&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>-d&lt;/code>&lt;/td>
&lt;td>デバッグ情報を表示。 &lt;code>--debug=a&lt;/code> と同じ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>--trace&lt;/code>&lt;/td>
&lt;td>実行時のトレース情報を表示する&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>-s|--silent|--quiet&lt;/code>&lt;/td>
&lt;td>実行されるタスクをプリントしない&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>-h|--help&lt;/code>&lt;/td>
&lt;td>ヘルプ表示&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>-v|--version&lt;/code>&lt;/td>
&lt;td>バージョン表示&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="tips">Tips&lt;/h2>
&lt;h3 id="必要なディレクトリを作ってタスク実行">必要なディレクトリを作ってタスク実行&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Makefile" data-lang="Makefile">&lt;span style="color:#000">BUILD_DIR&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:=&lt;/span> path/to/build
&lt;span style="color:#000">$(BUILD_DIR)&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>
mkdir -p &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>BUILD_DIR&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#000">all&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>&lt;span style="color:#000">BUILD_DIR&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;span style="color:#204a87">cd&lt;/span> &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>BUILD_DIR&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> some_commands
&lt;span style="color:#000">.PHONY&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">all&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="環境変数の取扱い">環境変数の取扱い&lt;/h3>
&lt;p>環境変数はMakeの変数として参照できる。例: &lt;code>$(CFLAGS)&lt;/code>&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/kojiohta/items/54b1a9f7d482c35dc4fa">GNU Make のふたつの変数の使い分け - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.ecoop.net/coop/translated/GNUMake3.77/make_6.jp.html">GNU make 日本語訳(Coop編) - 変数の利用法&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="how-to">How-to&lt;/h2>
&lt;h3 id="コマンドに引数を渡したい">コマンドに引数を渡したい&lt;/h3>
&lt;p>&lt;code>make CFAGS=-g&lt;/code> みたいに変数経由で渡すことになりそう。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/liubin/items/69d9faf804e82ddec376">Makefileにパラメータを渡す方法と条件文 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="参考">参考&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="http://itchyny.hatenablog.com/entry/20120213/1329135107">Makefileで遊ぼう 〜 階乗, フィボナッチ数, Brainfuck処理系まで - プログラムモグモグ&lt;/a>
&lt;ul>
&lt;li>入門レベルで割とよく使う感じの機能がまとまってる。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>A: Infrastructure as Code</title><link>https://progrhy.me/tech-notes/a/software/infra-as-code/</link><pubDate>Tue, 12 May 2020 07:01:35 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/infra-as-code/</guid><description>
&lt;p>ITインフラの構成をコードで管理できるようにしてくれるソフトウェアについて書く。&lt;/p>
&lt;h2 id="software">Software&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://www.pulumi.com/product/">Pulumi&lt;/a> &amp;hellip; 各種クラウドの構成管理を高級言語で行える&lt;/li>
&lt;li>&lt;a href="https://gocloud.dev/">Go CDK (Cloud Development Kit)&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/terraform/">Terraform&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: Jenkins</title><link>https://progrhy.me/tech-notes/a/software/jenkins/</link><pubDate>Thu, 28 May 2020 11:12:22 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/jenkins/</guid><description>
&lt;p>CI/CDなどの自動化ツール。&lt;br>
何でもできる英国紳士。&lt;/p>
&lt;h2 id="documentation">Documentation&lt;/h2>
&lt;p>&lt;a href="https://jenkins.io/doc/">https://jenkins.io/doc/&lt;/a>&lt;/p>
&lt;ul>
&lt;li>Pipeline機能: &lt;a href="https://jenkins.io/doc/book/pipeline/">https://jenkins.io/doc/book/pipeline/&lt;/a>
&lt;ul>
&lt;li>Syntax: &lt;a href="https://jenkins.io/doc/book/pipeline/syntax/">https://jenkins.io/doc/book/pipeline/syntax/&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="pipeline">Pipeline&lt;/h2>
&lt;ul>
&lt;li>Declarative Pipeline &amp;hellip; 比較的新しい。 &lt;code>pipeline { ... }&lt;/code> で定義する。&lt;/li>
&lt;li>Scripted Pipeline &amp;hellip; やや古い。 &lt;code>node { ... }&lt;/code> で定義する。&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://cocodrips.hateblo.jp/entry/2017/10/23/205801">Jenkinsのpipelineのスクリプトの書き方まとめ - ぴよぴよ.py&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="steps-reference">Steps Reference&lt;/h3>
&lt;p>&lt;a href="https://jenkins.io/doc/pipeline/steps/">https://jenkins.io/doc/pipeline/steps/&lt;/a>&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://jenkins.io/doc/pipeline/steps/workflow-durable-task-step/">Pipeline: Nodes and Processes&lt;/a>
&lt;ul>
&lt;li>&lt;code>sh&lt;/code> 等&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="basic-steps">Basic Steps&lt;/h4>
&lt;p>&lt;a href="https://jenkins.io/doc/pipeline/steps/workflow-basic-steps/">https://jenkins.io/doc/pipeline/steps/workflow-basic-steps/&lt;/a>&lt;/p>
&lt;h5 id="withenv">&lt;code>withEnv&lt;/code>&lt;/h5>
&lt;p>環境変数をセットしたブロックを作る。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-groovy" data-lang="groovy">&lt;span style="color:#000">node&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">withEnv&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">([&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;MYTOOL_HOME=/usr/local/mytool&amp;#39;&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">])&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">sh&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;$MYTOOL_HOME/bin/start&amp;#39;&lt;/span>
&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span>
&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>withEnv(['PATH+WHATEVER=/something'])&lt;/code> のようにすることで、 &lt;code>/something&lt;/code> を &lt;code>$PATH&lt;/code> エントリの前に加えることができる。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://stackoverflow.com/questions/44378221/export-command-in-jenkins-pipeline/44380495#44380495">path - Export command in Jenkins pipeline - Stack Overflow&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="plugins">Plugins&lt;/h2>
&lt;h3 id="cloudbees-folders">CloudBees Folders&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://go.cloudbees.com/docs/cloudbees-documentation/cje-user-guide/index.html#folder">User Guide&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://plugins.jenkins.io/cloudbees-folder">https://plugins.jenkins.io/cloudbees-folder&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://wiki.jenkins.io/display/JENKINS/CloudBees+Folders+Plugin">https://wiki.jenkins.io/display/JENKINS/CloudBees+Folders+Plugin&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>ジョブをフォルダという単位に整理することができる。&lt;br>
UI上はタブで表示される。&lt;/p>
&lt;h4 id="使い方">使い方&lt;/h4>
&lt;ul>
&lt;li>ジョブの編集(フォルダへの追加・削除)
&lt;ol>
&lt;li>タブをクリックすると &lt;code>/view/xxx&lt;/code> というパスに遷移する。&lt;/li>
&lt;li>左列メニューの「ビューの変更」(英語だと「Edit View」)をクリック&lt;/li>
&lt;li>ジョブをチェックボックスで選択し、「保存」&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://code.i-harness.com/ja/q/1b3d4ea" title="Jenkinsで既存のジョブを別のビューに移動するにはどうすればいいですか？ | CODE Q&amp;amp;A [日本語]">Jenkinsで既存のジョブを別のビューに移動するにはどうすればいいですか？ | CODE Q&amp;amp;A [日本語]&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: Kubernetes</title><link>https://progrhy.me/tech-notes/a/software/k8s/</link><pubDate>Mon, 27 Apr 2020 10:39:49 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/k8s/</guid><description>
&lt;p>関連ページ:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/google/gcp/gke/">Google Cloud &amp;gt; GKE&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="getting-started">Getting Started&lt;/h2>
&lt;h3 id="documentation">Documentation&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/home/">https://kubernetes.io/docs/home/&lt;/a> &amp;hellip; ドキュメント
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/tutorials/">https://kubernetes.io/docs/tutorials/&lt;/a> &amp;hellip; チュートリアル&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/">https://kubernetes.io/docs/tasks/&lt;/a> &amp;hellip; How-toガイド&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/glossary/?fundamental=true">Standardized Glossary - Kubernetes&lt;/a> &amp;hellip; 用語集&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/advent-calendar/2018/k8s-dojo">Kubernetes道場 Advent Calendar 2018 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="リファレンス">リファレンス&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/">https://kubernetes.io/docs/reference/&lt;/a>
&lt;ul>
&lt;li>APIリファレンス&lt;/li>
&lt;li>CLIリファレンス&lt;/li>
&lt;li>etc.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="ベストプラクティス">ベストプラクティス&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/concepts/configuration/overview/">Configuration Best Practices | Kubernetes&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ケーススタディ">ケーススタディ&lt;/h2>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://k8s.af/">Kubernetes Failure Stories&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="versions">Versions&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/setup/release/version-skew-policy/">Kubernetes version and version skew support policy - Kubernetes&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="how-to">How-to&lt;/h2>
&lt;h3 id="podの再起動">Podの再起動&lt;/h3>
&lt;ul>
&lt;li>K8sはクラスタの状態を宣言型で記述するので、「再起動する」というのを指示するのは難しいようだ&lt;/li>
&lt;li>下の記事にあるように、Deploymentの定義を変えてapplyするのが良いだろう&lt;/li>
&lt;li>レプリカの数を0にして増やすという手もある&lt;/li>
&lt;/ul>
&lt;p>See&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/dtan4/items/9e0ab5dbe8c64ed6dd21">全ての Pod を一発でリロードさせる方法 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="複数クラスタを設定する">複数クラスタを設定する&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/">https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/&lt;/a> &amp;hellip; &lt;code>kubectl config use-context&lt;/code> で複数クラスタを切り替えられるようにする設定チュートリアル&lt;/li>
&lt;/ul>
&lt;h3 id="機密情報や環境設定の扱い">機密情報や環境設定の扱い&lt;/h3>
&lt;p>SecretsやConfigMapを使う。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://tellme.tokyo/post/2018/08/07/kubernetes-configmaps-secrets/">Kubernetes 上で Credentials を扱う | tellme.tokyo&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="namespaceの削除">Namespaceの削除&lt;/h3>
&lt;p>&lt;a href="https://kubernetes.io/docs/tasks/administer-cluster/namespaces/#deleting-a-namespace">https://kubernetes.io/docs/tasks/administer-cluster/namespaces/#deleting-a-namespace&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">kubectl delete namespace my-ns
kubectl delete -f my-ns.yml
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/yusuke_kinoshita/items/d1302cc3ad4657ad3466">Kubernetesでnamespaceを作成・変更・削除する方法 - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://dev.classmethod.jp/articles/k8s-namespace-force-delete/">[小ネタ]Kubernetesで消せないNamespaceが発生した場合の対処方法 | Developers.IO&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="topics">Topics&lt;/h2>
&lt;h3 id="cfs-quotaが有効のときcpu-limits設定によってコンテナがストールする問題">CFS quotaが有効のときCPU limits設定によってコンテナがストールする問題&lt;/h3>
&lt;p>2018年には起こっていた問題。&lt;br>
2020-04-14現在の状況は不明。&lt;/p>
&lt;p>TL;DR:&lt;/p>
&lt;ul>
&lt;li>KubeletでCPU CFS quota有効だと問題
&lt;ul>
&lt;li>OS kernelのスケジューラがCFSだったらデフォルト有効だと思う&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>デフォルトの &lt;code>cpu.cfs_period_us&lt;/code> が100ms &amp;hellip; この単位時間でクォータがリセットされる&lt;/li>
&lt;li>マルチコアのマシン上に複数Podがスケジュールされたとき、複数のPodが同時にCPUを使うと、すぐにlimitsに達してスロットルされてしまうことが起こり得る&lt;/li>
&lt;/ul>
&lt;p>仕組みについては、下の記事が詳しい:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://medium.com/omio-engineering/cpu-limits-and-aggressive-throttling-in-kubernetes-c5b20bd8a718">CPU limits and aggressive throttling in Kubernetes - Omio Engineering - Medium&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>関連リソース:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/issues/67577">CFS quotas can lead to unnecessary throttling · Issue #67577 · kubernetes/kubernetes&lt;/a> &amp;hellip; 2020-04-14現在、まだOpen&lt;/li>
&lt;li>&lt;a href="https://www.slideshare.net/try_except_/optimizing-kubernetes-resource-requestslimits-for-costefficiency-and-latency-highload">Optimizing Kubernetes Resource Requests/Limits for Cost-Efficiency an…&lt;/a> pp.24-43&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/administer-cluster/cpu-management-policies/">Control CPU Management Policies on the Node - Kubernetes&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://christina04.hatenablog.com/entry/kubernetes-resource-limits">Kubernetesのresource requests, limits - Carpe Diem&lt;/a>&lt;/li>
&lt;li>Kubeletの設定:
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/">kubelet - Kubernetes&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/administer-cluster/kubelet-config-file/">Set Kubelet parameters via a config file - Kubernetes&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="クラスタが大きくなるとどんな問題があるか">クラスタが大きくなるとどんな問題があるか？&lt;/h3>
&lt;p>巷では不安定になるとよく言われるが、どのくらいやばいのか、どんな問題が起こり得るのかを考察する。&lt;/p>
&lt;p>起こり得る問題:&lt;/p>
&lt;ul>
&lt;li>Pod Affinityを使っている場合に、スケジューリングが遅くなる。
&lt;ul>
&lt;li>ref. &lt;a href="https://kubernetes.io/ja/docs/concepts/configuration/assign-pod-node/">https://kubernetes.io/ja/docs/concepts/configuration/assign-pod-node/&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>Inter-Pod AffinityとAnti-Affinityは、大規模なクラスター上で使用する際にスケジューリングを非常に遅くする恐れのある多くの処理を要します。 そのため、数百台以上のNodeから成るクラスターでは使用することを推奨されません。&lt;/p>
&lt;/blockquote>
&lt;h4 id="gke-google-kubernetes-engine-の場合">GKE (Google Kubernetes Engine) の場合&lt;/h4>
&lt;ul>
&lt;li>内部TCP/UDPロードバランサのバックエンドVMの最大数が250
&lt;ul>
&lt;li>&lt;a href="https://cloud.google.com/kubernetes-engine/docs/how-to/internal-load-balancing?hl=ja#limits">https://cloud.google.com/kubernetes-engine/docs/how-to/internal-load-balancing?hl=ja#limits&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="child-pages">Child Pages&lt;/h2></description></item><item><title>A: Spinnaker</title><link>https://progrhy.me/tech-notes/a/software/spinnaker/</link><pubDate>Tue, 05 May 2020 00:24:18 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/spinnaker/</guid><description>
&lt;h2 id="documentation">Documentation&lt;/h2>
&lt;p>公式サイト: &lt;a href="https://www.spinnaker.io/">https://www.spinnaker.io/&lt;/a>&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/setup/">Set up Spinnaker&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/setup/install/providers/">Cloud Providers&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/setup/install/providers/docker-registry/">Docker Registry&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.spinnaker.io/setup/install/providers/kubernetes-v2/">Kubernetes v2&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/setup/install/providers/kubernetes-v2/gke/">GKE&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://www.spinnaker.io/guides/">Guides&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/guides/tutorials/">Tutorials&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/guides/tutorials/codelabs/">Codelabs&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/guides/tutorials/codelabs/safe-deployments/">Safe Deployments&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://www.spinnaker.io/reference/">Reference&lt;/a>
&lt;ul>
&lt;li>API &lt;a href="https://www.spinnaker.io/reference/api/docs.html">https://www.spinnaker.io/reference/api/docs.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="quickstart">Quickstart&lt;/h2>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/spinnaker/spinnaker.github.io/blob/master/downloads/kubernetes/quick-install.yml">https://github.com/spinnaker/spinnaker.github.io/blob/master/downloads/kubernetes/quick-install.yml&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="concepts">Concepts&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/concepts/">Overview&lt;/a>
&lt;ul>
&lt;li>Application management
&lt;ul>
&lt;li>:&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Application deployment
&lt;ul>
&lt;li>Pipeline&lt;/li>
&lt;li>Stage&lt;/li>
&lt;li>Deployment strategies&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="guides">Guides&lt;/h2>
&lt;p>&lt;a href="https://www.spinnaker.io/guides/">https://www.spinnaker.io/guides/&lt;/a>&lt;/p>
&lt;h3 id="kubernetes">Kubernetes&lt;/h3>
&lt;p>&lt;a href="https://www.spinnaker.io/guides/user/kubernetes-v2/">https://www.spinnaker.io/guides/user/kubernetes-v2/&lt;/a>&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/guides/user/kubernetes-v2/deploy-manifest/">Deploy Kubernetes Manifests&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.spinnaker.io/guides/user/kubernetes-v2/patch-manifest/">Patch Kubernetes Manifests&lt;/a>
&lt;ul>
&lt;li>K8sのmanifestをpatch更新できる。&lt;/li>
&lt;li>参考: &lt;a href="https://kubernetes.io/docs/tasks/run-application/update-api-object-kubectl-patch/">Update API Objects in Place Using kubectl patch - Kubernetes&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://www.spinnaker.io/guides/user/kubernetes-v2/rollout-strategies/">Rollout Strategies&lt;/a>
&lt;ul>
&lt;li>※ReplicaSetのみ有効 &lt;a href="https://www.spinnaker.io/guides/user/kubernetes-v2/traffic-management/#you-must-use-replica-sets">https://www.spinnaker.io/guides/user/kubernetes-v2/traffic-management/#you-must-use-replica-sets&lt;/a>&lt;/li>
&lt;li>Red/Black Rollouts&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://blog.spinnaker.io/introducing-rollout-strategies-in-the-kubernetes-v2-provider-8bbffea109a">Introducing Rollout Strategies in the Kubernetes V2 Provider&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="reference">Reference&lt;/h2>
&lt;p>&lt;a href="https://www.spinnaker.io/reference/">https://www.spinnaker.io/reference/&lt;/a>&lt;/p>
&lt;h3 id="artifacts">Artifacts&lt;/h3>
&lt;p>&lt;a href="https://www.spinnaker.io/reference/artifacts/">https://www.spinnaker.io/reference/artifacts/&lt;/a>&lt;/p>
&lt;p>外部リソースを参照するオブジェクト。&lt;/p>
&lt;p>例:&lt;/p>
&lt;ul>
&lt;li>Dockerイメージ&lt;/li>
&lt;li>GCSやS3内のバイナリ&lt;/li>
&lt;/ul>
&lt;h4 id="artifacts-in-kubernetes-manifest-basedhttpswwwspinnakerioreferenceartifactsin-kubernetes-v2">&lt;a href="https://www.spinnaker.io/reference/artifacts/in-kubernetes-v2/">Artifacts In Kubernetes (Manifest Based)&lt;/a>&lt;/h4>
&lt;p>いくつかのリソースは &lt;code>vNNN&lt;/code> 形式でSpinnaker内でバージョンが振られる。&lt;/p>
&lt;h2 id="components">Components&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>component&lt;/th>
&lt;th>description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Clouddriver&lt;/td>
&lt;td>クラウドインフラとのやりとりを司る&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Deck&lt;/td>
&lt;td>Web UI&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Gate&lt;/td>
&lt;td>API Gateway&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Orca&lt;/td>
&lt;td>オーケストレーションエンジン&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/setup/security/authentication/">Authentication - Spinnaker&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.spinnaker.io/setup/productionize/scaling/horizontal-scaling/">Horizontally Scale Spinnaker Services - Spinnaker&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="spec">Spec&lt;/h2>
&lt;h3 id="authentication--認証">Authentication / 認証&lt;/h3>
&lt;p>&lt;a href="https://www.spinnaker.io/setup/security/authentication/">https://www.spinnaker.io/setup/security/authentication/&lt;/a>&lt;/p>
&lt;h4 id="google-cloud-iapによる認証">Google Cloud IAPによる認証&lt;/h4>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/reference/halyard/commands/#hal-config-security-authn-iap">https://www.spinnaker.io/reference/halyard/commands/#hal-config-security-authn-iap&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://medium.com/@damianmyerscough/spinnaker-authentication-with-cloud-iap-a7f12ebf18c0">Spinnaker Authentication with Cloud IAP - Damian Myerscough - Medium&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="authorization--認可">Authorization / 認可&lt;/h3>
&lt;ul>
&lt;li>Setup: &lt;a href="https://www.spinnaker.io/setup/security/authorization/">https://www.spinnaker.io/setup/security/authorization/&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/setup/security/authorization/google-groups/">Google Groups via G Suite - Spinnaker&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Architecture: &lt;a href="https://www.spinnaker.io/reference/architecture/authz_authn/authorization/">https://www.spinnaker.io/reference/architecture/authz_authn/authorization/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Automated Triggersによって起動するPipelineの場合、以下の2つの方法のいずれかで権限設定する:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/setup/security/authorization/service-accounts/">Service Accounts - Spinnaker&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.spinnaker.io/setup/security/authorization/pipeline-permissions/">Pipeline Permissions - Spinnaker&lt;/a> &amp;hellip; こっちは2020-01-08時点でまだαらしい&lt;/li>
&lt;/ul>
&lt;h4 id="service-account">Service Account&lt;/h4>
&lt;p>削除&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Bash" data-lang="Bash">curl -X DELETE &lt;span style="color:#000">$FRONT50&lt;/span>/serviceAccounts/&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>サービスアカウントID&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考: &lt;a href="https://github.com/spinnaker/front50/blob/a25e184f6afd4dd63a8c8fdb63fe109b378f9991/front50-web/src/main/groovy/com/netflix/spinnaker/front50/controllers/ServiceAccountsController.groovy#L69">https://github.com/spinnaker/front50/blob/a25e184f6afd4dd63a8c8fdb63fe109b378f9991/front50-web/src/main/groovy/com/netflix/spinnaker/front50/controllers/ServiceAccountsController.groovy#L69&lt;/a>&lt;/p>
&lt;h3 id="ciツール連携">CIツール連携&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/setup/ci/">https://www.spinnaker.io/setup/ci/&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.spinnaker.io/reference/halyard/commands/#hal-config-ci">https://www.spinnaker.io/reference/halyard/commands/#hal-config-ci&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>2020-01-17現在、Concourse, Jenkins, Google Cloud Build, Travis CI, Werckerに対応しているようだ。&lt;/p>
&lt;h2 id="how-to">How-to&lt;/h2>
&lt;h3 id="kubernetesアカウントを追加する">Kubernetesアカウントを追加する&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/setup/install/providers/kubernetes-v2/#adding-an-account">https://www.spinnaker.io/setup/install/providers/kubernetes-v2/#adding-an-account&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/Yama-Tomo/items/73c2a7ccf60c22866a04">Spinnakerでデプロイ先のクラスタを追加する - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="ログレベルの変更">ログレベルの変更&lt;/h3>
&lt;p>&lt;code>~/.hal/default/service/settings/${component}.yml&lt;/code> に以下の内容を記述:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#204a87;font-weight:bold">env&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">JAVA_OPTS&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;-Dlogging.level.com.netflix.${コンポーネント名}=DEBUG&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/spinnaker/spinnaker/issues/3388">Fiat Service Account causes NPE if the Service Account is not a user in LDAP · Issue #3388 · spinnaker/spinnaker&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://community.spinnaker.io/t/solved-how-to-change-spinnakers-services-logging-level/458">[SOLVED] How to change spinnaker&amp;rsquo;s services logging level? - Operations - Spinnaker&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="topics">Topics&lt;/h2>
&lt;h3 id="spinnaker-rollout-strategies-vs-k8s-rolling-update">Spinnaker Rollout Strategies vs K8s Rolling Update&lt;/h3>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://community.spinnaker.io/t/spinnaker-deployment-strategies-v-kubernetes-rolling-update/180">Spinnaker deployment strategies v. Kubernetes rolling update - Platforms - Spinnaker&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="gcp-gke">GCP (GKE)&lt;/h2>
&lt;p>Getting Started:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/GoogleCloudPlatform/spinnaker-for-gcp">https://github.com/GoogleCloudPlatform/spinnaker-for-gcp&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cloud.google.com/docs/ci-cd/spinnaker/spinnaker-for-gcp">https://cloud.google.com/docs/ci-cd/spinnaker/spinnaker-for-gcp&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Advanced:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://cloud.google.com/solutions/managing-and-deploying-apps-to-multiple-gke-clusters-using-spinnaker?hl=ja">Spinnaker を使用したアプリの管理と複数の GKE クラスタへのデプロイ | ソリューション | Google Cloud&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/takasp/items/a74c8acdf3a8851b8da7">GKE で Spinnaker を構築する - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="child-pages">Child Pages&lt;/h2></description></item><item><title>A: systemd</title><link>https://progrhy.me/tech-notes/a/software/systemd/</link><pubDate>Mon, 18 May 2020 16:14:32 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/systemd/</guid><description>
&lt;p>&lt;a href="https://www.freedesktop.org/wiki/Software/systemd/">https://www.freedesktop.org/wiki/Software/systemd/&lt;/a>&lt;/p>
&lt;p>昨今のLinuxのinit（最初に起動するプログラム）としてほぼデファクトになっているソフトウェア。&lt;/p>
&lt;h2 id="configuration">Configuration&lt;/h2>
&lt;h3 id="systemdunit">systemd.unit&lt;/h3>
&lt;p>&lt;a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">https://www.freedesktop.org/software/systemd/man/systemd.unit.html&lt;/a>&lt;/p>
&lt;h4 id="template-unit-files">Template Unit Files&lt;/h4>
&lt;p>コマンドとかほぼ同じなんだけど、パラメータの異なるServiceを複数動かしたいようなときに使う。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://redj.hatenablog.com/entry/2020/02/08/180950">systemdのユニットファイルをテンプレート化する - redj’s blog&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="systemctl">systemctl&lt;/h2>
&lt;p>CLI&lt;/p>
&lt;p>&lt;a href="https://www.freedesktop.org/software/systemd/man/systemctl.html">https://www.freedesktop.org/software/systemd/man/systemctl.html&lt;/a>&lt;/p>
&lt;h3 id="daemon-reload">daemon-reload&lt;/h3>
&lt;p>&lt;a href="https://www.freedesktop.org/software/systemd/man/systemctl.html#daemon-reload">https://www.freedesktop.org/software/systemd/man/systemctl.html#daemon-reload&lt;/a>&lt;/p>
&lt;p>configと全unit fileを再読込みする。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">systemctl daemon-reload
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>A: Terraform</title><link>https://progrhy.me/tech-notes/a/software/terraform/</link><pubDate>Sun, 26 Apr 2020 22:59:20 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/terraform/</guid><description>
&lt;h2 id="getting-started">Getting Started&lt;/h2>
&lt;ul>
&lt;li>初心者向けガイド: &lt;a href="https://www.terraform.io/guides/">https://www.terraform.io/guides/&lt;/a>&lt;/li>
&lt;li>ドキュメント: &lt;a href="https://www.terraform.io/docs/">https://www.terraform.io/docs/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/kohey18/items/38400d8c498baa0a0ed8" title="terraform使い方(超基礎編) - Qiita">terraform使い方(超基礎編) - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="仕様">仕様&lt;/h2>
&lt;h3 id="state">State&lt;/h3>
&lt;p>&lt;a href="https://www.terraform.io/docs/state/">https://www.terraform.io/docs/state/&lt;/a>&lt;/p>
&lt;h4 id="locking">Locking&lt;/h4>
&lt;p>&lt;a href="https://www.terraform.io/docs/state/locking.html">https://www.terraform.io/docs/state/locking.html&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.terraform.io/docs/backends">backend&lt;/a>によってサポートされていれば、排他制御が可能。&lt;/p>
&lt;h2 id="examples">Examples&lt;/h2>
&lt;p>公式のを見ると良い。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/hashicorp/terraform/tree/master/examples">https://github.com/hashicorp/terraform/tree/master/examples&lt;/a>
&lt;ul>
&lt;li>AWS: &lt;a href="https://github.com/terraform-providers/terraform-provider-aws/tree/master/examples">https://github.com/terraform-providers/terraform-provider-aws/tree/master/examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="ベストプラクティス">ベストプラクティス&lt;/h2>
&lt;p>公式: &lt;a href="https://github.com/hashicorp/best-practices/tree/master/terraform">https://github.com/hashicorp/best-practices/tree/master/terraform&lt;/a>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Terraform Version&lt;/th>
&lt;th>記事&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>v0.10&lt;/td>
&lt;td>&lt;a href="https://qiita.com/shogomuranushi/items/e2f3ff3cfdcacdd17f99" title="Terraform Best Practices in 2017 - Qiita">Terraform Best Practices in 2017 - Qiita&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>v0.7.x&lt;/td>
&lt;td>&lt;a href="https://dev.classmethod.jp/devops/directory-layout-bestpractice-in-terraform/" title="Terraformにおけるディレクトリ構造のベストプラクティス ｜ Developers.IO">Terraformにおけるディレクトリ構造のベストプラクティス ｜ Developers.IO&lt;/a>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>オレオレ:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/progrhyme/items/766d02e605358ad2930e" title="TerraformでWorkspaceを使わずに複数環境をDRYに設定する - Qiita">TerraformでWorkspaceを使わずに複数環境をDRYに設定する - Qiita&lt;/a> &amp;hellip; Terraform v0.10〜v0.11ぐらい対応&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.hashicorp.com/blog/structuring-hashicorp-terraform-configuration-for-production/">Structuring HashiCorp Terraform Configuration for Production&lt;/a> &amp;hellip; 2020-03-27. Workspacesを使わずにディレクトリを分けることのメリットが述べられている。&lt;/li>
&lt;/ul>
&lt;h2 id="how-to">How-to&lt;/h2>
&lt;h3 id="バージョン固定">バージョン固定&lt;/h3>
&lt;p>&lt;a href="https://www.terraform.io/docs/configuration/terraform.html">Terraform Settings - Configuration Language - Terraform by HashiCorp&lt;/a>&lt;/p>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-HCL" data-lang="HCL">&lt;span style="color:#204a87;font-weight:bold">terraform&lt;/span> {
&lt;span style="color:#000"> required_version&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#000"> &amp;#34;&amp;gt;&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">12&lt;/span>&lt;span style="color:#a40000">&amp;#34;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">required_providers&lt;/span> {
&lt;span style="color:#000"> aws&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#000"> &amp;#34;&amp;gt;&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">8&lt;/span>&lt;span style="color:#a40000">&amp;#34;&lt;/span>
&lt;span style="color:#000"> local&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;1.2&amp;#34;&lt;/span>
}
}
&lt;span style="color:#204a87;font-weight:bold">provider&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;http&amp;#34;&lt;/span> {
&lt;span style="color:#000"> version&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;1.2.0&amp;#34;&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>terraformのversion指定はtfenvでも可能&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/minamijoyo/items/1350fb28ae82a3dbb354">tfupdateでTerraform本体/プロバイダ/モジュールのバージョンアップを自動化する - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="backendのs3やgcs等そのものをterraformで管理">BackendのS3やGCS等そのものをTerraformで管理&lt;/h3>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/saiya_moebius/items/a8f8aa3683c2347d607c">Backend の S3 や DynamoDB 自体を terraform で管理するセットアップ方法 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="tips">Tips&lt;/h2>
&lt;h3 id="デバッグ">デバッグ&lt;/h3>
&lt;p>&lt;a href="https://www.terraform.io/docs/internals/debugging.html">https://www.terraform.io/docs/internals/debugging.html&lt;/a>&lt;/p>
&lt;h4 id="ログレベルの変更">ログレベルの変更&lt;/h4>
&lt;p>&lt;code>TF_LOG&lt;/code> 環境変数に &lt;code>TRACE, DEBUG, INFO, WARN, ERROR&lt;/code> のいずれかをセットすることで変更できる。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#000">TF_LOG&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>DEBUG terraform plan
&lt;/code>&lt;/pre>&lt;/div>&lt;p>※しかし、どれを指定してもtraceレベルのログが出る気が…(v0.10.x)&lt;/p>
&lt;h3 id="countを使って複数のリソースを作成">countを使って複数のリソースを作成&lt;/h3>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Terraform" data-lang="Terraform">&lt;span style="color:#204a87;font-weight:bold">variable&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;instance_ips&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#c4a000">default&lt;/span> = &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;0&amp;#34;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;10.11.12.100&amp;#34;&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;1&amp;#34;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;10.11.12.101&amp;#34;&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;2&amp;#34;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;10.11.12.102&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">
&lt;/span>&lt;span style="color:#204a87;font-weight:bold">resource&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;aws_instance&amp;#34;&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;app&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#c4a000">count&lt;/span> = &lt;span style="color:#4e9a06">&amp;#34;3&amp;#34;&lt;/span>
&lt;span style="color:#c4a000">private_ip&lt;/span> = &lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">lookup&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87">var&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">instance_ips&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#204a87">count&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">index&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;span style="color:#8f5902;font-style:italic"> # ...
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">
&lt;/span>&lt;span style="color:#204a87;font-weight:bold">variable&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;rds_roles&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#c4a000">default&lt;/span> = &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;WRITER&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;READER&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">
&lt;/span>&lt;span style="color:#204a87;font-weight:bold">resource&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;aws_cloudwatch_metric_alarm&amp;#34;&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;rds_cpu&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#c4a000">count&lt;/span> = &lt;span style="color:#4e9a06">&amp;#34;2&amp;#34;&lt;/span>
&lt;span style="color:#c4a000">alarm_name&lt;/span> = &lt;span style="color:#4e9a06">&amp;#34;RDS-&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#204a87">var&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">rds_roles&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#204a87">count&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">index&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">-CPU&amp;#34;&lt;/span>
&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.terraform.io/docs/configuration/resources.html#using-variables-with-count">https://www.terraform.io/docs/configuration/resources.html#using-variables-with-count&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/kanagi/items/095037ba3f72de3f9572">terraformでautoscalingしているサーバのcloudwatch alarmを自動設定する - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/ringo/items/875f08ec550f0826f0dc" title="Terraform でループして複数のリソースを作成する - Qiita">Terraform でループして複数のリソースを作成する - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="変数やoutputでmapを使うと記述量が減って便利">変数やoutputでmapを使うと記述量が減って便利&lt;/h3>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/shogomuranushi/items/cc387a1233cc7f4e6e60" title="Terraformのoutputでmapを利用する方法 - Qiita">Terraformのoutputでmapを利用する方法 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="mapのlistを作る方法">mapのlistを作る方法&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://gist.github.com/brikis98/f3fe2ae06f996b40b55eebcb74ed9a9e">A hacky way to create a dynamic list of maps in Terraform&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="できない説">できない説&lt;/h4>
&lt;ul>
&lt;li>&lt;a href="https://github.com/hashicorp/terraform/issues/7705" title="Cannot pass a list of maps to a resource/data · Issue #7705 · hashicorp/terraform">Cannot pass a list of maps to a resource/data · Issue #7705 · hashicorp/terraform&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/ringo/items/875f08ec550f0826f0dc" title="Terraform でループして複数のリソースを作成する - Qiita">Terraform でループして複数のリソースを作成する - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>…が、手元で試したところ(v0.10.x)、下のようにしてlistとして定義・参照することができた。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-terraform" data-lang="terraform">&lt;span style="color:#204a87;font-weight:bold">variable&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;my_complex_data&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#c4a000">type&lt;/span> = &lt;span style="color:#204a87">&amp;#34;list&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;span style="color:#4e9a06"> default = [
&lt;/span>&lt;span style="color:#4e9a06"> {
&lt;/span>&lt;span style="color:#4e9a06"> id = &amp;#34;&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;span style="color:#4e9a06"> name = &amp;#34;&lt;/span>&lt;span style="color:#000">taro&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;span style="color:#4e9a06"> height = &amp;#34;&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">170&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;span style="color:#4e9a06"> },
&lt;/span>&lt;span style="color:#4e9a06"> {
&lt;/span>&lt;span style="color:#4e9a06"> id = &amp;#34;&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;span style="color:#4e9a06"> name = &amp;#34;&lt;/span>&lt;span style="color:#000">hanako&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;span style="color:#4e9a06"> height = &amp;#34;&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">160&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;span style="color:#4e9a06"> },
&lt;/span>&lt;span style="color:#4e9a06"> ]
&lt;/span>&lt;span style="color:#4e9a06">}
&lt;/span>&lt;span style="color:#4e9a06">
&lt;/span>&lt;span style="color:#4e9a06">foo_list = &amp;#34;&lt;/span>&lt;span style="color:#a40000">$&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#204a87">var&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">my_complex_data&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="tools">Tools&lt;/h2>
&lt;p>3rd Partyのツール&lt;/p>
&lt;h3 id="tfenv">tfenv&lt;/h3>
&lt;p>&lt;a href="https://github.com/Zordrak/tfenv">https://github.com/Zordrak/tfenv&lt;/a>&lt;/p>
&lt;p>rbenv, anyenvのようなツールで、複数バージョンのterraformを切り替えて使えるようになるもの。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/kamatama_41/items/ba59a070d8389aab7694">tfenvでTerraformのバージョン管理をする - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="参考">参考&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/minamijoyo/items/1f57c62bed781ab8f4d7" title="Terraform職人入門: 日々の運用で学んだ知見を淡々とまとめる - Qiita">Terraform職人入門: 日々の運用で学んだ知見を淡々とまとめる - Qiita&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: ターミナルソフトウェア</title><link>https://progrhy.me/tech-notes/a/software/terminal/</link><pubDate>Wed, 13 May 2020 22:23:41 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/terminal/</guid><description>
&lt;p>端末エミュレータ、ターミナルエミュレータなどとも呼ばれる。&lt;/p>
&lt;h2 id="macos">macOS&lt;/h2>
&lt;ul>
&lt;li>ターミナル.app &amp;hellip; 標準でインストールされている端末アプリ&lt;/li>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/terminal/iterm2/">iTerm2&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="topics">Topics&lt;/h2>
&lt;h3 id="色">色&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://jonasjacek.github.io/colors/">256 Colors - Cheat Sheet - Xterm, HEX, RGB, HSL&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="child-pages">Child Pages&lt;/h2></description></item><item><title>A: Software Test</title><link>https://progrhy.me/tech-notes/a/software/test/</link><pubDate>Sat, 23 May 2020 17:38:12 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/test/</guid><description>
&lt;p>Software Test Engineeringまで入るかも。&lt;br>
一旦、負荷テストもここに入れる。&lt;/p>
&lt;h2 id="負荷テストツール">負荷テストツール&lt;/h2>
&lt;p>どんなものがあるかメモ:&lt;/p>
&lt;ul>
&lt;li>ab&lt;/li>
&lt;li>JMeter&lt;/li>
&lt;li>Gatling&lt;/li>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/test/locust/">Locust&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="topics">Topics&lt;/h2>
&lt;h3 id="スタブとモックの違い">スタブとモックの違い&lt;/h3>
&lt;p>どっちがどっちかいつもよくわからなくなる。&lt;/p>
&lt;p>スタブの定義らしきもの:&lt;/p>
&lt;ul>
&lt;li>テスト対象モジュールが依存するモジュールの代用品として動作し、決められた動きをするもの&lt;/li>
&lt;/ul>
&lt;p>モックの定義らしきもの:&lt;/p>
&lt;ul>
&lt;li>テスト対象モジュール、またはスタブが利用するモジュールの代用品として動作し、どのような使われ方をしたかをチェックするもの
&lt;ul>
&lt;li>例えばどのメソッドが何回呼ばれたか、とか&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/k5trismegistus/items/10ce381d29ab62ca0ea6">スタブとモックの違い - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://gotohayato.com/content/483/">自動テストのスタブ・スパイ・モックの違い | gotohayato.com&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.weblio.jp/content/%E3%82%B9%E3%82%BF%E3%83%96">スタブとは何？ Weblio辞書&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.weblio.jp/content/%E3%83%A2%E3%83%83%E3%82%AF%E3%82%A2%E3%83%83%E3%83%97">モックアップとは何？ Weblio辞書&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>MEMO:&lt;/p>
&lt;ul>
&lt;li>2020-05-23 旧Wikiに載せていたリンクは切れてしまっていた。&lt;/li>
&lt;/ul></description></item><item><title>A: Package Managers</title><link>https://progrhy.me/tech-notes/a/software/pkg-man/</link><pubDate>Mon, 04 May 2020 17:17:16 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/pkg-man/</guid><description/></item><item><title>A: Static Site Generators</title><link>https://progrhy.me/tech-notes/a/software/static-site-generator/</link><pubDate>Wed, 06 May 2020 13:39:38 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/static-site-generator/</guid><description>
&lt;p>コンテンツをMarkdown等で管理して、静的サイトを作れるソフトウェア製品。&lt;br>
製本ツールであっても、HTML形式での出力に対応しているものはここに入れると思う。&lt;/p>
&lt;h2 id="参考">参考&lt;/h2>
&lt;p>&lt;a href="https://www.staticgen.com/">https://www.staticgen.com/&lt;/a> &amp;hellip; OSS比較サイト&lt;/p>
&lt;h2 id="child-pages">Child Pages&lt;/h2></description></item></channel></rss>