<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>progrhyme's Tech Notes – Software</title><link>https://progrhy.me/tech-notes/a/software/</link><description>Recent content in Software on progrhyme's Tech Notes</description><generator>Hugo -- gohugo.io</generator><language>ja</language><lastBuildDate>Sat, 25 Apr 2020 23:37:10 +0900</lastBuildDate><atom:link href="https://progrhy.me/tech-notes/a/software/index.xml" rel="self" type="application/rss+xml"/><item><title>A: Argo Project</title><link>https://progrhy.me/tech-notes/a/software/argo/</link><pubDate>Fri, 08 May 2020 17:20:06 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/argo/</guid><description>
&lt;p>Kubernetes向けのワークフローエンジン、CI/CDソリューションを提供するプロジェクト。&lt;/p>
&lt;h2 id="projects">Projects&lt;/h2>
&lt;ul>
&lt;li>Workflow&lt;/li>
&lt;li>CD&lt;/li>
&lt;li>Rollouts&lt;/li>
&lt;li>Events&lt;/li>
&lt;/ul>
&lt;h3 id="events">Events&lt;/h3>
&lt;p>&lt;a href="https://argoproj.github.io/argo-events/">https://argoproj.github.io/argo-events/&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>an event-driven workflow automation framework for Kubernetes which helps you trigger K8s objects, Argo Workflows, Serverless workloads, etc. on events from variety of sources like webhook, s3, schedules, messaging queues, gcp pubsub, sns, sqs, etc.&lt;/p>
&lt;/blockquote>
&lt;p>Features:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://argoproj.github.io/argo-events/triggers/argo-workflow/">Argo Workflow Trigger - Argo Events - The Event-Based Dependency Manager for Kubernetes&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="child-pages">Child Pages&lt;/h2></description></item><item><title>A: Docker</title><link>https://progrhy.me/tech-notes/a/software/docker/</link><pubDate>Wed, 29 Apr 2020 11:59:18 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/docker/</guid><description>
&lt;h2 id="documentation">Documentation&lt;/h2>
&lt;p>公式:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.docker.com/">https://docs.docker.com/&lt;/a>&lt;/li>
&lt;li>リファレンス: &lt;a href="https://docs.docker.com/reference/">https://docs.docker.com/reference/&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://docs.docker.com/engine/reference/builder/">Dockerfile&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.docker.com/engine/reference/commandline/docker/">dockerコマンド&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>3rd Party:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://docs.docker.jp/">Docker ドキュメント日本語化プロジェクト — Docker-docs-ja&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="getting-started">Getting Started&lt;/h2>
&lt;p>入門コンテンツ:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.docker.com/engine/tutorials/">Engine tutorials | Docker Documentation&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="how-to">How-to&lt;/h2>
&lt;h3 id="dockerコンテナからホストosのlocalhostにアクセスする">dockerコンテナからホストOSのlocalhostにアクセスする&lt;/h3>
&lt;p>Docker for MacやDocker for Windowsなら、 &lt;code>host.docker.internal&lt;/code> でアクセスできる。&lt;/p>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>docker run -it --rm mysql mysql -hhost.docker.internal -uroot -p
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/ijufumi/items/badde64d530e6bade382">Dockerのコンテナの中からホストOS上のプロセスと通信する方法 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="knowledge">Knowledge&lt;/h2>
&lt;h3 id="コンテナの終了コード">コンテナの終了コード&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Exit Code&lt;/th>
&lt;th>意味&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>0&lt;/td>
&lt;td>正常終了&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>1&lt;/td>
&lt;td>アプリケーションエラー&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>137&lt;/td>
&lt;td>SIGKILL (OOMなど)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>139&lt;/td>
&lt;td>SIGSEGV&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>143&lt;/td>
&lt;td>SIGTERM&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://medium.com/better-programming/understanding-docker-container-exit-codes-5ee79a1d58f6">Understanding Docker Container Exit Codes | by Sandeep Madamanchi | Better Programming | Medium&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="registry">Registry&lt;/h2>
&lt;h3 id="api">API&lt;/h3>
&lt;p>&lt;a href="https://docs.docker.com/registry/spec/api/">https://docs.docker.com/registry/spec/api/&lt;/a>&lt;/p>
&lt;p>認証:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.docker.com/registry/spec/auth/token/">Token Authentication Specification | Docker Documentation&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://himenon.github.io/docker/registry-api/">Docker Registry API v2を利用してtag、manifest、imageの情報を取得する&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="cli">CLI&lt;/h3>
&lt;p>&lt;a href="https://github.com/genuinetools/reg">https://github.com/genuinetools/reg&lt;/a>&lt;/p>
&lt;p>v2 APIに対応したCLI. Webサーバや脆弱性スキャン機能まである。&lt;/p>
&lt;p>Install:&lt;/p>
&lt;ul>
&lt;li>&lt;code>go get&lt;/code>&lt;/li>
&lt;li>バイナリをGitHub ReleasesからDL&lt;/li>
&lt;/ul>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># タグ一覧&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>reg tags &amp;lt;repo&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="docker-hub">Docker Hub&lt;/h2>
&lt;p>&lt;a href="https://hub.docker.com/">https://hub.docker.com/&lt;/a>&lt;/p>
&lt;p>Dockerイメージのレジストリサービス。&lt;br>
有料プランなら非公開リポジトリも作れる。&lt;/p>
&lt;h3 id="公式イメージ">公式イメージ&lt;/h3>
&lt;h4 id="openjdk">openjdk&lt;/h4>
&lt;ul>
&lt;li>&lt;a href="https://hub.docker.com/_/openjdk">https://hub.docker.com/_/openjdk&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/docker-library/openjdk/">https://github.com/docker-library/openjdk/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Javaのリリースサイクルが短くなったこともあり、メンテされているバージョンが多くて所望のイメージを探すのにちょっと苦労する。&lt;/p>
&lt;h4 id="scratch">scratch&lt;/h4>
&lt;p>最小限のイメージ。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://hub.docker.com/_/scratch">https://hub.docker.com/_/scratch&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://dev.classmethod.jp/articles/exploration-to-docker-scratch/">Dockerのscratchイメージを探検する | DevelopersIO&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="child-pages">Child Pages&lt;/h2></description></item><item><title>A: Elasticsearch</title><link>https://progrhy.me/tech-notes/a/software/elasticsearch/</link><pubDate>Fri, 10 Jul 2020 23:39:27 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/elasticsearch/</guid><description>
&lt;h2 id="architecture">Architecture&lt;/h2>
&lt;p>ノードの種類:&lt;/p>
&lt;ul>
&lt;li>Master node &amp;hellip; クラスタで1台だけ&lt;/li>
&lt;li>Master-eligible node &amp;hellip; マスター候補。マスターが故障したら、この中から新たなマスターが選ばれる。&lt;/li>
&lt;li>Data node&lt;/li>
&lt;li>Coordinating node&lt;/li>
&lt;li>Coordinating only node&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.slideshare.net/snuffkin/elasticsearch-107454226">はじめてのElasticsearchクラスタ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://gist.github.com/yano3/3f5abc9eba0c1ad6a0508056961b273c">Elasticsearch クラスタ概説&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.creationline.com/blog/15831">elasticsearchでノード障害が起きたときの動作 #elastic - クリエーションライン株式会社&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="kubernetes">Kubernetes&lt;/h2>
&lt;p>スタートガイド:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-quickstart.html">Quickstart | Elastic Cloud on Kubernetes [1.1] | Elastic&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/ryo-yamaoka/items/0b968112f03672991a5f">Elasticsearch on GKEで注意すべき可用性・耐久性のポイント - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="releases">Releases&lt;/h2>
&lt;h3 id="v60">v6.0&lt;/h3>
&lt;p>Breaking Changes: &lt;a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/breaking-changes-6.0.html">https://www.elastic.co/guide/en/elasticsearch/reference/6.0/breaking-changes-6.0.html&lt;/a>&lt;/p>
&lt;ul>
&lt;li>複数のmapping typesを持つindexは作れなくなった。&lt;/li>
&lt;/ul>
&lt;h2 id="mapping">Mapping&lt;/h2>
&lt;p>JSONとかでデータを入れると良い感じにマッピングしてくれる印象。&lt;br>
Kibanaとか。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://medium.com/hello-elasticsearch/elasticsearch-9a8743746467" title="Elasticsearch マッピング – Hello! Elasticsearch. – Medium">Elasticsearch マッピング – Hello! Elasticsearch. – Medium&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="データ型">データ型&lt;/h3>
&lt;p>&lt;a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-types.html&lt;/a>&lt;/p>
&lt;h4 id="数値型">数値型&lt;/h4>
&lt;p>&lt;a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/number.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/number.html&lt;/a>&lt;/p>
&lt;ul>
&lt;li>整数型: byte, short, integer, long&lt;/li>
&lt;li>実数型: &lt;code>scaled_float&lt;/code>, &lt;code>half_float&lt;/code>, &lt;code>float&lt;/code>, &lt;code>double&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="運用">運用&lt;/h2>
&lt;h3 id="ヒープダンプでdiskを消費する">ヒープダンプでDiskを消費する&lt;/h3>
&lt;p>ElasticsearchのデフォルトのJVM起動引数に &lt;code>-XX:+HeapDumpOnOutOfMemoryError&lt;/code> がついているそうで、メモリの少ない環境で動かしていると、Elasticsearchを起動したディレクトリに数GBサイズの &lt;code>java_pidXXXX.hprof&lt;/code> ファイルが吐かれるようだ。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/aya_eiya/items/f0871f58c7eb23c85ee8">Elasticsearchをメモリの足りない環境で動かしているとDisk Fullになる。 - Qiita&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: Embulk</title><link>https://progrhy.me/tech-notes/a/software/embulk/</link><pubDate>Wed, 01 Jul 2020 20:19:41 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/embulk/</guid><description>
&lt;h2 id="about">About&lt;/h2>
&lt;p>Treasure Data社発のOSSで、プラガブルなETLフレームワーク的なソフトウェア。&lt;/p>
&lt;p>Documentation: &lt;a href="https://www.embulk.org/docs/">https://www.embulk.org/docs/&lt;/a>&lt;/p>
&lt;h2 id="spec">Spec&lt;/h2>
&lt;ul>
&lt;li>内部に独自データ型を持っているようで、Inputプラグインから受け取る際に一度変換が起こる&lt;/li>
&lt;/ul>
&lt;h2 id="configuration">Configuration&lt;/h2>
&lt;ul>
&lt;li>YAMLまたは&lt;a href="https://shopify.github.io/liquid/">Liquidテンプレート&lt;/a>。&lt;/li>
&lt;/ul>
&lt;h3 id="liquidテンプレート">Liquidテンプレート&lt;/h3>
&lt;p>&lt;a href="https://www.embulk.org/docs/built-in.html#using-variables">https://www.embulk.org/docs/built-in.html#using-variables&lt;/a>&lt;/p>
&lt;p>重要:&lt;/p>
&lt;ul>
&lt;li>Liquidテンプレートを使う場合、 &lt;strong>拡張子は必ず &lt;code>.yml.liquid&lt;/code> にしなければならない&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>機能:&lt;/p>
&lt;ul>
&lt;li>環境変数の利用。例: &lt;code>{{ env.ENV_KEY }}&lt;/code>&lt;/li>
&lt;li>include&lt;/li>
&lt;/ul>
&lt;h3 id="フォーマット">フォーマット&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">in&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># Input plugin&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">paraser&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># Parser plugin&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">decoder&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># Decoder plugin&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">out&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># Output plugin&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">formatter&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># Formatter plugin&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">encoder&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># Encoder plugin&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">filters&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># Filter plugin&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">exec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># Executor plugin&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="cli">CLI&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 実行&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>embulk run &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>OPTIONS&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> config.yml&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>.liquid&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># プレビュー&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>embulk preview &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>OPTIONS&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> config.yml&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>.liquid&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Option&lt;/th>
&lt;th>値&lt;/th>
&lt;th>機能&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>-l, --log-level LEVEL&lt;/code>&lt;/td>
&lt;td>trace,debug,info,warn,error&lt;/td>
&lt;td>ログレベル&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="troubles">Troubles&lt;/h2>
&lt;p>遭遇したエラーなどについて書く。&lt;br>
個別のプラグインの問題は&lt;a href="https://progrhy.me/tech-notes/a/software/embulk/plugin/">Plugins&lt;/a>に記す。&lt;/p>
&lt;p>全体的にエラーがわかりづらいと思う。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://techlog.voyagegroup.com/entry/2017/07/31/173839">大量データの転送にEmbulkを使ってみたら本当に楽だった - VOYAGE GROUP techlog&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="setting-null-to-a-task-field-is-not-allowed">Setting null to a task field is not allowed&lt;/h3>
&lt;p>例:&lt;/p>
&lt;pre tabindex="0">&lt;code>Error: org.embulk.config.ConfigException: com.fasterxml.jackson.databind. \
JsonMappingException: Setting null to a task field is not allowed. Use Optional&amp;lt;T&amp;gt; \
(com.google.common.base.Optional) to represent null.
&lt;/code>&lt;/pre>&lt;p>どうも、configの設定値が取れなかったときに起こるエラーっぽい。&lt;br>
よくあるのは、環境変数の設定ミス（一度やらかした）。&lt;/p>
&lt;ul>
&lt;li>キーが間違っていないか&lt;/li>
&lt;li>exportしているか&lt;/li>
&lt;/ul>
&lt;p>などを確認するとよさそう。&lt;/p>
&lt;h3 id="a-buffer-detected-double-release-calls">A Buffer detected double release() calls&lt;/h3>
&lt;p>2020年7月、MySQL -&amp;gt; BigQueryへのETL操作をAWS ECS Fargate上で実行しているときに、50GB以上の大きなテーブルで起こった。&lt;/p>
&lt;ul>
&lt;li>ログ: &lt;a href="https://gist.github.com/progrhyme/a0455ba29e3c590daacdb187d3f8282b">https://gist.github.com/progrhyme/a0455ba29e3c590daacdb187d3f8282b&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>今のところ、ECS Taskのストレージ不足なのでは、という気がしている。&lt;br>
Fargateのエフェメラルストレージは20GB程度しかないようなので。&lt;/p>
&lt;blockquote class="twitter-tweet">&lt;p lang="ja" dir="ltr">ありがとうございます。Errno::ENOSPCって出ているから、中間データを書き込むためのディスク容量が足りないってことはないですか？&lt;/p>&amp;mdash; Hiroyuki Sato (@hiroysato) &lt;a href="https://twitter.com/hiroysato/status/1281580625602834438?ref_src=twsrc%5Etfw">July 10, 2020&lt;/a>&lt;/blockquote> &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8">&lt;/script>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/fargate-task-storage.html">Fargate タスクストレージ - Amazon Elastic Container Service&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: Git</title><link>https://progrhy.me/tech-notes/a/software/git/</link><pubDate>Mon, 27 Apr 2020 23:03:01 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/git/</guid><description>
&lt;h2 id="プロトコル">プロトコル&lt;/h2>
&lt;p>&lt;a href="https://git-scm.com/book/en/v2/Git-on-the-Server-The-Protocols">https://git-scm.com/book/en/v2/Git-on-the-Server-The-Protocols&lt;/a>&lt;/p>
&lt;ul>
&lt;li>Local Protocol
&lt;ul>
&lt;li>&lt;code>git clone path/to/repo&lt;/code>&lt;/li>
&lt;li>&lt;code>git clone file:///path/to/repo&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>HTTP Protocols
&lt;ul>
&lt;li>&lt;code>git clone https://example.com/gitproject.git&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>SSH Protocol
&lt;ul>
&lt;li>&lt;code>git clone ssh://[user@]server/project.git&lt;/code>&lt;/li>
&lt;li>&lt;code>git clone [user@]server:project.git&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Git Protocol &amp;hellip; 最も高速だが、認証がない
&lt;ul>
&lt;li>&lt;code>git clone git://server/project.git&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://stackoverflow.com/questions/31801271/what-are-the-supported-git-url-formats">github - What are the supported git url formats? - Stack Overflow&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="config">config&lt;/h2>
&lt;p>&lt;a href="https://git-scm.com/docs/git-config">https://git-scm.com/docs/git-config&lt;/a>&lt;/p>
&lt;h3 id="aliasの設定">aliasの設定&lt;/h3>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-INI" data-lang="INI">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">[alias]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c4a000">st&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">status
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> dfc = diff --cached&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Tips:&lt;/p>
&lt;ul>
&lt;li>右辺を &lt;code>!&lt;/code> から記述すると外部コマンドを記述できる&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/peccul/items/90dd469e2f72babbc106">gitで便利なエイリアス達 - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/akirashi/items/2b5cf0f32777aaaf6287">git aliasで外部コマンドを呼び出して便利にしてみる - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="include">include&lt;/h3>
&lt;p>別ファイルをincludeできる&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-INI" data-lang="INI">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">[include]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c4a000">path&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">.gitconfig.local&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://z3100.hatenadiary.org/entry/20120505/1336203155">.gitconfigで別ファイルを読み込む - 3100&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="includeif">includeIf&lt;/h3>
&lt;p>条件に基づいて別ファイルをincludeする。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://kawaken.hateblo.jp/entry/2017/08/05/235904">git-configのConditional includesでユーザ情報を切り替える - kawaken&amp;rsquo;s blog&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="pull">pull&lt;/h3>
&lt;p>&lt;a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-pullff">https://git-scm.com/docs/git-config#Documentation/git-config.txt-pullff&lt;/a>&lt;/p>
&lt;p>pull時の挙動を設定する。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-INI" data-lang="INI">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">[pull]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8f5902;font-style:italic"># 以下いずれかを指定&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c4a000">ff&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">only # fast-forwardなマージのみ許可。マージコミットを作らない
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> ff = false # fast-forwardなときもマージコミットを作る
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> rebase = merges # rebaseする。ローカルのマージコミットは消失
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> rebase = preserve # マージコミットを保持してrebaseする&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>コミット履歴をきれいに保ちたいなら &lt;code>rebase = merges&lt;/code> だが、リモートと歴史が変わってしまったときにローカルの履歴が失われるリスクがあると思う。 &lt;code>rebase = preserve&lt;/code> なら大丈夫かもしれない&lt;/li>
&lt;li>&lt;code>ff = only&lt;/code> は無難な設定&lt;/li>
&lt;li>&lt;code>ff = false&lt;/code> を設定したい理由はわからない&lt;/li>
&lt;/ul>
&lt;p>関連項目:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/git/cli/#pull">gitコマンド#pull&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/memo/2020/20200620/#gitconfig%E3%81%A7pullrebase--true%E3%81%AB%E3%81%97%E3%81%A6%E3%81%84%E3%81%9F%E3%82%89%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%AE%E5%B1%A5%E6%AD%B4%E3%81%8C%E5%A4%B1%E3%82%8F%E3%82%8C%E3%81%9F">2020-06-20#gitconfigでpull.rebase=trueにしていたらローカルの履歴が失われた&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/nog/items/c79469afbf3e632f10a1">gitのmerge &amp;ndash;no-ff のススメ - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="how-to">How-to&lt;/h2>
&lt;p>See also &lt;a href="https://progrhy.me/tech-notes/a/software/git/cli/">gitコマンド&lt;/a>&lt;/p>
&lt;h3 id="git-diffをpatch適用する">git diffをpatch適用する&lt;/h3>
&lt;p>2020-06-20記入。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>git diff &amp;gt; foo.diff
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git apply foo.diff
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>今はこれでよいようだ。&lt;/p>
&lt;p>メモ:&lt;/p>
&lt;ul>
&lt;li>昔はgit diffにオプションをつけて、patchコマンドを使ってapplyしていたが、簡単になったものだ。&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://beyondjapan.com/blog/2019/08/git-diff/">git diff で作ったパッチはどうやって当てるのか（そもそも git でパッチ | 株式会社ビヨンド&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="committerとauthorを変更する">CommitterとAuthorを変更する&lt;/h3>
&lt;p>HEADのcommitを修正する場合:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>git config --local user.name &lt;span style="color:#4e9a06">&amp;#34;YOUR NAME&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git config --local user.email your-address@example.com
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git commit --amend --reset-author
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>過去の履歴についても変更したい場合:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>git rebase -i &amp;lt;commit hash&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"># 該当するコミットを `e` で選ぶ&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git commit --amend --reset-author
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git rebase --continue
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://tech-1natsu.hatenablog.com/entry/2018/10/19/021855">過去のgitコミットのCommitとAuthor情報を修正する - ひと夏の技術&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/sea_mountain/items/d70216a5bc16a88ed932">Git の Commit Author と Commiter を変更する - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="歴史を改ざんする">歴史を改ざんする&lt;/h3>
&lt;p>See &lt;a href="https://git-scm.com/book/ja/v2/Git-%E3%81%AE%E3%81%95%E3%81%BE%E3%81%96%E3%81%BE%E3%81%AA%E3%83%84%E3%83%BC%E3%83%AB-%E6%AD%B4%E5%8F%B2%E3%81%AE%E6%9B%B8%E3%81%8D%E6%8F%9B%E3%81%88">Git - 歴史の書き換え&lt;/a>&lt;/p>
&lt;h4 id="特定のファイルディレクトリの履歴を完全に削除">特定のファイル・ディレクトリの履歴を完全に削除&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">## file&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git filter-branch --tree-filter &lt;span style="color:#4e9a06">&amp;#39;rm -f path/to/file&amp;#39;&lt;/span> HEAD
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">## directory&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git filter-branch --tree-filter &lt;span style="color:#4e9a06">&amp;#39;rm -rf path/to/dir/&amp;#39;&lt;/span> HEAD
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://gist.github.com/ktx2207/3167fa69531bdd6b44f1">Git ファイルの履歴を完全に削除する&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="マージコミットを-cherry-pick">マージコミットを cherry-pick&lt;/h3>
&lt;p>merge commit を cherry-pick&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>git cherry-pick -m &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span> &amp;lt;merge commit のハッシュ&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://qiita.com/takc923/items/8e2d87d692f840b14464" title="merge commitをcherry-pickする - Qiita">merge commitをcherry-pickする - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="マージ済みブランチを掃除する">マージ済みブランチを掃除する&lt;/h3>
&lt;p>色んな人がやっていて、aliasに設定したりサブコマンドを作ったりしている。&lt;/p>
&lt;p>自分でも&lt;a href="https://progrhy.me/tech-notes/a/memo/2020/20200504/#git-pull---prune%E3%81%97%E3%81%A6%E3%83%9E%E3%83%BC%E3%82%B8%E6%B8%88%E3%81%BF%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%82%92%E6%8E%83%E9%99%A4%E3%81%99%E3%82%8Bgit%E3%81%AE%E3%82%B5%E3%83%96%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F">2020-05-04に作った&lt;/a>。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/kenshiroh/items/44dcf4b094e841bb42a2">gitでbranchをお掃除する際のチートシート - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="特定のファイルを-git-管理対象から除外する">特定のファイルを Git 管理対象から除外する&lt;/h3>
&lt;p>①&lt;code>.gitignore&lt;/code> や &lt;code>.git/info/exclude&lt;/code> を使う&lt;/p>
&lt;p>②既に Git 管理下にあるファイルをワーキングツリーで敢えて除外する&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>git update-index —assume-unchanged &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ファイル名&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git update-index —skip-worktree &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ファイル名&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">## 確認&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git ls-files -v
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">## 取り消し&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git update-index —no-assume-unchanged &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ファイル名&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git update-index —no-skip-worktree &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ファイル名&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>git ls-files -v の表示:&lt;/p>
&lt;ul>
&lt;li>assume-unchanged 設定のファイルは、状態が小文字で表示される&lt;/li>
&lt;li>skip-worktree 設定のファイルは、状態が S と表示される&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://qiita.com/usamik26/items/56d0d3ba7a1300625f92">既に git 管理しているファイルをあえて無視したい - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="リポジトリをサブディレクトリで分割">リポジトリをサブディレクトリで分割&lt;/h3>
&lt;h4 id="サブディレクトリが1つの場合">サブディレクトリが1つの場合&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>git clone original_dir new_dir
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">cd&lt;/span> new_dir
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>git filter-branch --subdirectory-filter sub_dir_name HEAD
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://akio0911.net/archives/3421">gitリポジトリのサブディレクトリを別のリポジトリとして抽出する方法 - 拡張現実ライフ&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="サブディレクトリが複数の場合">サブディレクトリが複数の場合&lt;/h4>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://stackoverflow.com/questions/2982055/detach-many-subdirectories-into-a-new-separate-git-repository">git filter branch - Detach many subdirectories into a new, separate Git repository - Stack Overflow&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="topics">Topics&lt;/h2>
&lt;h3 id="コミットメッセージの書き方">コミットメッセージの書き方&lt;/h3>
&lt;p>長さ:&lt;/p>
&lt;ul>
&lt;li>よく知られているガイドラインは50/72ルールというもので、タイトル行を50文字以内に、そのあと1行空けて、続くメッセージは1行が72字以内に収まるように書くというもの&lt;/li>
&lt;/ul>
&lt;p>文法:&lt;/p>
&lt;ul>
&lt;li>タイトル行は命令形で書くのがいいらしい&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://postd.cc/how-to-write-a-git-commit-message/">Gitのコミットメッセージの書き方 | POSTD&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.midori-global.com/blog/2018/04/02/git-50-72-rule">Git 50/72: the rule of well formed Git commit messages | Midori&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: Infrastructure as Code</title><link>https://progrhy.me/tech-notes/a/software/infra-as-code/</link><pubDate>Tue, 12 May 2020 07:01:35 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/infra-as-code/</guid><description>
&lt;p>ITインフラの構成をコードで管理できるようにしてくれるソフトウェアについて書く。&lt;/p>
&lt;h2 id="software">Software&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://www.pulumi.com/product/">Pulumi&lt;/a> &amp;hellip; 各種クラウドの構成管理を高級言語で行える&lt;/li>
&lt;li>&lt;a href="https://gocloud.dev/">Go CDK (Cloud Development Kit)&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/terraform/">Terraform&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: Kubernetes</title><link>https://progrhy.me/tech-notes/a/software/k8s/</link><pubDate>Mon, 27 Apr 2020 10:39:49 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/k8s/</guid><description>
&lt;p>関連ページ:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/google/gcp/gke/">Google Cloud &amp;gt; GKE&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="getting-started">Getting Started&lt;/h2>
&lt;h3 id="documentation">Documentation&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/home/">https://kubernetes.io/docs/home/&lt;/a> &amp;hellip; ドキュメント
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/tutorials/">https://kubernetes.io/docs/tutorials/&lt;/a> &amp;hellip; チュートリアル&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/">https://kubernetes.io/docs/tasks/&lt;/a> &amp;hellip; How-toガイド&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/glossary/?fundamental=true">Standardized Glossary - Kubernetes&lt;/a> &amp;hellip; 用語集&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/advent-calendar/2018/k8s-dojo">Kubernetes道場 Advent Calendar 2018 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="リファレンス">リファレンス&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/">https://kubernetes.io/docs/reference/&lt;/a>
&lt;ul>
&lt;li>APIリファレンス&lt;/li>
&lt;li>CLIリファレンス&lt;/li>
&lt;li>etc.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="ベストプラクティス">ベストプラクティス&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/concepts/configuration/overview/">Configuration Best Practices | Kubernetes&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ケーススタディ">ケーススタディ&lt;/h2>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://k8s.af/">Kubernetes Failure Stories&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="versions">Versions&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/setup/release/version-skew-policy/">Kubernetes version and version skew support policy - Kubernetes&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="how-to">How-to&lt;/h2>
&lt;h3 id="podの再起動">Podの再起動&lt;/h3>
&lt;ul>
&lt;li>K8sはクラスタの状態を宣言型で記述するので、「再起動する」というのを指示するのは難しいようだ&lt;/li>
&lt;li>下の記事にあるように、Deploymentの定義を変えてapplyするのが良いだろう&lt;/li>
&lt;li>レプリカの数を0にして増やすという手もある&lt;/li>
&lt;/ul>
&lt;p>See&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/dtan4/items/9e0ab5dbe8c64ed6dd21">全ての Pod を一発でリロードさせる方法 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="複数クラスタを設定する">複数クラスタを設定する&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/">https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/&lt;/a> &amp;hellip; &lt;code>kubectl config use-context&lt;/code> で複数クラスタを切り替えられるようにする設定チュートリアル&lt;/li>
&lt;/ul>
&lt;h3 id="機密情報や環境設定の扱い">機密情報や環境設定の扱い&lt;/h3>
&lt;p>SecretsやConfigMapを使う。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://tellme.tokyo/post/2018/08/07/kubernetes-configmaps-secrets/">Kubernetes 上で Credentials を扱う | tellme.tokyo&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="namespaceの削除">Namespaceの削除&lt;/h3>
&lt;p>&lt;a href="https://kubernetes.io/docs/tasks/administer-cluster/namespaces/#deleting-a-namespace">https://kubernetes.io/docs/tasks/administer-cluster/namespaces/#deleting-a-namespace&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>kubectl delete namespace my-ns
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>kubectl delete -f my-ns.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/yusuke_kinoshita/items/d1302cc3ad4657ad3466">Kubernetesでnamespaceを作成・変更・削除する方法 - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://dev.classmethod.jp/articles/k8s-namespace-force-delete/">[小ネタ]Kubernetesで消せないNamespaceが発生した場合の対処方法 | Developers.IO&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="全リソースオブジェクト取得">全リソースオブジェクト取得&lt;/h3>
&lt;p>&lt;code>kubectl get all&lt;/code> では一部しか取れない。&lt;/p>
&lt;p>こんな感じで行ける。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>kubectl api-resources --verbs&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>list --namespaced -o name &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> xargs -n &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span> kubectl get --show-kind --ignore-not-found -l &amp;lt;label&amp;gt;&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&amp;lt;value&amp;gt; -n &amp;lt;namespace&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考: &lt;a href="https://github.com/kubernetes/kubectl/issues/151#issuecomment-402003022">https://github.com/kubernetes/kubectl/issues/151#issuecomment-402003022&lt;/a>&lt;/p>
&lt;h2 id="topics">Topics&lt;/h2>
&lt;h3 id="cfs-quotaが有効のときcpu-limits設定によってコンテナがストールする問題">CFS quotaが有効のときCPU limits設定によってコンテナがストールする問題&lt;/h3>
&lt;p>2018年には起こっていた問題。&lt;br>
2020-04-14現在の状況は不明。&lt;/p>
&lt;p>TL;DR:&lt;/p>
&lt;ul>
&lt;li>KubeletでCPU CFS quota有効だと問題
&lt;ul>
&lt;li>OS kernelのスケジューラがCFSだったらデフォルト有効だと思う&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>デフォルトの &lt;code>cpu.cfs_period_us&lt;/code> が100ms &amp;hellip; この単位時間でクォータがリセットされる&lt;/li>
&lt;li>マルチコアのマシン上に複数Podがスケジュールされたとき、複数のPodが同時にCPUを使うと、すぐにlimitsに達してスロットルされてしまうことが起こり得る&lt;/li>
&lt;/ul>
&lt;p>仕組みについては、下の記事が詳しい:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://medium.com/omio-engineering/cpu-limits-and-aggressive-throttling-in-kubernetes-c5b20bd8a718">CPU limits and aggressive throttling in Kubernetes - Omio Engineering - Medium&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>関連リソース:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/issues/67577">CFS quotas can lead to unnecessary throttling · Issue #67577 · kubernetes/kubernetes&lt;/a> &amp;hellip; 2020-04-14現在、まだOpen&lt;/li>
&lt;li>&lt;a href="https://www.slideshare.net/try_except_/optimizing-kubernetes-resource-requestslimits-for-costefficiency-and-latency-highload">Optimizing Kubernetes Resource Requests/Limits for Cost-Efficiency an…&lt;/a> pp.24-43&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/administer-cluster/cpu-management-policies/">Control CPU Management Policies on the Node - Kubernetes&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://christina04.hatenablog.com/entry/kubernetes-resource-limits">Kubernetesのresource requests, limits - Carpe Diem&lt;/a>&lt;/li>
&lt;li>Kubeletの設定:
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/">kubelet - Kubernetes&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/administer-cluster/kubelet-config-file/">Set Kubelet parameters via a config file - Kubernetes&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="クラスタが大きくなるとどんな問題があるか">クラスタが大きくなるとどんな問題があるか？&lt;/h3>
&lt;p>巷では不安定になるとよく言われるが、どのくらいやばいのか、どんな問題が起こり得るのかを考察する。&lt;/p>
&lt;p>起こり得る問題:&lt;/p>
&lt;ul>
&lt;li>Pod Affinityを使っている場合に、スケジューリングが遅くなる。
&lt;ul>
&lt;li>ref. &lt;a href="https://kubernetes.io/ja/docs/concepts/configuration/assign-pod-node/">https://kubernetes.io/ja/docs/concepts/configuration/assign-pod-node/&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>Inter-Pod AffinityとAnti-Affinityは、大規模なクラスター上で使用する際にスケジューリングを非常に遅くする恐れのある多くの処理を要します。 そのため、数百台以上のNodeから成るクラスターでは使用することを推奨されません。&lt;/p>
&lt;/blockquote>
&lt;h4 id="gke-google-kubernetes-engine-の場合">GKE (Google Kubernetes Engine) の場合&lt;/h4>
&lt;ul>
&lt;li>内部TCP/UDPロードバランサのバックエンドVMの最大数が250
&lt;ul>
&lt;li>&lt;a href="https://cloud.google.com/kubernetes-engine/docs/how-to/internal-load-balancing?hl=ja#limits">https://cloud.google.com/kubernetes-engine/docs/how-to/internal-load-balancing?hl=ja#limits&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="child-pages">Child Pages&lt;/h2></description></item><item><title>A: MySQL</title><link>https://progrhy.me/tech-notes/a/software/mysql/</link><pubDate>Mon, 22 Jun 2020 16:02:33 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/mysql/</guid><description>
&lt;h2 id="about">About&lt;/h2>
&lt;p>アイコンはイルカ。&lt;/p>
&lt;h2 id="docker">Docker&lt;/h2>
&lt;p>公式イメージ: &lt;a href="https://hub.docker.com/_/mysql">https://hub.docker.com/_/mysql&lt;/a>&lt;/p>
&lt;h2 id="innodb">InnoDB&lt;/h2>
&lt;p>MySQL 5.1ぐらいからデフォルトのストレージエンジンになった。&lt;br>
MySQL 5.7からシステムテーブルでも使われるようになった。&lt;/p>
&lt;h3 id="ロック">ロック&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://dev.mysql.com/doc/refman/5.6/ja/innodb-record-level-locks.html">MySQL :: MySQL 5.6 リファレンスマニュアル :: 14.2.6 InnoDB のレコード、ギャップ、およびネクストキーロック&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="データ構造">データ構造&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://dev.mysql.com/doc/refman/5.6/ja/innodb-physical-record.html">MySQL :: MySQL 5.6 リファレンスマニュアル :: 14.2.13.7 物理的な行構造&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="cli-options">CLI Options&lt;/h2>
&lt;p>&lt;a href="https://dev.mysql.com/doc/refman/8.0/en/option-file-options.html">https://dev.mysql.com/doc/refman/8.0/en/option-file-options.html&lt;/a>&lt;/p>
&lt;p>サーバ、クライアント両対応のオプションっぽい。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Option&lt;/th>
&lt;th>機能&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>--defaults-file&lt;/code>&lt;/td>
&lt;td>my.cnfなどの設定ファイル。これを指定すると一部の例外を除き他の設定ファイルを読まなくなる&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>--defaults-extra-file&lt;/code>&lt;/td>
&lt;td>my.cnfなどの設定ファイル。グローバルオプションファイルを読んだ後、ログインパスのファイルを読む前に読み込まれる&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>NOTE:&lt;/p>
&lt;ul>
&lt;li>&lt;code>--defaults-file&lt;/code> 等のオプションは他のオプションハンドリングにも関わるから、他のオプションよりも前に指定しないといけない、とドキュメントに書かれている&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>Because these options affect option-file handling, they must be given on the command line and not in an option file. To work properly, each of these options must be given before other options, with these exceptions:&lt;/p>
&lt;/blockquote>
&lt;h2 id="specs">Specs&lt;/h2>
&lt;h3 id="charsetとcollate">CHARSETとCOLLATE&lt;/h3>
&lt;p>ドキュメント:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://dev.mysql.com/doc/refman/5.6/ja/charset-connection.html">MySQL :: MySQL 5.6 リファレンスマニュアル :: 10.1.4 接続文字セットおよび照合順序&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>キーワード:&lt;/p>
&lt;ul>
&lt;li>🍣🍺問題, ハハパパ問題&lt;/li>
&lt;/ul>
&lt;p>SQLでの確認方法:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">-- charset
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">show&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">variables&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">like&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#39;chara%&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">-- collation
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">show&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">variables&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">like&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#39;collation%&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="クライアントでの指定">クライアントでの指定&lt;/h4>
&lt;p>いくつか設定方法がある:&lt;/p>
&lt;ul>
&lt;li>&lt;code>my.cnf&lt;/code> での指定&lt;/li>
&lt;li>接続後にSQLで指定:
&lt;ul>
&lt;li>&lt;code>SET NAMES '&amp;lt;charset&amp;gt;' [COLLATE '&amp;lt;collation&amp;gt;']&lt;/code> &amp;lt;- 基本、これでよさそう&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="sql-mode">SQL Mode&lt;/h3>
&lt;p>&lt;a href="https://dev.mysql.com/doc/refman/8.0/en/sql-mode.html">https://dev.mysql.com/doc/refman/8.0/en/sql-mode.html&lt;/a>&lt;/p>
&lt;p>サーバのSQLモード。&lt;/p>
&lt;ul>
&lt;li>&lt;code>NO_ZERO_DATE&lt;/code> &amp;hellip; &lt;code>0000-00-00&lt;/code> を日付として許可しない。&lt;/li>
&lt;/ul>
&lt;h3 id="権限">権限&lt;/h3>
&lt;p>&lt;a href="https://dev.mysql.com/doc/refman/8.0/en/grant.html">https://dev.mysql.com/doc/refman/8.0/en/grant.html&lt;/a>&lt;/p>
&lt;p>GRANT文やREVOKE文で指定できる権限。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>権限&lt;/th>
&lt;th>付与可能レベル&lt;/th>
&lt;th>意味&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>PROCESS&lt;/td>
&lt;td>グローバル&lt;/td>
&lt;td>ユーザーが SHOW PROCESSLIST を使用してすべてのプロセスを表示できるようにする&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="information_schema">INFORMATION_SCHEMA&lt;/h3>
&lt;p>&lt;a href="https://dev.mysql.com/doc/refman/5.6/ja/information-schema.html">https://dev.mysql.com/doc/refman/5.6/ja/information-schema.html&lt;/a>&lt;/p>
&lt;p>メタデータDB&lt;/p>
&lt;h4 id="columns">COLUMNS&lt;/h4>
&lt;p>&lt;a href="https://dev.mysql.com/doc/refman/5.6/ja/information-schema-columns-table.html">https://dev.mysql.com/doc/refman/5.6/ja/information-schema-columns-table.html&lt;/a>&lt;/p>
&lt;h2 id="features">Features&lt;/h2>
&lt;h3 id="レプリケーション">レプリケーション&lt;/h3>
&lt;h4 id="レプリケーションとトリガー">レプリケーションとトリガー&lt;/h4>
&lt;p>Ref. &lt;a href="https://dev.mysql.com/doc/refman/5.6/ja/replication-features-triggers.html">MySQL :: MySQL 5.6 リファレンスマニュアル :: 17.4.1.32 レプリケーションとトリガー&lt;/a>&lt;/p>
&lt;ul>
&lt;li>ステートメントベースレプリケーションの場合
&lt;ul>
&lt;li>トリガーがスレーブでも実行される&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>行ベースレプリケーションの場合
&lt;ul>
&lt;li>トリガーはスレーブでは実行されない&lt;/li>
&lt;li>マスターの行変更が複製され、スレーブに適用される&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="オンラインddl">オンラインDDL&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://dev.mysql.com/doc/refman/5.6/ja/innodb-create-index-overview.html" title="MySQL :: MySQL 5.6 リファレンスマニュアル :: 14.11.1 オンライン DDL の概要">MySQL :: MySQL 5.6 リファレンスマニュアル :: 14.11.1 オンライン DDL の概要&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>MySQL 5.5 or MySQL 5.1 with InnoDB Pluginで、CREATE/DROP INDEX時にテーブルコピーを行わないように最適化された。&lt;br>
これは高速インデックス作成と呼ばれた。
5.6では更に多くのALTER TABLE操作をテーブルコピーなしでできるようになってる。&lt;/p>
&lt;h2 id="how-to">How-to&lt;/h2>
&lt;h3 id="データベースの-rename-をどうやるか">データベースの Rename をどうやるか&lt;/h3>
&lt;ul>
&lt;li>DB 名指定で RENAME TABLE
&lt;ul>
&lt;li>&lt;code>RENAME TABLE prev_database.t TO new_databaes.t;&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>mysqldump して restore&lt;/li>
&lt;/ul>
&lt;p>参考: &lt;a href="https://chartio.com/resources/tutorials/how-to-rename-a-database-in-mysql/" title="How to Rename a Database in MySQL | Chartio">How to Rename a Database in MySQL | Chartio&lt;/a>&lt;/p>
&lt;h3 id="遅延レプリケーション">遅延レプリケーション&lt;/h3>
&lt;p>MySQL5.6以降の場合、Slave側で以下を実行:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">CHANGE&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">MASTER&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">TO&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">MASTER_DELAY&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">N&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic">-- Nは正の整数
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://dev.mysql.com/doc/refman/5.6/ja/replication-delayed.html" title="MySQL :: MySQL 5.6 リファレンスマニュアル :: 17.3.9 遅延レプリケーション">MySQL :: MySQL 5.6 リファレンスマニュアル :: 17.3.9 遅延レプリケーション&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="タイムゾーンの設定">タイムゾーンの設定&lt;/h3>
&lt;p>SQLで変更する場合:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">-- SUPER権限があれば、サーバグローバルの設定を変えることができる
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">-- 稼働中のシステムで実行する場合は最大の注意が必要
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">SET&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">GLOBAL&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">time_zone&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">timezone&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#8f5902;font-style:italic">-- クライアントはセッションごとにタイムゾーン設定を変更できる
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">SET&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">time_zone&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span>&lt;span style="color:#000">timezone&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://dev.mysql.com/doc/refman/5.6/ja/time-zone-support.html">MySQL :: MySQL 5.6 リファレンスマニュアル :: 10.6 MySQL Server でのタイムゾーンのサポート&lt;/a>&lt;/li>
&lt;li>下のトピックの方&lt;/li>
&lt;/ul>
&lt;h2 id="topics">Topics&lt;/h2>
&lt;h3 id="接続のタイムアウトに関する設定">接続のタイムアウトに関する設定&lt;/h3>
&lt;p>色々パラメータがあって混乱しがちなのでまとめたい。&lt;/p>
&lt;h4 id="サーバ側">サーバ側&lt;/h4>
&lt;p>See &lt;a href="https://dev.mysql.com/doc/refman/5.6/ja/server-system-variables.html">https://dev.mysql.com/doc/refman/5.6/ja/server-system-variables.html&lt;/a>&lt;/p>
&lt;ul>
&lt;li>net_read_timeout &amp;hellip; 接続からデータ読み込みに失敗したら切断&lt;/li>
&lt;li>net_write_timeout &amp;hellip; 接続に対してデータ書き込みに失敗したら切断&lt;/li>
&lt;li>wait_timeout &amp;hellip; クライアントがアイドルになったら切断&lt;/li>
&lt;li>interactive_timeout &amp;hellip; インタラクティブセッションにおけるwait_timeout&lt;/li>
&lt;li>net_retry_count &amp;hellip; 通信失敗時のリトライ回数&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>wait_timeout について:
&lt;ul>
&lt;li>&lt;a href="http://keyamb.hatenablog.com/entry/2015/04/23/004126" title="MyNA(日本MySQLユーザ会) 2015年4月 に行ってきた #mysql_jp - weblog of key_amb">MyNA(日本MySQLユーザ会) 2015年4月 に行ってきた #mysql_jp - weblog of key_amb&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="クライアント側">クライアント側&lt;/h4>
&lt;p>See &lt;a href="https://dev.mysql.com/doc/refman/5.6/ja/mysql-options.html">https://dev.mysql.com/doc/refman/5.6/ja/mysql-options.html&lt;/a>&lt;/p>
&lt;ul>
&lt;li>MYSQL_OPT_CONNECT_TIMEOUT &amp;hellip; サーバにつながらないときにタイムアウト&lt;/li>
&lt;li>MYSQL_OPT_READ_TIMEOUT &amp;hellip; 接続からデータ読み込めないときにタイムアウト&lt;/li>
&lt;li>MYSQL_OPT_WRITE_TIMEOUT &amp;hellip; 接続にデータ書き込めないときにタイムアウト&lt;/li>
&lt;li>MYSQL_OPT_RECONNECT &amp;hellip; 接続が切れたと判断したら再接続&lt;/li>
&lt;/ul>
&lt;p>PerlやRubyのクライアントではよく &lt;code>connect_timeout&lt;/code>, &lt;code>read_timeout&lt;/code> といった接続時のオプションになっている。&lt;/p>
&lt;h3 id="タイムゾーン">タイムゾーン&lt;/h3>
&lt;ul>
&lt;li>TIMESTAMPはUNIX TIMESTAMP値を保持しており、タイムゾーンによって日時が変わる&lt;/li>
&lt;li>DATETIMEはタイムゾーンも含めて値を保持している&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://tmtms.hatenablog.com/entry/2015/08/22/mysql-timezone">MySQLのタイムゾーン - @tmtms のメモ&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="versions">Versions&lt;/h2>
&lt;h3 id="eol">EOL&lt;/h3>
&lt;p>&lt;a href="https://www.mysql.com/jp/support/eol-notice.html">MySQL :: MySQL Product Support EOL Announcements&lt;/a>&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://support-version.com/index.php?MySQL">MySQL | End of Life(EOL)まとめサイト&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/witchcraze/items/820dd848d48dfb8a5f96">MySQL Community Edition の EOL について - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="8">8&lt;/h3>
&lt;h4 id="8021">8.0.21&lt;/h4>
&lt;p>&lt;a href="https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-21.html">https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-21.html&lt;/a>&lt;/p>
&lt;ul>
&lt;li>mysqldumpに &lt;code>PROCESS&lt;/code> 権限が必要に（または &lt;code>--no-tablespaces&lt;/code> オプション指定）&lt;/li>
&lt;/ul>
&lt;h4 id="8016">8.0.16&lt;/h4>
&lt;p>&lt;a href="https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-16.html">https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-16.html&lt;/a>&lt;/p>
&lt;ul>
&lt;li>global / schema / tablespaceレベルでDEFAULT ENCRYPTIONを設定可能に&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/hmatsu47/items/bae53fd0f6d09511732c">MySQL 8.0.16 でテーブルスペース・REDO ログ／UNDO ログ・システムテーブル暗号化 - Qiita&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: systemd</title><link>https://progrhy.me/tech-notes/a/software/systemd/</link><pubDate>Mon, 18 May 2020 16:14:32 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/systemd/</guid><description>
&lt;p>&lt;a href="https://www.freedesktop.org/wiki/Software/systemd/">https://www.freedesktop.org/wiki/Software/systemd/&lt;/a>&lt;/p>
&lt;p>昨今のLinuxのinit（最初に起動するプログラム）としてほぼデファクトになっているソフトウェア。&lt;/p>
&lt;h2 id="configuration">Configuration&lt;/h2>
&lt;h3 id="systemdunit">systemd.unit&lt;/h3>
&lt;p>&lt;a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">https://www.freedesktop.org/software/systemd/man/systemd.unit.html&lt;/a>&lt;/p>
&lt;h4 id="template-unit-files">Template Unit Files&lt;/h4>
&lt;p>コマンドとかほぼ同じなんだけど、パラメータの異なるServiceを複数動かしたいようなときに使う。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://redj.hatenablog.com/entry/2020/02/08/180950">systemdのユニットファイルをテンプレート化する - redj’s blog&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="systemctl">systemctl&lt;/h2>
&lt;p>CLI&lt;/p>
&lt;p>&lt;a href="https://www.freedesktop.org/software/systemd/man/systemctl.html">https://www.freedesktop.org/software/systemd/man/systemctl.html&lt;/a>&lt;/p>
&lt;h3 id="daemon-reload">daemon-reload&lt;/h3>
&lt;p>&lt;a href="https://www.freedesktop.org/software/systemd/man/systemctl.html#daemon-reload">https://www.freedesktop.org/software/systemd/man/systemctl.html#daemon-reload&lt;/a>&lt;/p>
&lt;p>configと全unit fileを再読込みする。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>systemctl daemon-reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>A: Terraform</title><link>https://progrhy.me/tech-notes/a/software/terraform/</link><pubDate>Sun, 26 Apr 2020 22:59:20 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/terraform/</guid><description>
&lt;h2 id="getting-started">Getting Started&lt;/h2>
&lt;ul>
&lt;li>初心者向けガイド: &lt;a href="https://www.terraform.io/guides/">https://www.terraform.io/guides/&lt;/a>&lt;/li>
&lt;li>ドキュメント: &lt;a href="https://www.terraform.io/docs/">https://www.terraform.io/docs/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/kohey18/items/38400d8c498baa0a0ed8" title="terraform使い方(超基礎編) - Qiita">terraform使い方(超基礎編) - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="仕様">仕様&lt;/h2>
&lt;h3 id="state">State&lt;/h3>
&lt;p>&lt;a href="https://www.terraform.io/docs/state/">https://www.terraform.io/docs/state/&lt;/a>&lt;/p>
&lt;h4 id="locking">Locking&lt;/h4>
&lt;p>&lt;a href="https://www.terraform.io/docs/state/locking.html">https://www.terraform.io/docs/state/locking.html&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://www.terraform.io/docs/backends">backend&lt;/a>によってサポートされていれば、排他制御が可能。&lt;/p>
&lt;h2 id="examples">Examples&lt;/h2>
&lt;p>公式のを見ると良い。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/hashicorp/terraform/tree/master/examples">https://github.com/hashicorp/terraform/tree/master/examples&lt;/a>
&lt;ul>
&lt;li>AWS: &lt;a href="https://github.com/terraform-providers/terraform-provider-aws/tree/master/examples">https://github.com/terraform-providers/terraform-provider-aws/tree/master/examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="ベストプラクティス">ベストプラクティス&lt;/h2>
&lt;p>公式: &lt;a href="https://github.com/hashicorp/best-practices/tree/master/terraform">https://github.com/hashicorp/best-practices/tree/master/terraform&lt;/a>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Terraform Version&lt;/th>
&lt;th>記事&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>v0.10&lt;/td>
&lt;td>&lt;a href="https://qiita.com/shogomuranushi/items/e2f3ff3cfdcacdd17f99" title="Terraform Best Practices in 2017 - Qiita">Terraform Best Practices in 2017 - Qiita&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>v0.7.x&lt;/td>
&lt;td>&lt;a href="https://dev.classmethod.jp/devops/directory-layout-bestpractice-in-terraform/" title="Terraformにおけるディレクトリ構造のベストプラクティス ｜ Developers.IO">Terraformにおけるディレクトリ構造のベストプラクティス ｜ Developers.IO&lt;/a>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>オレオレ:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/progrhyme/items/766d02e605358ad2930e" title="TerraformでWorkspaceを使わずに複数環境をDRYに設定する - Qiita">TerraformでWorkspaceを使わずに複数環境をDRYに設定する - Qiita&lt;/a> &amp;hellip; Terraform v0.10〜v0.11ぐらい対応&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.hashicorp.com/blog/structuring-hashicorp-terraform-configuration-for-production/">Structuring HashiCorp Terraform Configuration for Production&lt;/a> &amp;hellip; 2020-03-27. Workspacesを使わずにディレクトリを分けることのメリットが述べられている。&lt;/li>
&lt;/ul>
&lt;h2 id="versions">Versions&lt;/h2>
&lt;h3 id="v013">v0.13&lt;/h3>
&lt;p>&lt;a href="https://www.hashicorp.com/blog/announcing-hashicorp-terraform-0-13">2020年8月にGA&lt;/a>。&lt;/p>
&lt;p>v0.12ほどではないが、非互換の変更があり、アップグレード時には対応が必要。&lt;/p>
&lt;p>&lt;a href="https://www.terraform.io/upgrade-guides/0-13.html">https://www.terraform.io/upgrade-guides/0-13.html&lt;/a>&lt;/p>
&lt;p>v0.11以前の人は一度、v0.12に上げてからv0.13にアップグレードする必要がある。&lt;/p>
&lt;h2 id="how-to">How-to&lt;/h2>
&lt;h3 id="バージョン固定">バージョン固定&lt;/h3>
&lt;p>&lt;a href="https://www.terraform.io/docs/configuration/terraform.html">Terraform Settings - Configuration Language - Terraform by HashiCorp&lt;/a>&lt;/p>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-HCL" data-lang="HCL">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">terraform&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000"> required_version&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#000"> &amp;#34;&amp;gt;&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">12&lt;/span>&lt;span style="color:#a40000">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">required_providers&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000"> aws&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#000"> &amp;#34;&amp;gt;&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">8&lt;/span>&lt;span style="color:#a40000">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000"> local&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;1.2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">provider&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;http&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000"> version&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;1.2.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>terraformのversion指定はtfenvでも可能&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/minamijoyo/items/1350fb28ae82a3dbb354">tfupdateでTerraform本体/プロバイダ/モジュールのバージョンアップを自動化する - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="backendのs3やgcs等そのものをterraformで管理">BackendのS3やGCS等そのものをTerraformで管理&lt;/h3>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/saiya_moebius/items/a8f8aa3683c2347d607c">Backend の S3 や DynamoDB 自体を terraform で管理するセットアップ方法 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="tips">Tips&lt;/h2>
&lt;h3 id="デバッグ">デバッグ&lt;/h3>
&lt;p>&lt;a href="https://www.terraform.io/docs/internals/debugging.html">https://www.terraform.io/docs/internals/debugging.html&lt;/a>&lt;/p>
&lt;h4 id="ログレベルの変更">ログレベルの変更&lt;/h4>
&lt;p>&lt;code>TF_LOG&lt;/code> 環境変数に &lt;code>TRACE, DEBUG, INFO, WARN, ERROR&lt;/code> のいずれかをセットすることで変更できる。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000">TF_LOG&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>DEBUG terraform plan
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>※しかし、どれを指定してもtraceレベルのログが出る気が…(v0.10.x)&lt;/p>
&lt;h3 id="countを使って複数のリソースを作成">countを使って複数のリソースを作成&lt;/h3>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-Terraform" data-lang="Terraform">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">variable&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;instance_ips&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c4a000">default&lt;/span> = &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;0&amp;#34;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;10.11.12.100&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;1&amp;#34;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;10.11.12.101&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;2&amp;#34;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;10.11.12.102&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">resource&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;aws_instance&amp;#34;&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;app&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c4a000">count&lt;/span> = &lt;span style="color:#4e9a06">&amp;#34;3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c4a000">private_ip&lt;/span> = &lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">lookup&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87">var&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">instance_ips&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#204a87">count&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">index&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#8f5902;font-style:italic">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic"> # ...
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">variable&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;rds_roles&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c4a000">default&lt;/span> = &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;WRITER&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;READER&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">resource&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;aws_cloudwatch_metric_alarm&amp;#34;&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;rds_cpu&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c4a000">count&lt;/span> = &lt;span style="color:#4e9a06">&amp;#34;2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c4a000">alarm_name&lt;/span> = &lt;span style="color:#4e9a06">&amp;#34;RDS-&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#204a87">var&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">rds_roles&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#204a87">count&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">index&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">-CPU&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.terraform.io/docs/configuration/resources.html#using-variables-with-count">https://www.terraform.io/docs/configuration/resources.html#using-variables-with-count&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/kanagi/items/095037ba3f72de3f9572">terraformでautoscalingしているサーバのcloudwatch alarmを自動設定する - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/ringo/items/875f08ec550f0826f0dc" title="Terraform でループして複数のリソースを作成する - Qiita">Terraform でループして複数のリソースを作成する - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="変数やoutputでmapを使うと記述量が減って便利">変数やoutputでmapを使うと記述量が減って便利&lt;/h3>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/shogomuranushi/items/cc387a1233cc7f4e6e60" title="Terraformのoutputでmapを利用する方法 - Qiita">Terraformのoutputでmapを利用する方法 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="mapのlistを作る方法">mapのlistを作る方法&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://gist.github.com/brikis98/f3fe2ae06f996b40b55eebcb74ed9a9e">A hacky way to create a dynamic list of maps in Terraform&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="できない説">できない説&lt;/h4>
&lt;ul>
&lt;li>&lt;a href="https://github.com/hashicorp/terraform/issues/7705" title="Cannot pass a list of maps to a resource/data · Issue #7705 · hashicorp/terraform">Cannot pass a list of maps to a resource/data · Issue #7705 · hashicorp/terraform&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/ringo/items/875f08ec550f0826f0dc" title="Terraform でループして複数のリソースを作成する - Qiita">Terraform でループして複数のリソースを作成する - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>…が、手元で試したところ(v0.10.x)、下のようにしてlistとして定義・参照することができた。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-terraform" data-lang="terraform">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87;font-weight:bold">variable&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;my_complex_data&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c4a000">type&lt;/span> = &lt;span style="color:#204a87">&amp;#34;list&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> default = [
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> {
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> id = &amp;#34;&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> name = &amp;#34;&lt;/span>&lt;span style="color:#000">taro&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> height = &amp;#34;&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">170&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> },
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> {
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> id = &amp;#34;&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> name = &amp;#34;&lt;/span>&lt;span style="color:#000">hanako&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> height = &amp;#34;&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">160&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> },
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06"> ]
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">foo_list = &amp;#34;&lt;/span>&lt;span style="color:#a40000">$&lt;/span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#204a87">var&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">my_complex_data&lt;/span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="tools">Tools&lt;/h2>
&lt;p>3rd Partyのツール&lt;/p>
&lt;h3 id="tfenv">tfenv&lt;/h3>
&lt;p>&lt;a href="https://github.com/Zordrak/tfenv">https://github.com/Zordrak/tfenv&lt;/a>&lt;/p>
&lt;p>rbenv, anyenvのようなツールで、複数バージョンのterraformを切り替えて使えるようになるもの。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/kamatama_41/items/ba59a070d8389aab7694">tfenvでTerraformのバージョン管理をする - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="参考">参考&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/minamijoyo/items/1f57c62bed781ab8f4d7" title="Terraform職人入門: 日々の運用で学んだ知見を淡々とまとめる - Qiita">Terraform職人入門: 日々の運用で学んだ知見を淡々とまとめる - Qiita&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: エディタ・IDE</title><link>https://progrhy.me/tech-notes/a/software/editor/</link><pubDate>Wed, 03 Jun 2020 02:50:00 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/editor/</guid><description/></item><item><title>A: ジョブ管理システム</title><link>https://progrhy.me/tech-notes/a/software/job-man/</link><pubDate>Sat, 11 Jul 2020 16:33:27 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/job-man/</guid><description>
&lt;h2 id="about">About&lt;/h2>
&lt;p>一般に以下のように称されるソフトウェアをここにカテゴライズする:&lt;/p>
&lt;ul>
&lt;li>ビルドシステム&lt;/li>
&lt;li>ワークフローエンジン&lt;/li>
&lt;li>タスクランナー&lt;/li>
&lt;li>ジョブスケジューラー&lt;/li>
&lt;/ul>
&lt;p>下位概念として、「バッチシステム」という言葉を使う。&lt;br>
これは、「ジョブ管理システム」がKubernetesのように動き続けるジョブをも管理し得ることに対して、バッチ実行されるジョブのみを管理するソフトウェアを指す。&lt;/p>
&lt;h2 id="child-pages">Child Pages&lt;/h2></description></item><item><title>A: ターミナルソフトウェア</title><link>https://progrhy.me/tech-notes/a/software/terminal/</link><pubDate>Wed, 13 May 2020 22:23:41 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/terminal/</guid><description>
&lt;p>端末エミュレータ、ターミナルエミュレータなどとも呼ばれる。&lt;/p>
&lt;h2 id="macos">macOS&lt;/h2>
&lt;ul>
&lt;li>ターミナル.app &amp;hellip; 標準でインストールされている端末アプリ&lt;/li>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/terminal/iterm2/">iTerm2&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="how-to">How-to&lt;/h2>
&lt;h3 id="入力がおかしくなったときの直し方">入力がおかしくなったときの直し方&lt;/h3>
&lt;p>現象:&lt;/p>
&lt;ul>
&lt;li>入力文字が表示されない&lt;/li>
&lt;li>改行が反映されない&lt;/li>
&lt;/ul>
&lt;p>直し方:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>stty sane
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/m-sakano/items/7f1afc7eb452a1a57015">Terminalの入力が異常になったときの直し方 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="topics">Topics&lt;/h2>
&lt;h3 id="色">色&lt;/h3>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://jonasjacek.github.io/colors/">256 Colors - Cheat Sheet - Xterm, HEX, RGB, HSL&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.pandanoir.info/entry/2019/11/02/202146">TrueColor対応のはなし(端末、シェル、tmux、vim) - Panda Noir&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="環境変数">環境変数&lt;/h4>
&lt;p>UNIX系OSで端末の色に関する環境変数:&lt;/p>
&lt;ul>
&lt;li>&lt;code>COLORTERM&lt;/code> &amp;hellip; &lt;code>truecolor&lt;/code> など&lt;/li>
&lt;li>&lt;code>TERM&lt;/code> &amp;hellip; &lt;code>xterm-256color&lt;/code> など&lt;/li>
&lt;/ul>
&lt;p>NOTE:&lt;/p>
&lt;ul>
&lt;li>tmuxやscreenを使うと、 &lt;code>TERM&lt;/code> 設定が書き換えられて色表示がおかしくなることがある&lt;/li>
&lt;/ul>
&lt;h2 id="child-pages">Child Pages&lt;/h2></description></item><item><title>A: Software Test</title><link>https://progrhy.me/tech-notes/a/software/test/</link><pubDate>Sat, 23 May 2020 17:38:12 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/test/</guid><description>
&lt;p>Software Test Engineeringまで入るかも。&lt;br>
一旦、負荷テストもここに入れる。&lt;/p>
&lt;h2 id="負荷テストツール">負荷テストツール&lt;/h2>
&lt;p>どんなものがあるかメモ:&lt;/p>
&lt;ul>
&lt;li>ab&lt;/li>
&lt;li>JMeter&lt;/li>
&lt;li>Gatling&lt;/li>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/test/locust/">Locust&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="topics">Topics&lt;/h2>
&lt;h3 id="スタブとモックの違い">スタブとモックの違い&lt;/h3>
&lt;p>どっちがどっちかいつもよくわからなくなる。&lt;/p>
&lt;p>スタブの定義らしきもの:&lt;/p>
&lt;ul>
&lt;li>テスト対象モジュールが依存するモジュールの代用品として動作し、決められた動きをするもの&lt;/li>
&lt;/ul>
&lt;p>モックの定義らしきもの:&lt;/p>
&lt;ul>
&lt;li>テスト対象モジュール、またはスタブが利用するモジュールの代用品として動作し、どのような使われ方をしたかをチェックするもの
&lt;ul>
&lt;li>例えばどのメソッドが何回呼ばれたか、とか&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/k5trismegistus/items/10ce381d29ab62ca0ea6">スタブとモックの違い - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://gotohayato.com/content/483/">自動テストのスタブ・スパイ・モックの違い | gotohayato.com&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.weblio.jp/content/%E3%82%B9%E3%82%BF%E3%83%96">スタブとは何？ Weblio辞書&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.weblio.jp/content/%E3%83%A2%E3%83%83%E3%82%AF%E3%82%A2%E3%83%83%E3%83%97">モックアップとは何？ Weblio辞書&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>MEMO:&lt;/p>
&lt;ul>
&lt;li>2020-05-23 旧Wikiに載せていたリンクは切れてしまっていた。&lt;/li>
&lt;/ul></description></item><item><title>A: Package Managers</title><link>https://progrhy.me/tech-notes/a/software/pkg-man/</link><pubDate>Mon, 04 May 2020 17:17:16 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/pkg-man/</guid><description/></item><item><title>A: Static Site Generators</title><link>https://progrhy.me/tech-notes/a/software/static-site-generator/</link><pubDate>Wed, 06 May 2020 13:39:38 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/static-site-generator/</guid><description>
&lt;p>コンテンツをMarkdown等で管理して、静的サイトを作れるソフトウェア製品。&lt;br>
製本ツールであっても、HTML形式での出力に対応しているものはここに入れると思う。&lt;/p>
&lt;h2 id="software">Software&lt;/h2>
&lt;p>下位ページにないもの:&lt;/p>
&lt;ul>
&lt;li>Sphinx&lt;/li>
&lt;li>Jekyll&lt;/li>
&lt;li>Octopress&lt;/li>
&lt;/ul>
&lt;h2 id="参考">参考&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://www.staticgen.com/">https://www.staticgen.com/&lt;/a> &amp;hellip; OSS比較サイト&lt;/li>
&lt;li>2015年4月に書いたエントリ: &lt;a href="https://keyamb.hatenablog.com/entry/2015/04/01/211845">Markdown による中規模ドキュメンテーションシステムについて調べた。 - weblog of key_amb&lt;/a> &amp;hellip; 当時は使えるツールが少なかった&lt;/li>
&lt;/ul>
&lt;h2 id="child-pages">Child Pages&lt;/h2></description></item></channel></rss>