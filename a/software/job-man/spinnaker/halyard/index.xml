<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>progrhyme's Tech Notes – Halyard</title><link>https://progrhy.me/tech-notes/a/software/job-man/spinnaker/halyard/</link><description>Recent content in Halyard on progrhyme's Tech Notes</description><generator>Hugo -- gohugo.io</generator><language>ja</language><lastBuildDate>Tue, 05 May 2020 00:27:58 +0900</lastBuildDate><atom:link href="https://progrhy.me/tech-notes/a/software/job-man/spinnaker/halyard/index.xml" rel="self" type="application/rss+xml"/><item><title>A: halコマンド</title><link>https://progrhy.me/tech-notes/a/software/job-man/spinnaker/halyard/hal/</link><pubDate>Tue, 12 May 2020 12:05:51 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/job-man/spinnaker/halyard/hal/</guid><description>
&lt;p>リファレンス的に各コマンドの解説を書いていく。&lt;/p>
&lt;p>ユースケース別の使い方は&lt;a href="https://progrhy.me/tech-notes/a/software/job-man/spinnaker/halyard/#how-to">Halyard#How-to&lt;/a>などを参照すること。&lt;/p>
&lt;h2 id="global-parameters">Global Parameters&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>オプション&lt;/th>
&lt;th>意味&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>--daemon-endpoint &amp;lt;ADDRESS&amp;gt;&lt;/code>&lt;/td>
&lt;td>指定があればそのdaemonに接続に行く&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>-d, --debug&lt;/code>&lt;/td>
&lt;td>daemonの詳細なネットワークトラフィックを出力&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>-l, --log&lt;/code>&lt;/td>
&lt;td>CLIのログレベルを設定&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>-h, --help&lt;/code>&lt;/td>
&lt;td>ヘルプ表示&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="backup">backup&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># バックアップ作成。tarballが出来る&lt;/span>
hal backup create
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="config">config&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># Spinnakerのコンポーネントのリソース利用量を変更&lt;/span>
hal config deploy component-sizing &amp;lt;component&amp;gt; &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>delete&lt;span style="color:#000;font-weight:bold">|&lt;/span>edit&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>parameters&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># IAP認証を有効化&lt;/span>
hal config security authn iap &lt;span style="color:#204a87">enable&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># 該当プロバイダのアカウント一覧&lt;/span>
hal config provider &lt;span style="color:#000">$PROVIDER&lt;/span> account list
&lt;span style="color:#8f5902;font-style:italic"># 該当プロバイダの該当アカウントにRBACのロール設定&lt;/span>
hal config provider &lt;span style="color:#000">$PROVIDER&lt;/span> account edit &lt;span style="color:#000">$ACCOUNT&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --read-permissions &lt;span style="color:#000">$ROLE1&lt;/span>,&lt;span style="color:#000">$ROLE2&lt;/span>,... &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --write-permissions &lt;span style="color:#000">$ROLE1&lt;/span>,&lt;span style="color:#000">$ROLE2&lt;/span>,...
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.spinnaker.io/setup/security/authorization/#accounts">https://www.spinnaker.io/setup/security/authorization/#accounts&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="canary">canary&lt;/h3>
&lt;p>Canary analysis settings. kayentaの設定らしい。&lt;/p>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">hal config canary &amp;lt;integration&amp;gt; account list
hal config canary &amp;lt;integration&amp;gt; account edit ACCOUNT &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>parameters&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Integrations:&lt;/p>
&lt;ul>
&lt;li>aws, datadog, google, newrelic, prometheus, signalfx&lt;/li>
&lt;/ul>
&lt;h3 id="deploy">deploy&lt;/h3>
&lt;p>Spinnakerのデプロイメントの設定とその表示。&lt;/p>
&lt;p>SYNOPSIS:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># 状態表示&lt;/span>
hal config deploy
hal config deploy SUBCOMMAND parameters
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Subcommands:&lt;/p>
&lt;ul>
&lt;li>component-sizing, edit, ha&lt;/li>
&lt;/ul>
&lt;h4 id="component-sizing">component-sizing&lt;/h4>
&lt;p>各コンポーネントのリソース利用量の設定管理。&lt;/p>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">hal config deploy component-sizing COMPONENT edit &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --container-requests-cpu 100m &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --container-requests-memory 256Mi &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --container-limits-cpu 200m &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --container-limits-memory 512Mi &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --pod-requests-cpu 100m &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --pod-requests-memory 256Mi &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --pod-limits-cpu 200m &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --pod-limits-memory 512Mi &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --replicas &lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Components（一部）:&lt;/p>
&lt;ul>
&lt;li>clouddriver&lt;/li>
&lt;li>deck&lt;/li>
&lt;li>echo&lt;/li>
&lt;li>fiat&lt;/li>
&lt;li>front50&lt;/li>
&lt;li>gate&lt;/li>
&lt;li>igor&lt;/li>
&lt;li>kayenta&lt;/li>
&lt;li>orca&lt;/li>
&lt;li>rosco&lt;/li>
&lt;/ul>
&lt;h3 id="notification">notification&lt;/h3>
&lt;p>通知設定の管理。&lt;/p>
&lt;p>SYNOPSIS:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># 設定一覧表示&lt;/span>
hal config notification
hal config notification SUBCOMMAND parameters
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Subcommands:&lt;/p>
&lt;ul>
&lt;li>github-status&lt;/li>
&lt;li>pubsub&lt;/li>
&lt;li>slack&lt;/li>
&lt;li>twilio&lt;/li>
&lt;/ul>
&lt;h4 id="slack">slack&lt;/h4>
&lt;p>Slack通知設定。&lt;/p>
&lt;p>SYNOPSIS:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">hal config notification slack &lt;span style="color:#204a87">enable&lt;/span>
hal config notification slack disable
hal config notification slack edit --token &lt;span style="color:#000">$TOKEN&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="provider">provider&lt;/h3>
&lt;p>各種クラウドプロバイダなどの設定管理。&lt;/p>
&lt;p>Subcommands（一部）:&lt;/p>
&lt;ul>
&lt;li>appengine&lt;/li>
&lt;li>aws&lt;/li>
&lt;li>azure&lt;/li>
&lt;li>cloudfoundry&lt;/li>
&lt;li>dcos&lt;/li>
&lt;li>docker-registry&lt;/li>
&lt;li>ecs&lt;/li>
&lt;li>google&lt;/li>
&lt;li>kubernetes&lt;/li>
&lt;li>oracle&lt;/li>
&lt;/ul>
&lt;h4 id="docker-registry">docker-registry&lt;/h4>
&lt;p>Docker Registryの管理。GCRもこちら&lt;/p>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># 状態表示&lt;/span>
hal config provider docker-registry
&lt;span style="color:#8f5902;font-style:italic"># 有効化・無効化&lt;/span>
hal config provider docker-registry &lt;span style="color:#204a87">enable&lt;/span>
hal config provider docker-registry disable
&lt;span style="color:#8f5902;font-style:italic"># account管理&lt;/span>
hal config provider docker-registry account list
hal config provider docker-registry account get ACCOUNT
hal config provider docker-registry account add ACCOUNT &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>parameters&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
hal config provider docker-registry account delete ACCOUNT &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>parameters&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
hal config provider docker-registry account edit ACCOUNT &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>parameters&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">## GCRをService Account Key認証で追加&lt;/span>
hal config provider docker-registry account add asia-gcr-io &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --address https://asia.gcr.io --username _json_key &lt;span style="color:#4e9a06">\
&lt;/span>&lt;span style="color:#4e9a06">&lt;/span> --password-file path/to/service-account-key.json &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>NOTE:&lt;/p>
&lt;ul>
&lt;li>レジストリにリポジトリを追加する場合は &lt;code>edit&lt;/code> サブコマンドを使う。&lt;/li>
&lt;/ul>
&lt;p>例:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">hal config provider docker-registry account edit ACCOUNT --add-repository foo/bar
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="storage">storage&lt;/h3>
&lt;p>Persistent storage.&lt;/p>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">hal config storage &amp;lt;integration&amp;gt; edit &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>parameters&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Integrations:&lt;/p>
&lt;ul>
&lt;li>azs, gcs, oracle, s3&lt;/li>
&lt;/ul>
&lt;h2 id="deploy-1">deploy&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># Spinnakerの設定変更を適用する&lt;/span>
hal deploy apply
&lt;span style="color:#8f5902;font-style:italic"># Spinnakerに接続する&lt;/span>
hal deploy connect
&lt;span style="color:#8f5902;font-style:italic"># 各サービスのログを集める&lt;/span>
hal deploy collect-logs
&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>