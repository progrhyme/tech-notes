<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>progrhyme's Tech Notes – Kubernetes</title><link>https://progrhy.me/tech-notes/a/software/k8s/</link><description>Recent content in Kubernetes on progrhyme's Tech Notes</description><generator>Hugo -- gohugo.io</generator><language>ja</language><lastBuildDate>Mon, 27 Apr 2020 10:39:49 +0900</lastBuildDate><atom:link href="https://progrhy.me/tech-notes/a/software/k8s/index.xml" rel="self" type="application/rss+xml"/><item><title>A: Concept</title><link>https://progrhy.me/tech-notes/a/software/k8s/concept/</link><pubDate>Mon, 27 Apr 2020 10:53:19 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/k8s/concept/</guid><description>
&lt;h2 id="このページについて">このページについて&lt;/h2>
&lt;p>何を書くか:&lt;/p>
&lt;ul>
&lt;li>Kubernetesの全体アーキテクチャーや構成要素の概要&lt;/li>
&lt;li>個別のオブジェクトによらない概念や機能等について&lt;/li>
&lt;/ul>
&lt;p>書かないこと:&lt;/p>
&lt;ul>
&lt;li>著しく個々のオブジェクトに紐づく文書のボリュームが大きくなったら、独立したページに切り出す&lt;/li>
&lt;/ul>
&lt;h2 id="アーキテクチャー概観">アーキテクチャー概観&lt;/h2>
&lt;p>&lt;a href="https://kubernetes.io/ja/docs/concepts/overview/components/">Kubernetesのコンポーネント - Kubernetes&lt;/a>より。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>クラスタ&lt;/strong> &amp;hellip; &lt;u>ノード&lt;/u>の集合
&lt;ul>
&lt;li>少なくとも1つの&lt;u>ワーカーノード&lt;/u>と少なくとも1つの&lt;u>マスターノード&lt;/u>がある&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>ノード（Node）&lt;/strong> &amp;hellip; コンテナ化されたアプリケーションを実行するマシン
&lt;ul>
&lt;li>&lt;strong>マスターノード&lt;/strong> &amp;hellip; &lt;u>ワーカーノード&lt;/u>とPodを管理。複数台構成によって高可用性を実現できる&lt;/li>
&lt;li>&lt;strong>ワーカーノード&lt;/strong> &amp;hellip; Podを動かす&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>各ノードで実行され、Kubernetesのクラスタ機能を成り立たせる&lt;u>コンポーネント&lt;/u>を以下に記す。&lt;/p>
&lt;h3 id="master-components">Master Components&lt;/h3>
&lt;p>マスターコンポーネントは、クラスターのコントロールプレーンを提供する。&lt;br>
クラスタのどのマシンでも実行できるが、通常は全てのコンポーネントが同じマシンで起動され、そのマシンにはユーザーのPodをスケジュールしない。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/generated/kube-apiserver/">kube-apiserver&lt;/a>
&lt;ul>
&lt;li>Kubernetesを制御するフロントAPI. 水平スケール可能。参考: &lt;a href="https://kubernetes.io/docs/admin/high-availability/">Building High-Availability Clusters | Kubernetes&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/">etcd&lt;/a> &amp;hellip; クラスタの管理データが保存されるので、バックアップすべし。&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/generated/kube-controller-manager/">kube-controller-manager&lt;/a>
&lt;ul>
&lt;li>Controllerをバックグラウンドのスレッドで動かす。&lt;/li>
&lt;li>個々のControllerは論理的には独立した存在だが、複雑性を避けるため同一のバイナリで単一プロセスとして動作している。&lt;/li>
&lt;li>以下のControllerが含まれる:
&lt;ul>
&lt;li>Node Controller&lt;/li>
&lt;li>Replication Controller&lt;/li>
&lt;li>Endpoints Controller&lt;/li>
&lt;li>Service Account &amp;amp; Token Controller&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>cloud-controller-manager &amp;hellip; v1.6でalpha. クラウド基盤とやりとりするControllerを動かす。&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/generated/kube-scheduler/">kube-scheduler&lt;/a> &amp;hellip; 生成されるPodを監視し、Podを動作させるノードを決定する。&lt;/li>
&lt;li>addons &amp;hellip; クラスタの機能を提供するPod群。これらのPodは &lt;code>kube-system&lt;/code> という &lt;strong>Namespace&lt;/strong> に作られる。
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/">DNS&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">Web UI (Dashboard)&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/debug-application-cluster/resource-usage-monitoring/">Container Resource Monitoring&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/concepts/cluster-administration/logging/">Cluster-level Logging&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="node-components">Node Components&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/generated/kubelet/">kubelet&lt;/a> &amp;hellip; マスターと通信するエージェントプロセス。&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/generated/kube-proxy/">kube-proxy&lt;/a> &amp;hellip; ノード上でKubernetes APIによって定義されたサービスを媒介するネットワークプロキシ。&lt;/li>
&lt;li>docker, rkt &amp;hellip; コンテナランタイム&lt;/li>
&lt;li>supervisord &amp;hellip; ノード上でdockerやkubeletを動かし続ける。&lt;/li>
&lt;li>fluentd &amp;hellip; cluster-level loggingを実現する。&lt;/li>
&lt;/ul>
&lt;h2 id="リソースオブジェクト">リソースオブジェクト&lt;/h2>
&lt;p>APIオブジェクトとも呼ばれるようだ。&lt;/p>
&lt;p>&lt;a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/">Kubernetes API Reference Docs (v1.18 at 2020-04-13)&lt;/a>に従い、カテゴライズして記す。&lt;/p>
&lt;p>NOTE:&lt;/p>
&lt;ul>
&lt;li>以下、「*」は本サイト内のページを表すとする。&lt;/li>
&lt;li>一旦、v1beta以下は省くか、versionを明記する&lt;/li>
&lt;/ul>
&lt;h3 id="workloads">Workloads&lt;/h3>
&lt;ul>
&lt;li>coreグループ:
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/k8s/container/">Container&lt;/a> *&lt;/li>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/k8s/pod/">Pod&lt;/a> *&lt;/li>
&lt;li>ReplicationContoller&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>appsグループ:
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/">ReplicaSet&lt;/a> &amp;hellip; &lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/">Replication Controller&lt;/a>の後継。&lt;/li>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/k8s/deployment/">Deployment&lt;/a> * &amp;hellip; PodやReplicaSetの状態を宣言的に記述することを可能にする。&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSet&lt;/a> &amp;hellip; v1.8でbeta. Deployment同様Podを管理するが、それぞれのPodを異なる個体と認識する。&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/">DaemonSet&lt;/a> &amp;hellip; ノード上でPodのコピーを動かす。典型的なユースケースとしては、cephやfluentd, collectdなどが挙げられる。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>batchグループ:
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/jobs-run-to-completion/">Job&lt;/a> &amp;hellip; Podを実行し、正常に完了するまでをトラッキングする。定められた回数、正常に完了したら、Jobも完了となる。&lt;/li>
&lt;li>CronJob v1beta1&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>MEMO:&lt;/p>
&lt;ul>
&lt;li>apps, batchグループのオブジェクトを &lt;strong>Controller&lt;/strong> と呼ぶことがあったようだ。&lt;/li>
&lt;/ul>
&lt;h3 id="discovery--lb-service-apis">Discovery &amp;amp; LB (Service APIs)&lt;/h3>
&lt;ul>
&lt;li>coreグループ:
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/k8s/service/">Service&lt;/a> *&lt;/li>
&lt;li>Endpoints&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>networking.k8s.ioグループ:
&lt;ul>
&lt;li>Ingress v1beta1&lt;/li>
&lt;li>IngressClass v1beta1&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>discovery.k8s.ioグループ:
&lt;ul>
&lt;li>EndpointSlice v1beta1&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="config--storage">Config &amp;amp; Storage&lt;/h3>
&lt;ul>
&lt;li>coreグループ:
&lt;ul>
&lt;li>ConfigMap&lt;/li>
&lt;li>Secret&lt;/li>
&lt;li>PersistentVolumeClaim&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/concepts/storage/volumes/">Volume&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>storage.k8s.ioグループ:
&lt;ul>
&lt;li>CSIDriver&lt;/li>
&lt;li>CSINode&lt;/li>
&lt;li>StorageClass&lt;/li>
&lt;li>VolumeAttachment&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="metadata">Metadata&lt;/h3>
&lt;ul>
&lt;li>coreグループ:
&lt;ul>
&lt;li>Event&lt;/li>
&lt;li>LimitRange&lt;/li>
&lt;li>PodTemplate&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>appsグループ:
&lt;ul>
&lt;li>ControllerRevision&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>autoscalingグループ:
&lt;ul>
&lt;li>&lt;a href="#horizontal-pod-autoscaler">HorizontalPodAutoscaler&lt;/a> * &amp;hellip; HPAと略されることが多い&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>scheduling.k8s.ioグループ:
&lt;ul>
&lt;li>PriorityClass &amp;hellip; See &lt;a href="https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/#priorityclass">Pod Priority and Preemption - Kubernetes#priorityclass&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>admissionregistration.k8s.ioグループ:
&lt;ul>
&lt;li>MutatingWebhookConfiguration&lt;/li>
&lt;li>ValidatingWebhookConfiguration&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>apiextensions.k8s.ioグループ:
&lt;ul>
&lt;li>CustomResourceDefinition &amp;hellip; CRDと略されることが多い。K8sの機能拡張によく用いられる&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>policyグループ:
&lt;ul>
&lt;li>PodDisruptionBudget v1beta1&lt;/li>
&lt;li>PodSecurityPolicy v1beta1&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="cluster">Cluster&lt;/h3>
&lt;ul>
&lt;li>coreグループ:
&lt;ul>
&lt;li>Binding&lt;/li>
&lt;li>ComponentStatus&lt;/li>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/k8s/namespace/">Namespace&lt;/a> * &amp;hellip; Kubernetesでは、複数の仮想的なクラスタを同じ物理クラスタ上に構築することができる。この仮想クラスタのことを &lt;strong>Namespace&lt;/strong> と呼ぶ&lt;/li>
&lt;li>Node&lt;/li>
&lt;li>&lt;a href="#persistentvolume">PersistentVolume&lt;/a> *&lt;/li>
&lt;li>ResourceQuota&lt;/li>
&lt;li>ServiceAccount&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>authentication.k8s.ioグループ:
&lt;ul>
&lt;li>TokenRequest&lt;/li>
&lt;li>TokenReview&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>authorization.k8s.ioグループ:
&lt;ul>
&lt;li>LocalSubjectAccessReview&lt;/li>
&lt;li>SelfSubjectAccessReview&lt;/li>
&lt;li>SelfSubjectRulesReview&lt;/li>
&lt;li>SubjectAccessReview&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>rbac.authorization.k8s.ioグループ:
&lt;ul>
&lt;li>ClusterRole&lt;/li>
&lt;li>ClusterRoleBinding&lt;/li>
&lt;li>Role&lt;/li>
&lt;li>RoleBinding&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>apiregistration.k8s.ioグループ:
&lt;ul>
&lt;li>APIService&lt;/li>
&lt;li>AuditSink&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>certificates.k8s.ioグループ:
&lt;ul>
&lt;li>CertificateSigningRequest v1beta1&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>networking.k8s.ioグループ:
&lt;ul>
&lt;li>NetworkPolicy&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>coordination.k8s.ioグループ:
&lt;ul>
&lt;li>Lease&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="認証認可">認証/認可&lt;/h2>
&lt;h3 id="rbac">RBAC&lt;/h3>
&lt;p>&lt;a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">https://kubernetes.io/docs/reference/access-authn-authz/rbac/&lt;/a>&lt;/p>
&lt;ul>
&lt;li>Role &amp;hellip; 権限ロール。Namespace単位&lt;/li>
&lt;li>ClusterRole &amp;hellip; クラスタ全体に効く権限ロール&lt;/li>
&lt;li>RoleBinding &amp;hellip; Roleとユーザ/グループの紐付け&lt;/li>
&lt;li>ClusterRoleBinding &amp;hellip; ClusterRoleとユーザ/グループの紐付け&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://cstoku.dev/posts/2018/k8sdojo-20/">Kubernetes道場 20日目 - Role / RoleBinding / ClusterRole / ClusterRoleBindingについて - Toku&amp;rsquo;s Blog&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/sheepland/items/67a5bb9b19d8686f389d">KubernetesのRBACについて - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="オートスケール">オートスケール&lt;/h2>
&lt;h3 id="horizontal-pod-autoscaler">Horizontal Pod Autoscaler&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/">https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Podの水平オートスケーラー&lt;/p>
&lt;ul>
&lt;li>v1 &amp;hellip; CPU使用率(requestsの平均)でスケール&lt;/li>
&lt;li>v2
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/autoscaling/hpa-v2.md">https://github.com/kubernetes/community/blob/master/contributors/design-proposals/autoscaling/hpa-v2.md&lt;/a>&lt;/li>
&lt;li>カスタムメトリクス対応&lt;/li>
&lt;li>複数メトリクス対応&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>Example:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">HorizontalPodAutoscaler&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">autoscaling/v2alpha1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">WebFrontend&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">scaleTargetRef&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">ReplicationController&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">WebFrontend&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">minReplicas&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">maxReplicas&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">10&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">metrics&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Resource&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">resource&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">cpu&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">targetAverageUtilization&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">80&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Object&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">object&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">target&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Service&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Frontend&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">metricName&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">hits-per-second&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">targetValue&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">1k&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://cloud.google.com/kubernetes-engine/docs/how-to/horizontal-pod-autoscaling">Configuring a Horizontal Pod Autoscaler - GKE&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cloud.google.com/monitoring/kubernetes-engine/observing?hl=ja">GKE クラスタの観察 | Stackdriver Monitoring | Google Cloud&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/k-hal/items/5f060fdbafa3d29b3499#hpa">GKEでPodとNodeをAutoscaling する - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="cluster-autoscaler">Cluster Autoscaler&lt;/h3>
&lt;p>&lt;a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler">https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler&lt;/a>&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md">FAQ.md&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="storage">Storage&lt;/h2>
&lt;h3 id="persistentvolume">PersistentVolume&lt;/h3>
&lt;p>&lt;a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">https://kubernetes.io/docs/concepts/storage/persistent-volumes/&lt;/a>&lt;/p>
&lt;p>永続化ボリューム&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://cstoku.dev/posts/2018/k8sdojo-12/">Kubernetes道場 12日目 - PersistentVolume / PersistentVolumeClaim / StorageClassについて - Toku&amp;rsquo;s Blog&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="リソース管理">リソース管理&lt;/h2>
&lt;h3 id="コンテナやpodへのcpuメモリの割当て">コンテナやPodへのCPU/メモリの割当て&lt;/h3>
&lt;p>基本:&lt;/p>
&lt;ul>
&lt;li>Podは、cpu/memory requests以上の空きリソースを持つノードにスケジュールされる&lt;/li>
&lt;li>コンテナのcpu利用量がlimit値を越えるとスロットルされる = パフォーマンス劣化する&lt;/li>
&lt;li>コンテナのmemory利用量がlimit値を越えるとOOM Killerで殺される。再起動できるときは再起動される&lt;/li>
&lt;li>Podが複数のコンテナで構成される場合、リソース指定値は全コンテナの合計値になる&lt;/li>
&lt;li>requestsを指定しないとデフォルト値になる&lt;/li>
&lt;li>limitsを指定しないとノードで利用可能な最大値になる&lt;/li>
&lt;/ul>
&lt;p>Tips:&lt;/p>
&lt;ul>
&lt;li>コンテナのcpu/memoryのrequestsより大きなlimitsを指定することで、突発的な負荷に耐えられるようになり、かつ、適切に制限をかけられる&lt;/li>
&lt;/ul>
&lt;p>ベストプラクティス:&lt;/p>
&lt;ul>
&lt;li>NamespaceでResourceQuotasやLimitRangeを設定すると良い
&lt;ul>
&lt;li>See &lt;a href="https://progrhy.me/tech-notes/a/software/k8s/namespace/#resourcequotas">Namespace#resourcequotas&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/ja/docs/tasks/configure-pod-container/assign-cpu-resource/">コンテナおよびPodへのCPUリソースの割り当て - Kubernetes&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/ja/docs/tasks/configure-pod-container/assign-memory-resource/">コンテナおよびPodへのメモリーリソースの割り当て - Kubernetes&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.scsk.jp/sp/sysdig/blog/sysdig_monitor/kubernetes_118.html">例を交えてKubernetesのリミットとリクエストを理解する | Sysdigブログ - コンテナ・Kubernetes環境向けセキュリティ・モニタリング プラットフォーム&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cloud.google.com/blog/products/gcp/kubernetes-best-practices-resource-requests-and-limits">Kubernetes best practices: Resource requests and limits | Google Cloud Blog&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.microsoft.com/ja-jp/azure/aks/developer-best-practices-resource-management">開発者のベスト プラクティス - Azure Kubernetes Service (AKS) でのリソース管理 | Microsoft Docs&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="pod-eviction">Pod Eviction&lt;/h3>
&lt;p>Documents:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/">https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>メモ:&lt;/p>
&lt;ul>
&lt;li>ノードのメモリが不足すると、Podがevictされることがある&lt;/li>
&lt;li>メモリ使用量の大きなPodからeviction対象になる&lt;/li>
&lt;li>memoryのrequets/limitsを適切に設定しておくこと&lt;/li>
&lt;/ul>
&lt;p>EvictしたPodは手動で削除する必要があるっぽい。
See &lt;a href="https://progrhy.me/tech-notes/a/software/k8s/kubectl/#evicted%E3%81%AApod%E3%82%92%E4%B8%80%E6%8B%AC%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B%E3%83%AF%E3%83%B3%E3%83%A9%E3%82%A4%E3%83%8A%E3%83%BC">kubectl#EvictedなPodを一括削除するワンライナー&lt;/a>&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.scsk.jp/sp/sysdig/blog/sysdig_monitor/kubernetes_pod_evicted.html">Kubernetes pod evictedとスケジューリングの問題を理解する | Sysdigブログ - コンテナ・Kubernetes環境向けセキュリティ・モニタリング プラットフォーム&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/ja/docs/concepts/architecture/nodes/">ノード - Kubernetes&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ロギング">ロギング&lt;/h2>
&lt;p>概念:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/concepts/cluster-administration/logging/">Logging Architecture - Kubernetes&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>ソリューション:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/debug-application-cluster/logging-stackdriver/">Logging Using Stackdriver - Kubernetes&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: エコシステム</title><link>https://progrhy.me/tech-notes/a/software/k8s/ecosystem/</link><pubDate>Thu, 07 May 2020 11:10:18 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/k8s/ecosystem/</guid><description>
&lt;h2 id="参考">参考&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/cvusk/items/100dfb955150ef8964e5">Kubernetesのエコシステムをまとめる - Qiita&lt;/a> 2018年5月時点&lt;/li>
&lt;li>&lt;a href="https://qiita.com/ynott/items/89941c36c606a8384028">k3s と MicroK8s の違いを考える - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="マニフェスト管理">マニフェスト管理&lt;/h2>
&lt;p>※ * は当サイト内のページ&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/k8s/kustomize/">kustomize&lt;/a> *&lt;/li>
&lt;li>&lt;a href="https://helm.sh/">Helm&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/ksonnet/ksonnet">ksonnet&lt;/a>
&lt;ul>
&lt;li>2019年2月で更新が止まっている。参考: &lt;a href="https://tanzu.vmware.com/content/blog/welcoming-heptio-open-source-projects-to-vmware">Welcoming Heptio Open Source Projects to VMware&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="クラスタ構築">クラスタ構築&lt;/h2>
&lt;ul>
&lt;li>kubeadm &amp;hellip; 公式&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://knowledge.sakura.ad.jp/20955/">2019年版・Kubernetesクラスタ構築入門 | さくらのナレッジ&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="開発テスト用">開発・テスト用&lt;/h3>
&lt;ul>
&lt;li>Minikube（See below）&lt;/li>
&lt;li>&lt;a href="https://kind.sigs.k8s.io/">Kind&lt;/a>
&lt;ul>
&lt;li>参考:
&lt;ul>
&lt;li>&lt;a href="https://speakerdeck.com/ytaka23/cicd-test-night-5th">Kind で量産する使い捨て Kubernetes #cicd_test_night / CICD Test Night 5th - Speaker Deck&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/Hiroyuki_OSAKI/items/2395e6bbb98856df12f3">kindで軽量テスト用Kubernetesクラスタを作る＆運用する時のTIPS - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://microk8s.io/">MicroK8s&lt;/a> &amp;hellip; Canonical社が出してるやつ
&lt;ul>
&lt;li>参考: &lt;a href="https://gihyo.jp/admin/serial/01/ubuntu-recipe/0560">第560回 microk8sでお手軽Kubernetes環境構築：Ubuntu Weekly Recipe｜gihyo.jp … 技術評論社&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="minikube">Minikube&lt;/h4>
&lt;p>&lt;a href="https://github.com/kubernetes/minikube">https://github.com/kubernetes/minikube&lt;/a>&lt;/p>
&lt;p>ローカルでKubernetesを動かすためのツール。&lt;br>
Linuxのみだが、ハイパーバイザを噛まさず、ローカルのdocker上に直接クラスタを構築することもできる。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/getting-started-guides/minikube/">https://kubernetes.io/docs/getting-started-guides/minikube/&lt;/a> &amp;hellip; 導入ガイド
&lt;ul>
&lt;li>※先にkubectlをインストールしておくこと&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/mumoshu/items/8f55ee830d8e5c172dd4">minikubeでローカルKubernetesクラスタを5分でつくる方法 - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://blog.1q77.com/2016/10/setup-kubernetes-1-4-using-minikube/">minikube でローカルでのテスト用 Kubernetes を構築 – 1Q77&lt;/a>&lt;/li>
&lt;li>&lt;a href="http://reiki4040.hatenablog.com/entry/2017/04/11/221122">ローカルでkubernetesを動かせるminikubeを試す - 年中アイス&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="クライアント">クライアント&lt;/h2>
&lt;p>kubectlと周辺ツールについては&lt;a href="https://progrhy.me/tech-notes/a/software/k8s/kubectl/">kubectl&lt;/a>を見よ。&lt;/p>
&lt;ul>
&lt;li>K9s &amp;hellip; See below&lt;/li>
&lt;/ul>
&lt;h3 id="k9s">K9s&lt;/h3>
&lt;p>&lt;a href="https://k9scli.io/">K9s - Manage Your Kubernetes Clusters In Style&lt;/a>&lt;/p>
&lt;p>Documents:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://k9scli.io/topics/install/">Install&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://k9scli.io/topics/commands/">Commands&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://tech.enigmo.co.jp/entry/2019/12/17/090000">k9sで快適なk8sライフを送ろう！ - エニグモ開発者ブログ&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="cli">CLI&lt;/h4>
&lt;p>オプション&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>オプション&lt;/th>
&lt;th>意味&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>--readonly&lt;/code>&lt;/td>
&lt;td>更新操作を無効にする&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>NOTE:&lt;/p>
&lt;ul>
&lt;li>モニタリング用途で使う場合、 &lt;code>--readonly&lt;/code> をつけるべき&lt;/li>
&lt;/ul>
&lt;h4 id="インタラクティブモード">インタラクティブモード&lt;/h4>
&lt;p>&lt;code>k9s&lt;/code> コマンド起動後の操作&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>コマンド&lt;/th>
&lt;th>意味&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>:q[uit]&lt;/code>, &lt;code>Ctrl+c&lt;/code>&lt;/td>
&lt;td>終了&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>&amp;lt;Esc&amp;gt;&lt;/code>&lt;/td>
&lt;td>元の画面に戻る&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>:ctx&lt;/code>&lt;/td>
&lt;td>context選択&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>:ns&lt;/code>&lt;/td>
&lt;td>namespace選択&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>/&lt;/code>&lt;/td>
&lt;td>リソースフィルタ。あいまい検索。 &lt;code>-l&lt;/code> でラベルセレクトも使える&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>d&lt;/code>, &lt;code>y&lt;/code>&lt;/td>
&lt;td>describe, YAMLを見る&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>e&lt;/code>&lt;/td>
&lt;td>編集&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>l&lt;/code>&lt;/td>
&lt;td>ログ表示&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>Ctrl+d&lt;/code>&lt;/td>
&lt;td>リソースを削除する&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>Ctrl+k&lt;/code>&lt;/td>
&lt;td>リソースを停止（Kill）する（&lt;strong>確認ダイアログはない&lt;/strong>）&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="cicd">CI/CD&lt;/h2>
&lt;p>※ * は当サイト内のページ&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://argoproj.github.io/argo-cd/">Argo CD&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://concourse-ci.org/">Concourse&lt;/a>
&lt;ul>
&lt;li>参考: &lt;a href="https://www.atmarkit.co.jp/ait/articles/1909/04/news005.html">Kubernetesを前提としたCI/CDパイプラインの具体例と、本番運用に必要なもの (1/2)：コンテナベースのCI/CD本番事例大解剖（3） - ＠IT&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://jenkins-x.io/">Jenkins X&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/test-infra/tree/master/prow">Prow&lt;/a>
&lt;ul>
&lt;li>参考: &lt;a href="https://developers.cyberagent.co.jp/blog/archives/22072/">KubernetesベースのCI/CDシステムProwに入門してみた | CyberAgent Developers Blog&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Skaffold（See below）&lt;/li>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/job-man/spinnaker/">Spinnaker&lt;/a> *&lt;/li>
&lt;li>&lt;a href="https://tekton.dev/">Tekton&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://www.inovex.de/blog/spinnaker-vs-argo-cd-vs-tekton-vs-jenkins-x/">Spinnaker vs. Argo CD vs. Tekton vs. Jenkins X: Cloud-Native CI/CD&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="skaffold">Skaffold&lt;/h3>
&lt;p>開発・本番向けにKubernetesクラスタに継続的デリバリーを実施するコマンドラインツール。&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/GoogleContainerTools/skaffold">https://github.com/GoogleContainerTools/skaffold&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://skaffold.dev/">https://skaffold.dev/&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="暗号化">暗号化&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/bitnami-labs/sealed-secrets">bitnami-labs/sealed-secrets: A Kubernetes controller and tool for one-way encrypted Secrets&lt;/a>
&lt;ul>
&lt;li>Secretを暗号化してセキュアに管理する方法を提供してくれる&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://tech.uzabase.com/entry/2020/03/10/171733">Sealed Secretsを利用したKubernetes Secretリソースのセキュアな管理 - Uzabase Tech Blog&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="その他">その他&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://k3s.io/">K3s: Lightweight Kubernetes&lt;/a> &amp;hellip; Rancherが出してる軽量版K8s&lt;/li>
&lt;li>&lt;a href="https://ksync.github.io/ksync/">ksync | Sync files between your local system and a kubernetes cluster.&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: ConfigMap</title><link>https://progrhy.me/tech-notes/a/software/k8s/configmap/</link><pubDate>Mon, 04 May 2020 22:39:04 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/k8s/configmap/</guid><description>
&lt;p>See also &lt;a href="https://progrhy.me/tech-notes/a/software/k8s/secret/">Secret&lt;/a>&lt;/p>
&lt;h2 id="overview">Overview&lt;/h2>
&lt;p>&lt;a href="https://cstoku.dev/posts/2018/k8sdojo-11/">Kubernetes道場 11日目 - ConfigMap / Secretについて - Toku&amp;rsquo;s Blog&lt;/a>より&lt;/p>
&lt;blockquote>
&lt;p>ConfigMapやSecretはアプリケーションの設定やクレデンシャルをコンテナイメージから分離するために使われる。&lt;br>
ConfigMapやSecretをVolumeとして、または環境変数を通してPodに設定やクレデンシャルを渡す。&lt;/p>
&lt;/blockquote>
&lt;p>ConfigMapはSecretと違い、値をencodeせずに平文でYAMLに書くので、普通の設定ファイル的な位置づけ。&lt;/p>
&lt;blockquote>
&lt;p>A ConfigMap is an API object used to store non-confidential data in key-value pairs. Pods can consume ConfigMaps as environment variables, command-line arguments, or as configuration files in a volume .&lt;/p>
&lt;/blockquote>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/tkusumi/items/cf7b096972bfa2810800">Kubernetes: ConfigMap / Secret の内容を一度に環境変数として読み込む (envFrom) - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="getting-started">Getting Started&lt;/h2>
&lt;p>公式サイトにいくつかのガイドやサンプルがある:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/">Configure a Pod to Use a ConfigMap - Kubernetes&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/tutorials/configuration/configure-redis-using-configmap/">Configuring Redis using a ConfigMap | Kubernetes&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: Container</title><link>https://progrhy.me/tech-notes/a/software/k8s/container/</link><pubDate>Mon, 04 May 2020 22:14:09 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/k8s/container/</guid><description>
&lt;p>Kubernetesにおいて、基本的にコンテナはPod内で定義され、実行される（はず）。&lt;/p>
&lt;p>See also &lt;a href="https://progrhy.me/tech-notes/a/software/k8s/pod/">Pod&lt;/a>&lt;/p>
&lt;h2 id="cpuメモリの割当て">CPU/メモリの割当て&lt;/h2>
&lt;p>考え方やベストプラクティスについては&lt;a href="https://progrhy.me/tech-notes/a/software/k8s/concept/#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%84pod%E3%81%B8%E3%81%AEcpu%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AE%E5%89%B2%E5%BD%93%E3%81%A6">Concept#コンテナやpodへのcpuメモリの割当て&lt;/a>を見よ。&lt;/p>
&lt;h2 id="コマンド引数の定義">コマンド/引数の定義&lt;/h2>
&lt;p>See &lt;a href="https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/#notes">https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/#notes&lt;/a>&lt;/p>
&lt;p>Example:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Pod&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">command-demo&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">labels&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">purpose&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">demonstrate-command&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">containers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">command-demo-container&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">image&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">debian&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">command&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;printenv&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">args&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;HOSTNAME&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;KUBERNETES_PORT&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">restartPolicy&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">OnFailure&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="livenessreadiness-probes">liveness/readiness probes&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">Configure Liveness, Readiness and Startup Probes - Kubernetes&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>ヘルスチェック的なもの。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://cstoku.dev/posts/2018/k8sdojo-10/">Kubernetes道場 10日目 - LivenessProbe / ReadinessProbeについて - Toku&amp;rsquo;s Blog&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="lifecycle-hooks">Lifecycle Hooks&lt;/h2>
&lt;p>&lt;a href="https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/">https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/&lt;/a>&lt;/p>
&lt;p>See also &lt;a href="https://progrhy.me/tech-notes/a/software/k8s/pod/#%E3%83%A9%E3%82%A4%E3%83%95%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB">Pod#ライフサイクル&lt;/a>&lt;/p>
&lt;p>以下のフックを仕込むことで、コマンド実行などが可能。&lt;/p>
&lt;ul>
&lt;li>PostStart&lt;/li>
&lt;li>PreStop &amp;hellip; 終了直前に実行される&lt;/li>
&lt;/ul>
&lt;p>詳細な仕様はAPIリファレンスを見よ。&lt;/p>
&lt;p>設定例:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Pod&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">lifecycle-demo&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">containers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">lifecycle-demo-container&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">image&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">httpd&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">lifecycle&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">preStop&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">exec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">command&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;sh&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;-c&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;sleep 2; httpd -k graceful-stop; sleep 30&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">terminationGracePeriodSeconds&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">40&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://44smkn.hatenadiary.com/entry/2018/08/01/022312">pod(Kubernetes)のlifecycle.prestopの挙動 - １クール続けるブログ&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cstoku.dev/posts/2018/k8sdojo-06/">Kubernetes道場 6日目 - Init Container / Lifecycleについて - Toku&amp;rsquo;s Blog&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: Deployment</title><link>https://progrhy.me/tech-notes/a/software/k8s/deployment/</link><pubDate>Mon, 04 May 2020 21:45:16 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/k8s/deployment/</guid><description>
&lt;p>&lt;a href="https://kubernetes.io/ja/docs/concepts/workloads/controllers/deployment/">https://kubernetes.io/ja/docs/concepts/workloads/controllers/deployment/&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>Deployment コントローラーはPodとReplicaSetの宣言的なアップデート機能を提供します。&lt;/p>
&lt;/blockquote>
&lt;p>Example:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">apps/v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Deployment&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">nginx-deployment&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">namespace&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">app&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">selector&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">matchLabels&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">app&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">nginx&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">replicas&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">template&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">labels&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">app&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">nginx&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">containers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">nginx&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">image&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">nginx&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">ports&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">containerPort&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">80&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://cstoku.dev/posts/2018/k8sdojo-08/">Kubernetes道場 8日目 - ReplicaSet / Deploymentについて - Toku&amp;rsquo;s Blog&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="spec">spec&lt;/h2>
&lt;h3 id="strategy">strategy&lt;/h3>
&lt;p>更新戦略。&lt;/p>
&lt;p>Example:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">strategy&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">rollingUpdate&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">maxSurge&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">25&lt;/span>&lt;span style="color:#000">%&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">maxUnavailable&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">25&lt;/span>&lt;span style="color:#000">%&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">RollingUpdate&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>上はデフォルト値。&lt;/p>
&lt;ul>
&lt;li>type &amp;hellip; &lt;code>Recreate&lt;/code> を選ぶと既存の全てのPodは新しいPodが作成される前に削除される&lt;/li>
&lt;li>&lt;code>maxSurge&lt;/code> &amp;hellip; 理想状態のPod数を超えて作成できる最大のPod数/割合。絶対数も指定可能&lt;/li>
&lt;li>&lt;code>maxUnavailable&lt;/code> &amp;hellip; 更新中に利用不可となる最大のPod数/割合。絶対数も指定可能
&lt;ul>
&lt;li>本番ではキャパシティが低下しないように &lt;code>0&lt;/code> にしておいた方が良さそう。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/TakiTake@github/items/bfc977baf4b909b1e118">KubernetesのRolling updateを安全に行う - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://rahmonov.me/posts/zero-downtime-deployment-with-kubernetes/">Zero Downtime Deployment with Kubernetes&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: kubectl</title><link>https://progrhy.me/tech-notes/a/software/k8s/kubectl/</link><pubDate>Fri, 01 May 2020 12:15:07 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/k8s/kubectl/</guid><description>
&lt;p>Kubernetesクラスタを制御するCLI.&lt;/p>
&lt;h2 id="documentation">Documentation&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/kubectl/overview/">https://kubernetes.io/docs/reference/kubectl/overview/&lt;/a>&lt;/li>
&lt;li>リファレンス: &lt;a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/">kubectl Cheat Sheet - Kubernetes&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://kubectl.docs.kubernetes.io/">https://kubectl.docs.kubernetes.io/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://cstoku.dev/posts/2018/k8sdojo-23/">Kubernetes道場 23日目 - kubectlを網羅する - Toku&amp;rsquo;s Blog&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="周辺ツール">周辺ツール&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://krew.sigs.k8s.io/">Krew&lt;/a> &amp;hellip; kubectl plugin manager&lt;/li>
&lt;li>&lt;a href="https://github.com/ahmetb/kubectx">kubectx&lt;/a> &amp;hellip; context, namespaceの切替を簡単にしてくれる&lt;/li>
&lt;li>&lt;a href="https://progrhy.me/tech-notes/a/software/k8s/kustomize/">kustomize&lt;/a> &amp;hellip; Kubernetesのマニフェスト管理ツール。kubectl 1.14からkubectlに取り込まれた&lt;/li>
&lt;li>&lt;a href="https://github.com/lbolla/kube-secret-editor">lbolla/kube-secret-editor&lt;/a> &amp;hellip; secretをデコードした状態で編集することを可能にし、編集後にエンコードして保存してくれる&lt;/li>
&lt;/ul>
&lt;h2 id="設定">設定&lt;/h2>
&lt;h3 id="kubeconfig">kubeconfig&lt;/h3>
&lt;p>環境設定ファイルkubeconfigを参照する順番:&lt;/p>
&lt;blockquote>
&lt;ol>
&lt;li>&lt;code>--kubeconfig&lt;/code> フラグで指定されたパス&lt;/li>
&lt;li>&lt;code>$KUBECONFIG&lt;/code> 環境変数に指定されたパス一覧&lt;/li>
&lt;li>&lt;code>~/.kube/config&lt;/code>&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;p>See &lt;a href="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/">Organizing Cluster Access Using kubeconfig Files - Kubernetes&lt;/a>&lt;/p>
&lt;p>NOTE:&lt;/p>
&lt;ul>
&lt;li>&lt;code>$KUBECONFIG&lt;/code> は &lt;code>:&lt;/code> 区切りで複数ファイル設定可能で、その場合、複数ファイルがマージされた内容を扱うことができる&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/shoichiimamura/items/91208a9b30e701d1e7f2">kubectlの接続設定ファイル（kubeconfig）の概要 - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ユースケース">ユースケース&lt;/h2>
&lt;h3 id="環境設定---config--context">環境設定 - config &amp;amp; context&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic">## kubeconfig 表示&lt;/span>
kubectl config view
&lt;span style="color:#8f5902;font-style:italic">### 現在のcontextだけを表示&lt;/span>
kubectl config view --minify
&lt;span style="color:#8f5902;font-style:italic">## context&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">### 一覧表示&lt;/span>
kubectl config get-contexts
&lt;span style="color:#8f5902;font-style:italic">#### ヘッダ無しで名前だけ表示&lt;/span>
kubectl config get-contexts --no-headers -o&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>name
&lt;span style="color:#8f5902;font-style:italic">### 現在のcontext&lt;/span>
kubectl config current-context
&lt;span style="color:#8f5902;font-style:italic">### 切替え&lt;/span>
kubectl config use-context &amp;lt;context-name&amp;gt;
&lt;span style="color:#8f5902;font-style:italic">### rename&lt;/span>
kubectl config rename-context &amp;lt;old-name&amp;gt; &amp;lt;new-name&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-access-for-kubectl?hl=ja">kubectl 用のクラスタ アクセスの構成 | Kubernetes Engine のドキュメント | Google Cloud&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="namespaceの操作設定">Namespaceの操作・設定&lt;/h3>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># コンテキストのデフォルトnamespaceを設定する&lt;/span>
kubectl config set-context &lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>kubectl config current-context&lt;span style="color:#204a87;font-weight:bold">)&lt;/span> --namespace&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>NAMESPACE
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/nirasan/items/9dcc7e45cf20fb72bf8a">kubectl で Namespace を切り替える - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="実行公開">実行・公開&lt;/h3>
&lt;ul>
&lt;li>run &amp;hellip; コンテナイメージを実行する。deploymentまたはjobが作られる。&lt;/li>
&lt;li>expose &amp;hellip; リソースをクラスタ外にServiceとして公開する。&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic">## run&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">### 例&lt;/span>
kubectl run nginx --image&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>nginx
&lt;span style="color:#8f5902;font-style:italic">## expose&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">### 例&lt;/span>
kubectl expose deployment &amp;lt;deployment-name&amp;gt; --port&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">80&lt;/span> --target-port&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">8000&lt;/span>
kubectl run &amp;lt;deployment-name&amp;gt; --image&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&amp;lt;image-name&amp;gt; --port&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&amp;lt;port&amp;gt;
kubectl expose deployment &amp;lt;deployment-name&amp;gt; --type&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>NodePort
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="app-management">App Management&lt;/h3>
&lt;ul>
&lt;li>autoscale&lt;/li>
&lt;li>scale &amp;hellip; 次のリソースのサイズを設定する:
&lt;ul>
&lt;li>Deployment, ReplicaSet, Replication Controller, StatefulSet&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic">## scale&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">### ReplicaSet &amp;#39;foo&amp;#39; を3に&lt;/span>
kubectl scale --replicas&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">3&lt;/span> rs/foo
kubectl scale --replicas&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">3&lt;/span> -f foo.yml
&lt;span style="color:#8f5902;font-style:italic">### 今のサイズが2だったら3にする&lt;/span>
kubectl scale --current-replicas&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span> --replicas&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">3&lt;/span> deployment/mysql
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="リソース管理">リソース管理&lt;/h3>
&lt;h4 id="作成更新">作成・更新&lt;/h4>
&lt;ul>
&lt;li>create/apply/replace &amp;hellip; JSON or YAMLのリソース定義ファイルを適用して、リソースを作成/更新する。&lt;/li>
&lt;li>patch &amp;hellip; YAML/JSONのマージを用いて、リソース定義を差分更新する&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># create&lt;/span>
kubectl create -f &amp;lt;Path or URL of config file&amp;gt;
&lt;span style="color:#8f5902;font-style:italic">## ファイルから Secret を作成&lt;/span>
kubectl create secret generic my-secret --from-file&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>./secret/secret.json
&lt;span style="color:#8f5902;font-style:italic">## ファイルから ConfigMap を作成&lt;/span>
kubectl create configmap my-config --from-file&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>./config/config.json
&lt;span style="color:#8f5902;font-style:italic"># apply&lt;/span>
kubectl apply -f &amp;lt;Path or URL of config file&amp;gt;
&lt;span style="color:#8f5902;font-style:italic">## 例&lt;/span>
kubectl apply -f https://k8s.io/docs/tasks/run-application/deployment.yaml
kubectl apply -f ./pod.json
&lt;span style="color:#8f5902;font-style:italic"># replace&lt;/span>
kubectl replace -f &amp;lt;Path or URL of config file&amp;gt;
&lt;span style="color:#8f5902;font-style:italic"># patch&lt;/span>
kubectl patch &amp;lt;Resource Type&amp;gt; &amp;lt;Name&amp;gt; --patch &amp;lt;YAML Content&amp;gt;
&lt;span style="color:#8f5902;font-style:italic">## 例&lt;/span>
kubectl patch deployment patch-demo --patch &lt;span style="color:#4e9a06">&amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>cat patch-file.yaml&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/tasks/run-application/update-api-object-kubectl-patch/">Update API Objects in Place Using kubectl patch - Kubernetes&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://tellme.tokyo/post/2018/08/07/kubernetes-configmaps-secrets/">Kubernetes 上で Credentials を扱う | tellme.tokyo&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cstoku.dev/posts/2018/k8sdojo-23/">Kubernetes道場 23日目 - kubectlを網羅する - Toku&amp;rsquo;s Blog&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://codeday.me/jp/qa/20190406/566540.html">kubectl applyとkubectl replaceの違いは何ですか - コードログ&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="pod操作">Pod操作&lt;/h4>
&lt;ul>
&lt;li>exec &amp;hellip; コマンドをコンテナ内で実行する&lt;/li>
&lt;li>cp &amp;hellip; ファイルをクライアント環境とPod間でやりとり&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic">## exec&lt;/span>
kubectl &lt;span style="color:#204a87">exec&lt;/span> &amp;lt;pod&amp;gt; -- &amp;lt;command&amp;gt; &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>args...&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">### podにbashでログイン&lt;/span>
kubectl &lt;span style="color:#204a87">exec&lt;/span> -it &amp;lt;pod&amp;gt; -- /bin/bash -l
&lt;span style="color:#8f5902;font-style:italic">## cp&lt;/span>
kubectl cp path/to/localfile &amp;lt;pod&amp;gt;:/path/to/remotefile
kubectl cp &amp;lt;pod&amp;gt;:/path/to/remotefile /path/to/localfile
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/suzukihi724/items/515654f54538a2103ee0">kubernetes: コンテナイメージにログインする - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="node操作">Node操作&lt;/h4>
&lt;ul>
&lt;li>cordon &amp;hellip; ノードへのスケジュールを停止&lt;/li>
&lt;li>drain &amp;hellip; ノードからPodを削除&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic">## cordon&lt;/span>
kubectl cordon &amp;lt;node-name&amp;gt;
&lt;span style="color:#8f5902;font-style:italic">## drain&lt;/span>
kubectl drain &amp;lt;node-name&amp;gt;
&lt;span style="color:#8f5902;font-style:italic">### DaemonSetで管理されてPodを停止するとき&lt;/span>
kubectl drain &amp;lt;node-name&amp;gt; --ignore-daemonsets
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://blog.applibot.co.jp/2016/12/27/kubernetes-zero-downtime/">kubernetesの無停止運用を意識した検証 – てっくぼっと！&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/toshihirock/items/d22fee20b1a561b9efea">Kubernetes の drain について検証した時のメモ - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="表示">表示&lt;/h4>
&lt;ul>
&lt;li>get &amp;hellip; 単一・複数リソースの情報を表示する。&lt;/li>
&lt;li>describe &amp;hellip; 単一リソース or グループの情報を表示&lt;/li>
&lt;li>diff &amp;hellip; リソースファイルとクラスタの状態を差分表示&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># get&lt;/span>
kubectl get deploy&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ments&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
kubectl get po&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ds&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>-o json&lt;span style="color:#000;font-weight:bold">|&lt;/span>yaml&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">## フィルタの例&lt;/span>
kubectl get pods -l &lt;span style="color:#000">app&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>nginx
&lt;span style="color:#8f5902;font-style:italic">## ヘッダ無し + 出力フィールド指定&lt;/span>
kubectl get namespaces --no-headers --output &lt;span style="color:#4e9a06">&amp;#34;custom-columns=NAME:.metadata.name&amp;#34;&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># describe&lt;/span>
kubectl describe pods &lt;span style="color:#8f5902;font-style:italic"># all pods&lt;/span>
kubectl describe pod &amp;lt;pod-name&amp;gt;
kubectl describe deploy&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>ment&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &amp;lt;deployment-name&amp;gt;
&lt;span style="color:#8f5902;font-style:italic"># diff&lt;/span>
kubectl diff -f foo.yml
&lt;span style="color:#8f5902;font-style:italic">## kustomizeバージョン&lt;/span>
kubectl diff -k .
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="削除">削除&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic">## delete&lt;/span>
kubectl delete deployment &amp;lt;deployment-name&amp;gt;
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="サブコマンド">サブコマンド&lt;/h2>
&lt;h3 id="apply">apply&lt;/h3>
&lt;p>基本的な利用イメージは&lt;a href="#%E4%BD%9C%E6%88%90%E6%9B%B4%E6%96%B0">ユースケース &amp;gt; リソース管理 &amp;gt; 作成更新&lt;/a>を見よ。&lt;/p>
&lt;p>オプション:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>オプション&lt;/th>
&lt;th>デフォルト&lt;/th>
&lt;th>機能&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>--prune&lt;/code>&lt;/td>
&lt;td>&lt;code>false&lt;/code>&lt;/td>
&lt;td>α in 2020-0505. &lt;br />指定されてないリソースを削除する。ただし、&lt;br /> &lt;code>--save-config&lt;/code> オプション付きで作られたものは除く。&lt;br /> &lt;code>-l&lt;/code> フィルタか &lt;code>--all&lt;/code> オプションと同時に使うべし&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>--prune-whitelist&lt;/code>&lt;/td>
&lt;td>&lt;code>[]&lt;/code>&lt;/td>
&lt;td>&lt;code>--prune&lt;/code> で使うデフォルトのホワイトリストを上書きする&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Examples:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># app=nginxラベルのリソースにマニフェストを適用し、マニフェスト外のリソースを削除する&lt;/span>
kubectl apply --prune -f manifest.yaml -l &lt;span style="color:#000">app&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>nginx
&lt;span style="color:#8f5902;font-style:italic"># マニフェストに書かれていないConfigMapを全て削除&lt;/span>
kubectl apply --prune -f manifest.yaml --all --prune-whitelist&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>core/v1/ConfigMap
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="logs">logs&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic">## 基本構文&lt;/span>
kubectl logs &amp;lt;Pod名&amp;gt; &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>Options&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">## 10行 tail -f&lt;/span>
kubectl logs &amp;lt;Pod名&amp;gt; --tail&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">10&lt;/span> -f
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="port-forward">port-forward&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># Syntax&lt;/span>
kubectl port-forward TYPE/NAME &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>options&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>LOCAL_PORT:&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>REMOTE_PORT &lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>...&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>LOCAL_PORT_N:&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>REMOTE_PORT_N&lt;span style="color:#ce5c00;font-weight:bold">]&lt;/span>
&lt;span style="color:#8f5902;font-style:italic"># Examples&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">## サービスの80番ポートをローカルの8080番ポートにforward&lt;/span>
kubectl port-forward service/myservice 8080:80
&lt;span style="color:#8f5902;font-style:italic">## Deploymentの5000, 6000番ポートをローカルの5000, 6000番ポートにforward&lt;/span>
kubectl port-forward deployment/mydeployment &lt;span style="color:#0000cf;font-weight:bold">5000&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">6000&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">## Pod指定&lt;/span>
kubectl port-forward pod/mypod &lt;span style="color:#0000cf;font-weight:bold">8080&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="proxy">proxy&lt;/h3>
&lt;p>API Proxyサーバを起動する&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">kubectl proxy --port&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">8080&lt;/span> &lt;span style="color:#000;font-weight:bold">&amp;amp;&lt;/span>
curl http://localhost:8080/api/
&lt;/code>&lt;/pre>&lt;/div>&lt;p>See &lt;a href="https://kubernetes.io/docs/tasks/administer-cluster/access-cluster-api/">https://kubernetes.io/docs/tasks/administer-cluster/access-cluster-api/&lt;/a>&lt;/p>
&lt;h2 id="how-to">How-to&lt;/h2>
&lt;h3 id="evictedなpodを一括削除するワンライナー">EvictedなPodを一括削除するワンライナー&lt;/h3>
&lt;p>EvictionしたPodは手動削除しないといけないっぽい。&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">kubectl get pods &lt;span style="color:#000;font-weight:bold">|&lt;/span> awk &lt;span style="color:#4e9a06">&amp;#39;{if ($3 ~ /Evicted/) system (&amp;#34;kubectl delete pods &amp;#34; $1)}&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>PodのEvictionについてはSee &lt;a href="https://progrhy.me/tech-notes/a/software/k8s/concept/#pod-eviction">Concept#pod-eviction&lt;/a>&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/keizokeizo3/items/84a3ece88cd86fde9f75">k8sでEvictedされたpodを一括削除する - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://stackoverflow.com/questions/46419163/what-will-happen-to-evicted-pods-in-kubernetes">What will happen to evicted pods in kubernetes? - Stack Overflow&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="全てのマニフェストを取得したい">全てのマニフェストを取得したい&lt;/h3>
&lt;p>これでよさそう:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">kubectl get all --export -o yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;p>NOTE:&lt;/p>
&lt;ul>
&lt;li>※v1.14で &lt;code>--export&lt;/code> オプションはdeprecateされているが、2020-05-07, 代替手段は見つけられていない。&lt;/li>
&lt;li>上だとPodもexport対象になるので、使い勝手悪いかも？&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/issues/24873">Is there a way to generate yml files that will produce the existing cluster? · Issue #24873 · kubernetes/kubernetes&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/kubernetes/kubernetes/pull/73787">Deprecate &amp;ndash;export flag from get command by soltysh · Pull Request #73787 · kubernetes/kubernetes&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/tkusumi/items/a824e040475fc47d311a">Kubernetes 1.14: Urgent Upgrade Notes, Deprecations, Removed and deprecated metrics, API Changes - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://gist.github.com/negz/c3ee465b48306593f16c523a22015bec">Dump Kubernetes cluster resources as YAML&lt;/a> &amp;hellip; シェルスクリプトで頑張っている事例&lt;/li>
&lt;/ul></description></item><item><title>A: kustomize</title><link>https://progrhy.me/tech-notes/a/software/k8s/kustomize/</link><pubDate>Mon, 04 May 2020 17:54:50 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/k8s/kustomize/</guid><description>
&lt;p>Kubernetesのマニフェスト管理ツール。&lt;/p>
&lt;p>リポジトリ: &lt;a href="https://github.com/kubernetes-sigs/kustomize">https://github.com/kubernetes-sigs/kustomize&lt;/a>&lt;/p>
&lt;p>kubectl 1.14からkustomizeが統合されている。&lt;/p>
&lt;h2 id="ドキュメント情報リソース">ドキュメント/情報リソース&lt;/h2>
&lt;ul>
&lt;li>Reference: &lt;a href="https://kubectl.docs.kubernetes.io/pages/reference/kustomize.html">https://kubectl.docs.kubernetes.io/pages/reference/kustomize.html&lt;/a>&lt;/li>
&lt;li>Examples: &lt;a href="https://github.com/kubernetes-sigs/kustomize/tree/master/examples">https://github.com/kubernetes-sigs/kustomize/tree/master/examples&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="cli-usage">CLI Usage&lt;/h2>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">kubectl kustomize
&lt;span style="color:#8f5902;font-style:italic"># kustomization.yaml を含むディレクトリで&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">## Apply the Resource Config&lt;/span>
kubectl apply -k .
&lt;span style="color:#8f5902;font-style:italic">## View the Resources&lt;/span>
kubectl get -k .
&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://kubectl.docs.kubernetes.io/pages/app_management/apply.html">https://kubectl.docs.kubernetes.io/pages/app_management/apply.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="how-to">How-to&lt;/h2>
&lt;h3 id="configmapの管理">ConfigMapの管理&lt;/h3>
&lt;ol>
&lt;li>configMapGeneratorで生成&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>(2020-03-18) &lt;code>behavior&lt;/code> を &lt;code>create&lt;/code>, &lt;code>replace&lt;/code>, &lt;code>merge&lt;/code> から選べるのだが、 &lt;code>create&lt;/code> 以外だとdiffでエラーが出るのだが…&lt;/li>
&lt;/ul>
&lt;ol>
&lt;li>resourcesで管理&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>ConfigMapをYAMLで管理することになる。こっちの方が扱いやすいように感じた&lt;/li>
&lt;/ul>
&lt;h2 id="参考">参考&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://deeeet.com/writing/2018/07/10/kustomize/">KustomizeでKubernetes YAMLを管理する | SOTA&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://blog.mosuke.tech/entry/2019/06/21/kustomize/">Kustomizeで環境ごとに異なるマニフェストを作る | Goldstine研究所&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: Namespace</title><link>https://progrhy.me/tech-notes/a/software/k8s/namespace/</link><pubDate>Mon, 04 May 2020 21:45:30 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/k8s/namespace/</guid><description>
&lt;p>&lt;a href="https://kubernetes.io/docs/tasks/administer-cluster/namespaces/">https://kubernetes.io/docs/tasks/administer-cluster/namespaces/&lt;/a>&lt;/p>
&lt;p>Kubernetesでは、複数の仮想的なクラスタを同じ物理クラスタ上に構築することができる。この仮想クラスタのことを &lt;strong>Namespace&lt;/strong> と呼ぶ。&lt;/p>
&lt;p>Example:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Namespace&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">myapp&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://cstoku.dev/posts/2018/k8sdojo-15/">Kubernetes道場 15日目 - Namespace / Resource QoS / ResourceQuota / LimitRangeについて - Toku&amp;rsquo;s Blog&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="リソース管理">リソース管理&lt;/h2>
&lt;p>See also &lt;a href="https://progrhy.me/tech-notes/a/software/k8s/concept/#%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%84pod%E3%81%B8%E3%81%AEcpu%E3%83%A1%E3%83%A2%E3%83%AA%E3%81%AE%E5%89%B2%E5%BD%93%E3%81%A6">Concept#コンテナやpodへのcpuメモリの割当て&lt;/a>&lt;/p>
&lt;p>ResourceQuotasやLimitRangeを設定することで、リソース管理をよりいい感じに行えるっぽい。（が、逆に面倒ではないかという気もする。）&lt;/p>
&lt;h3 id="resourcequotas">ResourceQuotas&lt;/h3>
&lt;p>&lt;a href="https://kubernetes.io/docs/concepts/policy/resource-quotas/">https://kubernetes.io/docs/concepts/policy/resource-quotas/&lt;/a>&lt;/p>
&lt;p>Example:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">ResourceQuota&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">compute-resources&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">hard&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">requests.cpu&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;1&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">requests.memory&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">1Gi&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">limits.cpu&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;2&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">limits.memory&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">2Gi&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>適用例:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">kubectl create -f ./compute-resources.yaml --namespace&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>myspace
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Note:&lt;/p>
&lt;ul>
&lt;li>ResourceQuotaを設定したnamespaceに属する全Podの合計値が上限になる&lt;/li>
&lt;li>cpu, memory以外も色々ある&lt;/li>
&lt;/ul>
&lt;h3 id="limitrange">LimitRange&lt;/h3>
&lt;p>&lt;a href="https://kubernetes.io/docs/concepts/policy/limit-range/">https://kubernetes.io/docs/concepts/policy/limit-range/&lt;/a>&lt;/p>
&lt;p>Example:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">LimitRange&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">limit-mem-cpu-per-container&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">limits&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">max&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">cpu&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;800m&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">memory&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;1Gi&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">min&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">cpu&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;100m&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">memory&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;99Mi&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">default&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">cpu&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;700m&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">memory&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;900Mi&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">defaultRequest&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">cpu&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;110m&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">memory&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;111Mi&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Container&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>namespaceに対して設定する&lt;/li>
&lt;li>cpu/memoryのrequests/limitsの下限、上限、デフォルト値を設定できる&lt;/li>
&lt;/ul></description></item><item><title>A: Pod</title><link>https://progrhy.me/tech-notes/a/software/k8s/pod/</link><pubDate>Mon, 04 May 2020 21:45:01 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/k8s/pod/</guid><description>
&lt;p>1つ以上のコンテナを内包する、ワークロードの基本単位。&lt;/p>
&lt;p>See also &lt;a href="https://progrhy.me/tech-notes/a/software/k8s/container/">Container&lt;/a>&lt;/p>
&lt;h2 id="スケジューリング">スケジューリング&lt;/h2>
&lt;p>&lt;a href="https://kubernetes.io/ja/docs/concepts/configuration/assign-pod-node/">Node上へのPodのスケジューリング - Kubernetes&lt;/a>&lt;/p>
&lt;p>NOTE:&lt;/p>
&lt;ul>
&lt;li>Podが起動できない理由:
&lt;ul>
&lt;li>OutOfMemory, OutOfCpu &amp;hellip; Nodeのリソースが足りない&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="affinity">Affinity&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/ja/docs/concepts/configuration/assign-pod-node/#affinity-%e3%81%a8-anti-affinity">Node上へのPodのスケジューリング - Kubernetes#AffinityとAnti-Affinity&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://cstoku.dev/posts/2018/k8sdojo-18/#affinity-anti-affinity">Kubernetes道場 18日目 - Affinity / Anti-Affinity / Taint / Tolerationについて - Toku&amp;rsquo;s Blog&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.1915keke.com/entry/2018/09/26/163447">KubernetesのNode AffinityとInternal Pod Affinityを使ってPodを高度スケジューリングする - Kekeの日記&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://qiita.com/sheepland/items/ed12b3dc4a8f1df7c4ec">KubernetesのNode Affinity, Inter-Pod Affinityについて - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="taintsとtolerations">TaintsとTolerations&lt;/h3>
&lt;p>&lt;a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">Taints and Tolerations - Kubernetes&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://qiita.com/sheepland/items/8fedae15e157c102757f">KubernetesのTaintsとTolerationsについて - Qiita&lt;/a>より:&lt;/p>
&lt;blockquote>
&lt;p>Node SelectorやNode Affinityが特定のノードに特定のPodをスケジュールするための仕組みに対し、TaintsとTolerationsは特定のノードにPodをスケジュールしないための仕組み&lt;/p>
&lt;/blockquote>
&lt;p>例えば、次のコマンドでノードに対してtaintを設定する:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">&lt;span style="color:#8f5902;font-style:italic"># taintの設定&lt;/span>
kubectl taint nodes node1 &lt;span style="color:#000">key&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>value:NoSchedule
&lt;span style="color:#8f5902;font-style:italic"># 上のtaintを削除するコマンド&lt;/span>
kubectl taint nodes node1 key:NoSchedule-
&lt;/code>&lt;/pre>&lt;/div>&lt;p>このtaintがつけられたノードにPodをスケジュールするには、下のいずれかのtolerationを設定する必要がある:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#8f5902;font-style:italic"># ①&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">tolerations&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#204a87;font-weight:bold">key&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;key&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">operator&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;Equal&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">value&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;value&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">effect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;NoSchedule&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#8f5902;font-style:italic"># ②&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">tolerations&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>- &lt;span style="color:#204a87;font-weight:bold">key&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;key&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">operator&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;Exists&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">effect&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;NoSchedule&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ライフサイクル">ライフサイクル&lt;/h2>
&lt;p>&lt;a href="https://kubernetes.io/ja/docs/concepts/workloads/pods/pod-lifecycle/">Podのライフサイクル - Kubernetes&lt;/a>&lt;/p>
&lt;p>See also &lt;a href="https://progrhy.me/tech-notes/a/software/k8s/container/#lifecycle-hooks">Container#lifecycle-hooks&lt;/a>&lt;/p>
&lt;h3 id="podの終了">Podの終了&lt;/h3>
&lt;p>&lt;a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/#termination-of-pods">https://kubernetes.io/docs/concepts/workloads/pods/pod/#termination-of-pods&lt;/a>&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/superbrothers/items/3ac78daba3560ea406b2">Kubernetes: 詳解 Pods の終了 - Qiita&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://tech-lab.sios.jp/archives/18730">KubernetesでRollingUpdateするためのPodの安全な終了 | SIOS Tech. Lab&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="topics">Topics&lt;/h2>
&lt;h3 id="crashloopbackoff">CrashLoopBackOff&lt;/h3>
&lt;p>発生条件:&lt;/p>
&lt;ul>
&lt;li>memory limits以上を使おうとしてOOMで殺され、繰り返し再起動されるとき
&lt;ul>
&lt;li>再起動間隔はexponential backoffで延びる&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/sheepland/items/eb0e4c65aaae70ec4e2f">KubernetesのResource RequestsとResource Limitsについて - Qiita&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="pod-eviction">Pod Eviction&lt;/h3>
&lt;p>See &lt;a href="https://progrhy.me/tech-notes/a/software/k8s/concept/#pod-eviction">Concept#pod-eviction&lt;/a>&lt;/p></description></item><item><title>A: Secret</title><link>https://progrhy.me/tech-notes/a/software/k8s/secret/</link><pubDate>Mon, 04 May 2020 22:39:15 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/k8s/secret/</guid><description>
&lt;p>See also &lt;a href="https://progrhy.me/tech-notes/a/software/k8s/configmap/">ConfigMap&lt;/a>&lt;/p>
&lt;h2 id="overview">Overview&lt;/h2>
&lt;p>ConfigMapと同じような使い方ができるが、暗号化機構が備わっており、クレデンシャルなど機微情報を扱うのに向いている。&lt;/p>
&lt;p>Podから環境変数として読み込むという使い方をすることが多いようだ。&lt;/p>
&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://ubiteku.oinker.me/2017/03/01/kubernetes-secrets/">Kubernetes Secrets の紹介 – データベースのパスワードやその他秘密情報をどこに保存するか？ – ゆびてく&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="documents">Documents&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/auth/secrets.md">design-proposals/secrets.md - kubernetes/community&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="secretsの作成">Secretsの作成&lt;/h2>
&lt;p>例1) テキストファイルから作成&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Bash" data-lang="Bash">&lt;span style="color:#204a87">echo&lt;/span> -n &lt;span style="color:#4e9a06">&amp;#39;admin&amp;#39;&lt;/span> &amp;gt; ./username.txt
&lt;span style="color:#204a87">echo&lt;/span> -n &lt;span style="color:#4e9a06">&amp;#39;1f2d1e2e67df&amp;#39;&lt;/span> &amp;gt; ./password.txt
kubectl create secret generic db-user-pass --from-file&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>./username.txt --from-file&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>./password.txt
&lt;/code>&lt;/pre>&lt;/div>&lt;p>例2) 自分で定義ファイル(YAML)を作る&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Bash" data-lang="Bash">&lt;span style="color:#204a87">echo&lt;/span> -n &lt;span style="color:#4e9a06">&amp;#39;admin&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> base64
&lt;span style="color:#000">YWRtaW4&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>
&lt;span style="color:#204a87">echo&lt;/span> -n &lt;span style="color:#4e9a06">&amp;#39;1f2d1e2e67df&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> base64
MWYyZDFlMmU2N2Rm
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#8f5902;font-style:italic">## secret.yaml&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Secret&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">mysecret&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Opaque&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">data&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">username&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">YWRtaW4=&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">password&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">MWYyZDFlMmU2N2Rm&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Bash" data-lang="Bash">kubectl apply -f ./secret.yaml
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="secretの参照">Secretの参照&lt;/h2>
&lt;p>ワークロードからSecretを参照したい場合、次のやり方を取ることができる:&lt;/p>
&lt;ul>
&lt;li>環境変数として直接Secretを参照する&lt;/li>
&lt;li>ボリュームとしてマウントし、ファイルを参照する&lt;/li>
&lt;/ul>
&lt;p>Example:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Pod&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">run&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">containers&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">run-container&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">image&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">debian&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">env&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">DB_PASSWORD&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">valueFrom&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">secretKeyRef&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">db-credentials&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># Secret名&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">key&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">password&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#8f5902;font-style:italic"># Secretに含まれるキー名&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">volumeMounts&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">secret&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">mountPath&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/app/.credentials&amp;#34;&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">volumes&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">secret&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">secret&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">secretName&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">app-credentials&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参考:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://qiita.com/propella/items/e6a6fd1f77a6e4417fda">Kubernetes Secret - Qiita&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>A: Service</title><link>https://progrhy.me/tech-notes/a/software/k8s/service/</link><pubDate>Mon, 04 May 2020 21:45:23 +0900</pubDate><guid>https://progrhy.me/tech-notes/a/software/k8s/service/</guid><description>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/concepts/services-networking/service/">https://kubernetes.io/docs/concepts/services-networking/service/&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cloud.google.com/kubernetes-engine/docs/concepts/service">https://cloud.google.com/kubernetes-engine/docs/concepts/service&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="overview">Overview&lt;/h2>
&lt;p>Podの集合で実行されている持続的なワークロードをネットワークサービスとして公開する抽象的な手法。&lt;/p>
&lt;p>Serviceを使用すると、メンバーPodのIPアドレスが変更されても、Serviceが存続している間に固定のIPアドレスを取得できる。&lt;/p>
&lt;p>Service定義ファイルのサンプル:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Service&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">my-service&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">selector&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">app&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">MyApp&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">ports&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>- &lt;span style="color:#204a87;font-weight:bold">protocol&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">TCP&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">port&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">80&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">targetPort&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#0000cf;font-weight:bold">9376&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>これはKubernetesクラスタ内で &lt;code>my-service&lt;/code> という名前でアクセスできる。&lt;/p>
&lt;h2 id="仕様">仕様&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#label-selectors">Label Selector&lt;/a> &amp;hellip; サービスを識別するためのラベルとそのセレクタ。&lt;/li>
&lt;li>&lt;strong>Endpoints&lt;/strong> API &amp;hellip; Service内のPodの変更に伴って更新される。&lt;/li>
&lt;/ul>
&lt;h2 id="serviceのtype">Serviceのtype&lt;/h2>
&lt;p>&lt;a href="https://cloud.google.com/kubernetes-engine/docs/concepts/service?hl=ja#types_of_services">https://cloud.google.com/kubernetes-engine/docs/concepts/service?hl=ja#types_of_services&lt;/a>&lt;/p>
&lt;ul>
&lt;li>&lt;code>ClusterIP&lt;/code> （デフォルト） &amp;hellip; クラスタ内で固定IPアドレスを獲得&lt;/li>
&lt;li>&lt;code>NodePort&lt;/code> &amp;hellip; 指定された1つ以上の &lt;code>nodePort&lt;/code> 値を利用して、ノードのIPアドレスを通じてアクセス可能になる&lt;/li>
&lt;li>&lt;code>LoadBalancer&lt;/code> &amp;hellip; ネットワークロードバランサを介したアクセスを提供&lt;/li>
&lt;li>&lt;code>ExternalName&lt;/code> &amp;hellip; See below&lt;/li>
&lt;li>&lt;code>Headless&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="externalname">ExternalName&lt;/h3>
&lt;p>&lt;a href="https://kubernetes.io/ja/docs/concepts/services-networking/service/#externalname">https://kubernetes.io/ja/docs/concepts/services-networking/service/#externalname&lt;/a>&lt;/p>
&lt;p>外部から参照できるDNS名を提供する。&lt;br>
この機能を使うには、GKEなどのように、KubernetesにDNSコンポーネントが導入されている必要がある。&lt;/p>
&lt;p>Example:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-YAML" data-lang="YAML">&lt;span style="color:#204a87;font-weight:bold">apiVersion&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">v1&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">kind&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">Service&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">metadata&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">name&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">my-service&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">namespace&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">prod&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">&lt;/span>&lt;span style="color:#204a87;font-weight:bold">spec&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">type&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">ExternalName&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#204a87;font-weight:bold">externalName&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline"> &lt;/span>&lt;span style="color:#000">my.database.example.com&lt;/span>&lt;span style="color:#f8f8f8;text-decoration:underline">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="参考記事など">参考記事など&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://cloud.google.com/kubernetes-engine/docs/concepts/service?hl=ja">Service | Kubernetes Engine のドキュメント | Google Cloud&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cstoku.dev/posts/2018/k8sdojo-09/">Kubernetes道場 9日目 - Serviceについて - Toku&amp;rsquo;s Blog&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>