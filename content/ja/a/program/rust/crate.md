---
title: "Crates"
linkTitle: "Crates"
description: https://crates.io/
date: 2020-05-30T22:17:01+09:00
weight: 120
---

## Crates

クレートはRustプログラムのパッケージを表す。  
`cargo new` するとcrateが作られる。

https://crates.io/ はクレートの公開レジストリ。
自作のクレートをここに登録することでユーザーに配布することができる。

参考:

- [Crates.ioにクレートを公開する - The Rust Programming Language](https://doc.rust-jp.rs/book/second-edition/ch14-02-publishing-to-crates-io.html)
- [Rust のモジュールシステム - Qiita](https://qiita.com/skitaoka/items/753a519d720a1ccebb0d)

## clap

https://crates.io/crates/clap

人気のCLIライブラリ。

## exitfailure

https://crates.io/crates/exitfailure

> Some newtype wrappers to help with using ? in main()

NOTE:

- 下のfailureと合わせて参考に挙げたガイドで紹介されているが、2020-05-30現在、2018-08-03で更新が止まっている。それだけ枯れてるのならいいのかもしれないが。

参考:

- [Nicer error reporting - Command Line Applications in Rust](https://rust-cli.github.io/book/tutorial/errors.html)

## failure

https://docs.rs/failure/

> An experimental new error-handling library.

ガイド:

- https://rust-lang-nursery.github.io/failure/

参考:

- [Nicer error reporting - Command Line Applications in Rust](https://rust-cli.github.io/book/tutorial/errors.html)

### Context

[Struct failure::Context](https://docs.rs/failure/0.1.8/failure/struct.Context.html)

> An error with context around it.

### ResultExt

[Trait failure::ResultExt](https://docs.rs/failure/0.1.8/failure/trait.ResultExt.html)

> Extension methods for Result.

#### with_context

https://docs.rs/failure/0.1.8/failure/trait.ResultExt.html#tymethod.with_context

```Rust
fn with_context<F, D>(self, f: F) -> Result<T, Context<D>>
// F: FnOnce(&E) -> D,
// D: Display + Send + Sync + 'static, 
```

> Wraps the error type in a context type generated by looking at the error value.

Examples:

```Rust
#[derive(Fail, Debug)]
#[fail(display = "My custom error message")]
struct CustomError;

let x = (|| -> Result<(), failure::Error> {
    Err(CustomError)?
})().with_context(|e| {
    format!("An error occured: {}", e)
}).unwrap_err();

let x = format!("{}", x);

assert_eq!(x, "An error occured: My custom error message");
```

## rand

https://crates.io/crates/rand

乱数生成

## structopt

https://crates.io/crates/structopt

clapに依存したCLIライブラリ。  
structを定義することでコマンドライン引数を解析する。
