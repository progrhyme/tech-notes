---
title: "2020-06-12"
linkTitle: "2020-06-12"
date: 2020-06-12T03:40:12+09:00
---

## 6/12
### 私はまだGolangのinterfaceが理解できていないようだ

shelpの実装中に次のようなコードを書いた。  
※簡略化してある。実際のコミットは https://github.com/progrhyme/shelp/commit/bd3b037d80c3fe6e235dd0868123f7d7e264c3bc

```go
type baser interface {
  getName() string
}

type base struct {
  name string
}

func (b *base) getName() string {
  return b.name
}

type option interface {
  height() int
}

type opt struct {
  h int
}

func (o *opt) height() int {
  return o.h
}

type heighter interface {
  baser
  getOpts() option
}

type heights struct {
  base
  opts opt
}

func (h *heights) getOpts() option {
  return &h.opts
}

type wOption interface {
  option
  width() int
}

type wopt struct {
  opt
  w int
}

func (o *wopt) width() int {
  return o.w
}

type widther interface {
  baser
  getOpts() wOption
}

type widths struct {
  base
  opts wopt
}

func (w *widths) getOpts() wOption {
  return &w.opts
}
```

書いてみるとややこしいが、上のような型定義を行った。  
このとき、下のようなコードを書くとエラーになる。

```go
func calcHeight(h heighter) int {
  return h.getOpts().height()
}

w = &widths{&base{"taro"}, &wopt{&opt{120}, 30}}
calcHeight(w)
```

interface `wOption` は interface `option` を満たしているのではないかと思うのだが、 `h.getOpts` で求められているのは `option` ですよ、とコンパイラが怒る。

仕方ないので、次のように取得したい型によって `widths` のメソッドを分けた。

```go
func (w *widths) getOpts() option {
  return &w.opts
}

func (w *widths) getWOpts() wOption {
  return &w.opts
}
```

そしたら怒られなくなった。