---
title: "2020-05-30"
linkTitle: "2020-05-30"
date: 2020-05-30T07:05:50+09:00
---

## 5/30
### Ubuntuãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®VS Codeã§ãƒ•ã‚©ãƒ³ãƒˆå¤‰æ›´

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§è¨˜å·ãŒè±†è…ã«ãªã£ã¦ã—ã¾ã£ãŸã®ã§ã€Nerdãƒ•ã‚©ãƒ³ãƒˆã«ã—ãŸã®ã ãŒã€ã™ãã«åæ˜ ã•ã‚Œãªã„ã‚ˆã†ãªæ°—ãŒã—ãŸã‚‰ã€VS Codeã®å†èµ·å‹•ãŒå¿…è¦ã ã£ãŸã€‚

ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: Visual Studio Code, Powerline Fonts

### VS Codeã§Rustã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããªã„

ä½œæ¥­ç’°å¢ƒã¯Ubuntuãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã€‚  
ä¹…ã—ã¶ã‚Šã«Rustã‚’è§¦ã£ãŸã®ãŒã„ã‘ãªã‹ã£ãŸã®ã‹ã€æœ¬æ¥ã¯VS Codeä¸Šã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—é€šçŸ¥ã«å¾“ã£ã¦rlsã‚„analyzerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚Œã°ã„ã„ã¯ãšãªã®ã ãŒã€æ¬¡ã®ã‚¨ãƒ©ãƒ¼ã§å¤±æ•—ã—ãŸã€‚

```
error: toolchain 'stable-x86_64-unknown-linux-gnu' does not contain component 'rls' for target 'x86_64-unknown-linux-gnu'
```

ã‚°ã‚°ã‚‹ã¨æ¬¡ã®ã‚¤ã‚·ãƒ¥ãƒ¼ã«ãƒ’ãƒƒãƒˆã—ã€å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§è§£æ¶ˆã—ãŸã€‚

https://github.com/rust-lang/rls/issues/1273

```sh
rustup uninstall stable
rustup install stable
```

å‚è€ƒ:

- [Visual Studio Code ã§ Rust é–‹ç™ºã‚’å§‹ã‚ã‚‹ã«ã¯ - Qiita](https://qiita.com/chikoski/items/53590914cc6aacc8916d)

### cargo-editã¨ã„ã†ã®ãŒã‚ã‚‹

2018-02-06æ›´æ–°ã®è¨˜äº‹: [Cargo.toml ã®ç·¨é›†ã« cargo-edit ã‚’ä½¿ã† - Qiita](https://qiita.com/i2tsuki/items/8d90f7aa872671404a15)

Rustã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ `cargo` CLIã«ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ãã‚Œã‚‹:

- `cargo add <Package>` ... ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ 
- `cargo rm <Package>` ... ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å‰Šé™¤
- `cargo list` ... ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¸€è¦§

çµ¶å¯¾å¿…è¦ã¨ã„ã†ã»ã©ã§ã¯ãªã„ãŒã€ä¾¿åˆ©ã‹ã‚‚ã€‚

### Rustã®CLIä½œæˆãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«

[A command line app in 15 minutes - Command Line Applications in Rust](https://rust-cli.github.io/book/tutorial/)ã‚’ã‚„ã£ã¦ã„ã‚‹ã€‚

åˆã‚ã¦å‡ºãã‚ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„è¨€èªä»•æ§˜ã‚’éƒ½åº¦ã€èª¿ã¹ãªãŒã‚‰ãªã®ã§é…ã€…ã¨ã—ã¦é€²ã¾ãªã„ãŒã€ã„ã¾[1.3. First implementation](https://rust-cli.github.io/book/tutorial/impl-draft.html)ã¾ã§æ¥ãŸã¨ã“ã‚ã€‚

#### ã‚ã‹ã‚‰ãªã‹ã£ãŸã“ã¨

[Nicer error reporting - Command Line Applications in Rust](https://rust-cli.github.io/book/tutorial/errors.html)

```Rust
fn main() -> Result<(), Box<dyn std::error::Error>> {
  :
}
```

ã®ã‚ˆã†ã«ã€main()ã§Resultå‹ã‚’è¿”ã™ã‚ˆã†ã«ã—ãŸã¨ã“ã‚ã€ä¸‹ã®ã‚ˆã†ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã†ã€‚

```
error[E0308]: mismatched types
  --> src/main.rs:13:14
   |
13 | fn main() -> Result<(), Box<dyn std::error::Error>> {
   |    ----      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected enum `std::result::Result`, found `()`
   |    |
   |    implicitly returns `()` as its body has no tail or `return` expression
...
28 |     Ok(());
   |           - help: consider removing this semicolon
   |
   = note:   expected enum `std::result::Result<(), std::boxed::Box<(dyn std::error::Error + 'static)>>`
           found unit type `()`

error: aborting due to previous error

For more information about this error, try `rustc --explain E0308`.
error: could not compile `grrs`.
```

ãã†ã„ãˆã°ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’è¦‹ã¦ãªã‹ã£ãŸã®ã§ã€è¦‹ã¦ã¿ãŸã€‚

```
$ rustc --explain E0308 | cat
This error occurs when the compiler was unable to infer the concrete type of a
variable. It can occur for several cases, the most common of which is a
mismatch in the expected type that the compiler inferred for a variable's
initializing expression, and the actual type explicitly assigned to the
variable.

For example:

    let x: i32 = "I am not a number!";
    //     ~~~   ~~~~~~~~~~~~~~~~~~~~
    //      |             |
    //      |    initializing expression;
    //      |    compiler infers type `&str`
    //      |
    //    type `i32` assigned to variable `x`
```

ã¾ã‚å‹ã®ãƒŸã‚¹ãƒãƒƒãƒãŒèµ·ã“ã£ã¦ã„ã‚‹ã‚ˆã†ã ãŒã€å‹•ã‹ãªã„ã‚³ãƒ¼ãƒ‰ã‚’åˆå¿ƒè€…å‘ã‘ã®ã‚µãƒ³ãƒ—ãƒ«ã«ã—ãªã„ã§ã»ã—ã„ã¨ã„ã†æ°—æŒã¡ã¯ãªãã«ã—ã‚‚ã‚ã‚‰ãšã€‚

ã¾ãŸã€æ¬¡ã®ã‚ˆã†ã«æ›¸ãæ›ãˆãŸã¨ã“ã‚ã€åˆ¥ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã€‚

```Rust
#[derive(Debug)]
struct CustomError(String);

fn main() -> Result<(), CustomError> {
    let args = Cli::from_args();

    let content = std::fs::read_to_string(&args.path)
        .map_err(|err| CustomError(format!("Error reading `{}`: {}", &args.path, err)))?;
    :
}
```

ã‚¨ãƒ©ãƒ¼:

```
error[E0277]: `std::path::PathBuf` doesn't implement `std::fmt::Display`
  --> src/main.rs:20:70
   |
20 |         .map_err(|err| CustomError(format!("Error reading `{}`: {}", &args.path, err)))?;
   |                                                                      ^^^^^^^^^^ `std::path::PathBuf` cannot be formatted with the default formatter
   |
   = help: the trait `std::fmt::Display` is not implemented for `std::path::PathBuf`
   = note: in format strings you may be able to use `{:?}` (or {:#?} for pretty-print) instead
   = note: required because of the requirements on the impl of `std::fmt::Display` for `&std::path::PathBuf`
   = note: required by `std::fmt::Display::fmt`
   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)
```

`rustc --explain E0277` ã‚’è¦‹ã‚‹ã¨ä¸‹ã®ã‚ˆã†ã ã£ãŸ:

> You tried to use a type which doesn't implement some trait in a place which expected that trait.

traitãŒæœŸå¾…ã•ã‚Œã¦ã„ã‚‹ã¨ã“ã‚ã§ã€traitãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„å‹ã‚’ä½¿ã£ã¦ã—ã¾ã£ãŸã€ã¨ã„ã†ã“ã¨ã®ã‚ˆã†ã ã€‚

> Erroneous code example:

```Rust
// here we declare the Foo trait with a bar method
trait Foo {
    fn bar(&self);
}

// we now declare a function which takes an object implementing the Foo trait
fn some_func<T: Foo>(foo: T) {
    foo.bar();
}

fn main() {
    // we now call the method with the i32 type, which doesn't implement
    // the Foo trait
    some_func(5i32); // error: the trait bound `i32 : Foo` is not satisfied
}
```

ä»¥ä¸‹ã€ç•¥ã€‚

ã“ã‚Œã¯PathBufã®å‹ãŒã‚¤ã‚«ãƒ³ã‚ˆã†ãªã®ã§ã€`format!` æ°ãŒæœŸå¾…ã—ã¦ã„ã‚‹å‹ã«ã—ã¦ã‚ã’ã‚Œã°å‹•ããã†ãªæ°—ãŒã™ã‚‹ã€‚

`&args.path.display()` ã¨ã—ãŸã‚‰å‹•ãã‚ˆã†ã«ãªã£ãŸğŸ‰

- è©²å½“ã‚³ãƒŸãƒƒãƒˆ: https://github.com/progrhyme/tutorials/commit/06cc24ffd7493dd2c3707db5c89e536e2941680d
